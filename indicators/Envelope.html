<!DOCTYPE html>
<html lang="ja" class="scroll-smooth">
<head>
        <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Envelope - I ant I Investigates</title>
    <meta name="description" content="Envelope - Technical Indicator">
    <meta name="keywords" content="Envelope, technical indicator, stock analysis">
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3375094177283762"
         crossorigin="anonymous"></script>
    <!-- Canonical URL -->
    <link rel="canonical" href="https://akuro17.github.io/indicators/envelope.html">
    <!-- OGP (Open Graph Protocol) -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="Envelope - I ant I Investigates">
    <meta property="og:description" content="Envelope - Technical Indicator">
    <meta property="og:url" content="https://akuro17.github.io/indicators/envelope.html">
    <meta property="og:site_name" content="I ant I Investigates">
    <meta property="og:image" content="https://akuro17.github.io/assets/images/ogp/envelope.png">
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Envelope">
    <meta name="twitter:description" content="Envelope - Technical Indicator">
    <meta name="twitter:image" content="https://akuro17.github.io/assets/images/ogp/envelope.png">
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
        {
    "@context": "https://schema.org",
    "@graph": [
        {
            "@context": "https://schema.org",
            "@type": "TechArticle",
            "headline": "Envelope Technical Indicator",
            "description": "Trading Envelopes plot two bands at fixed percentage distances above and below a moving average to define the statistically \"normal\" trading range and identify overbought/oversold conditions.",
            "image": "https://akuro17.github.io/assets/images/ogp/envelope.png",
            "author": {
                "@type": "Organization",
                "name": "I ant I Investigates",
                "url": "https://akuro17.github.io"
            },
            "publisher": {
                "@type": "Organization",
                "name": "I ant I Investigates",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://akuro17.github.io/assets/images/logo.png"
                }
            },
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": "https://akuro17.github.io/indicators/envelope.html"
            },
            "about": {
                "@type": "SoftwareSourceCode",
                "name": "Envelope Indicator Code",
                "programmingLanguage": [
                    "C#",
                    "Python"
                ]
            }
        },
        {
            "@context": "https://schema.org",
            "@type": "BreadcrumbList",
            "itemListElement": [
                {
                    "@type": "ListItem",
                    "position": 1,
                    "name": "Home",
                    "item": "https://akuro17.github.io/"
                },
                {
                    "@type": "ListItem",
                    "position": 2,
                    "name": "Indicators",
                    "item": "https://akuro17.github.io/indicators/"
                },
                {
                    "@type": "ListItem",
                    "position": 3,
                    "name": "Envelope",
                    "item": "https://akuro17.github.io/indicators/envelope.html"
                }
            ]
        }
    ]
}
    </script>
    <!-- Resource Hints -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <!-- Styles -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/indicator.css">
    <!-- KaTeX (Math) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <!-- Libraries (defer for non-blocking load) -->
    <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <!-- Pygments Syntax Highlighting (Externalized) -->
    <link rel="stylesheet" href="../assets/css/pygments.css">

</head>
<body class="bg-slate-50 text-slate-800 font-sans antialiased relative">
        <!-- Navigation -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center mr-6">
                        <a href="../" class="flex items-center gap-2" id="logo">
                            <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-indigo-600 text-xs font-semibold text-white font-mono">I</span>
                            <div class="flex flex-col">
                                <span class="text-sm font-semibold tracking-tight">I ant I Investigates</span>
                                <span class="text-xs text-slate-500">Stock Analysis Lab</span>
                            </div>
                        </a>
                    </div>
                    <!-- Breadcrumbs (Moved Here) -->
                    <nav class="flex text-sm text-slate-500 mr-8" aria-label="Breadcrumb">
                        <ol class="flex items-center space-x-2">
                            <li><a href="../index.html" class="hover:text-indigo-600 transition-colors">home</a></li>
                            <li><span class="mx-1">/</span></li>
                            <li><a href="./" class="hover:text-indigo-600 transition-colors">indicators</a></li>
                            <li><span class="mx-1">/</span></li>
                            <li><span class="font-medium text-slate-900">Envelope</span></li>
                        </ol>
                    </nav>

                    <!-- Page Top Nav (Anchor Links) -->
                    <div class="flex space-x-4 items-center">
                        <a href="#interactive-playground" class="text-slate-600 hover:text-indigo-600 px-3 py-2 text-sm font-medium transition-colors">
                            Chart
                        </a>
                        <a href="#logic-visualization" class="text-slate-600 hover:text-indigo-600 px-3 py-2 text-sm font-medium transition-colors">
                            Logic
                        </a>
                        <a href="#documentation" class="text-slate-600 hover:text-indigo-600 px-3 py-2 text-sm font-medium transition-colors">
                            Docs
                        </a>
                    </div>
                </div>
                <!-- External Links Placeholder -->
                <div class="hidden sm:flex items-center gap-6 text-sm font-medium">
                    <a href="../" class="text-slate-600 hover:text-indigo-600 transition-colors">Home</a>
                    <a href="./" class="font-semibold text-indigo-600" aria-current="page">Indicators</a>
                    <a href="../screening/" class="text-slate-600 hover:text-indigo-600 transition-colors">Screening</a>
                    <span class="text-slate-300 font-medium cursor-not-allowed">Software</span>
                </div>
            </div>
        </div>
    </nav>
    <!-- Main Container: 1-Column Stack -->
    <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12">
        <!-- ======================================================= -->
        <!-- TOP SECTION: CONTEXT & PLAYGROUND                       -->
        <!-- ======================================================= -->
        <div class="flex flex-col gap-6">
            <!-- Hero Header -->
            <header>
                <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4 leading-tight">Envelope</h1>
                <p class="text-lg text-slate-600 leading-relaxed">Trading Envelopes plot two bands at fixed percentage distances above and below a moving average to define the statistically "normal" trading range and identify overbought/oversold conditions.</p>
            </header>

            <!-- Interactive Playground -->
            <section id="interactive-playground" class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden scroll-mt-24">
                <div class="border-b border-slate-200 bg-indigo-50 px-6 py-4">
                    <h2 class="text-lg font-bold text-slate-800 flex items-center">
                        <span class="bg-indigo-600 text-white p-1 rounded mr-3 text-xs shadow-sm font-mono">C</span>
                        Calculator
                    </h2>
                    <p class="text-sm text-slate-600 mt-2">Calculate indicator values from your price data.</p>
                </div>
                <div class="p-6">
                    <!-- Chart Area -->
                    <div class="relative h-[400px] w-full mb-6 border border-slate-100 rounded bg-slate-50">
                        <canvas id="indicatorChart"></canvas>
                    </div>

                    <!-- Controls Area -->
                    <div id="controls" class="grid grid-cols-1 md:grid-cols-3 gap-6 bg-slate-50 p-4 rounded border border-slate-200">
                        <!-- Parameters -->
                        <div class="md:col-span-1 space-y-4">
                            <h3 class="font-bold text-sm text-slate-700 uppercase tracking-wide border-b border-slate-200 pb-2">Parameters</h3>
                            <div id="settings-container">
                                <div class="space-y-3">
                                    <!-- Dynamic settings will be injected here -->
                                </div>
                            </div>
                            <button id="btn-run" onclick="PlaygroundController.update()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition-colors shadow-sm flex items-center justify-center">
                                Calculate
                            </button>
                        </div>

                        <!-- Data I/O -->
                        <div class="md:col-span-2 space-y-4">
                            <!-- Input -->
                            <div class="space-y-2">
                                <div class="flex justify-between items-center pb-2 border-b border-slate-200">
                                    <h3 class="font-bold text-sm text-slate-700 uppercase tracking-wide">Input Data (CSV)</h3>
                                    <div class="flex space-x-2">
                                        <button id="btn-load-sample-ohlcv" class="text-xs text-indigo-600 hover:text-indigo-800 hover:underline transition-colors" title="Load OHLCV Sample Data">Shape (OHLCV)</button>
                                        <span class="text-slate-300">|</span>
                                        <button id="btn-load-sample-single" class="text-xs text-indigo-600 hover:text-indigo-800 hover:underline transition-colors" title="Load Single Value Sample Data">Single</button>
                                    </div>
                                </div>
                                <p class="text-xs text-slate-500">Enter CSV data (Date,Open,High,Low,Close,Volume) or single values.</p>
                                <textarea id="input-data" class="w-full h-24 p-2 text-xs font-mono border border-slate-300 rounded focus:ring-2 focus:ring-indigo-500 transition-shadow" placeholder="e.g. 100.5, 101.2, 99.8, 102.3, 103.1...

or one per line:
100.5
101.2
99.8"></textarea>
                            </div>
                            <!-- Output (Enabled) -->
                            <div class="space-y-2">
                                <div class="flex justify-between items-center pb-2 border-b border-slate-200">
                                    <h3 class="font-bold text-sm text-slate-700 uppercase tracking-wide">Output Data (Result)</h3>
                                </div>
                                <textarea id="output-data" class="w-full h-24 p-2 text-xs font-mono border border-slate-300 rounded bg-slate-100 text-slate-600" readonly placeholder="Calculation results will appear here..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- ======================================================= -->
        <!-- MIDDLE SECTION: LOGIC & ARCHITECTURE (PORTED FROM 0117) -->
        <!-- ======================================================= -->
        <section id="logic-visualization" class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden scroll-mt-24">
            <!-- Section Header (Styled like Playground) -->
            <div class="border-b border-slate-200 bg-emerald-50 px-6 py-4">
                <h2 class="text-lg font-bold text-slate-800 flex items-center">
                    <span class="bg-emerald-600 text-white p-1 rounded mr-3 text-xs shadow-sm font-mono">L</span>
                    Logic & Code Architecture
                </h2>
                <p class="text-sm text-slate-600 mt-2">Visual flowchart showing how the indicator processes data.</p>
            </div>

            <!-- LOGIC FIGURE STRUCTURE -->
            <figure class="logic-figure" style="border: none; border-radius: 0;">
                <!-- 1. Code Panel Toggle Button -->
                <button id="code-panel-toggle-btn" onclick="toggleCodePanel()" title="View Source Code" class="font-bold text-xs">
                    CODE
                </button>

                <!-- 2. Infinite Canvas Layer -->
                <div id="canvas-container" class="chart-scroll-wrapper" 
                     tabindex="0"
                     role="application"
                     aria-label="Flowchart interaction area. Use arrow keys to pan, +/- to zoom, R to reset">
                    <div id="canvas-content" class="mermaid" style="position: absolute; top:0; left:0;">
                        flowchart TD;
subgraph INGESTION["Phase 1: Ingestion"];
A[/"Receive Price Data Stream"/];
B["Collect Closing Prices"];
C["Define Envelope Width Parameter"];
end;
subgraph EVALUATION["Phase 2: Evaluation"];
D["Calculate Consensus Value via SMA"];
E["Establish Market Equilibrium Level"];
end;
subgraph WEIGHTING["Phase 3: Weighting"];
F["Apply Fixed Percentage Offset"];
G["Define Upper Boundary Distance"];
H["Define Lower Boundary Distance"];
end;
subgraph SYNTHESIS["Phase 4: Synthesis"];
I["Construct Upper Envelope Band"];
J["Construct Lower Envelope Band"];
K["Create Trading Channel Boundaries"];
end;
subgraph OUTCOME["Phase 5: Outcome"];
L{"Price Position Assessment?"};
M["Above Upper = Overbought Zone"];
N["Below Lower = Oversold Zone"];
O["Within Bands = Normal Range"];
P[/"Generate Mean Reversion Signal"/];
end;
A --> B;
B --> C;
C --> D;
D --> E;
E --> F;
F --> G;
F --> H;
G --> I;
H --> J;
I --> K;
J --> K;
K --> L;
L -->|Touches Upper| M;
L -->|Touches Lower| N;
L -->|Inside Channel| O;
M --> P;
N --> P;
O --> P;
style INGESTION fill:#e3f2fd;
style EVALUATION fill:#fff3e0;
style WEIGHTING fill:#e8f5e9;
style SYNTHESIS fill:#fce4ec;
style OUTCOME fill:#f3e5f5;
                    </div>
                </div>

                <!-- 3. Canvas Controls (Zoom) -->
                <div class="absolute top-4 right-4 flex flex-col gap-2 z-20">
                    <button onclick="if(window.resetView) window.resetView()" class="p-2 bg-white rounded shadow border border-slate-200 hover:bg-slate-50 text-slate-600 font-mono text-xs" title="Reset View">R</button>
                    <button onclick="if(window.zoomAction) window.zoomAction('in')" class="p-2 bg-white rounded shadow border border-slate-200 hover:bg-slate-50 text-slate-600 font-mono text-xs" title="Zoom In">+</button>
                    <button onclick="if(window.zoomAction) window.zoomAction('out')" class="p-2 bg-white rounded shadow border border-slate-200 hover:bg-slate-50 text-slate-600 font-mono text-xs" title="Zoom Out">-</button>
                </div>

                <!-- 4. Code Panel Overlay (Slide-in) -->
                <div id="code-panel-overlay" class="panel-hidden" onmousedown="event.stopPropagation();">
                    <!-- Header -->
                    <div class="flex justify-between items-center p-3 border-b border-slate-200 bg-slate-50 shrink-0">
                        <div class="flex gap-2">
                            <button id="btn-lang-csharp" class="px-2 py-1 text-xs rounded transition-colors text-slate-500 hover:bg-slate-100" onclick="setLang('csharp')">C#</button>
                            <button id="btn-lang-python" class="px-2 py-1 text-xs rounded transition-colors text-slate-500 hover:bg-slate-100" onclick="setLang('python')">Python</button>
                        </div>
                        <div class="flex items-center gap-2">
                            <button id="btn-type-simple" class="text-xs text-slate-500 hover:text-indigo-600 transition-colors" onclick="setType('simple')">Simple</button>
                            <button id="btn-type-detailed" class="text-xs text-slate-500 hover:text-indigo-600 transition-colors" onclick="setType('detailed')">Detailed</button>
                            <!-- Copy -->
                            <button id="btn-copy-code" class="ml-2 text-slate-500 hover:text-slate-800 transition-colors" onclick="copyCode()" title="Copy Code">
                                <svg id="icon-copy" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                                <svg id="icon-copy-done" class="hidden text-green-600" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                            </button>
                            <!-- Expand/Collapse -->
                            <button id="btn-panel-expand" class="text-slate-500 hover:text-slate-800 transition-colors" onclick="toggleExpand()" title="Toggle Width">
                                <svg id="icon-expand" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M15 3h6v6" /><path d="M9 21H3v-6" /><path d="M21 3l-7 7" /><path d="M3 21l7-7" />
                                </svg>
                                <svg id="icon-collapse" class="hidden" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 14h6v6" /><path d="M20 10h-6V4" /><path d="M14 10l7-7" /><path d="M10 14l-7 7" />
                                </svg>
                            </button>
                            <!-- Close -->
                            <button class="text-slate-500 hover:text-red-600 transition-colors" onclick="toggleCodePanel()" title="Close Panel">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <!-- Body -->
                    <div class="code-panel-body custom-scrollbar p-4" 
                         id="code-panel-body"
                         data-code-src="../data/codes/Envelope.js">
                        <!-- Loading indicator -->
                        <div id="code-loading" class="hidden absolute inset-0 flex items-center justify-center bg-white/80 z-10">
                            <span class="text-slate-400 text-sm">Loading code...</span>
                        </div>
                        <!-- Code containers (populated via JS fetch) -->
                        <div id="code-csharp-simple" class="code-content hidden"></div>
                        <div id="code-csharp-detailed" class="code-content hidden"></div>
                        <div id="code-python-simple" class="code-content hidden"></div>
                        <div id="code-python-detailed" class="code-content hidden"></div>
                    </div>
                </div>
            </figure>

            <!-- Legend (5-Step Model) -->
            <div class="logic-legend">
                <div class="legend-item"><span class="legend-dot l-ingestion"></span>Ingestion</div>
                <div class="legend-item"><span class="legend-dot l-evaluation"></span>Evaluation</div>
                <div class="legend-item"><span class="legend-dot l-weighting"></span>Weighting</div>
                <div class="legend-item"><span class="legend-dot l-synthesis"></span>Synthesis</div>
                <div class="legend-item"><span class="legend-dot l-outcome"></span>Outcome</div>
                <div class="text-xs text-slate-500 ml-auto">Keyboard: Arrows(pan) / +-(zoom) / R(reset)</div>
            </div>
        </section>

        <!-- ======================================================= -->
        <!-- BOTTOM SECTION: DOCS & TOC                              -->
        <!-- ======================================================= -->
        <section id="documentation" class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden scroll-mt-24">
            <!-- Documentation Header -->
            <div class="border-b border-orange-200 bg-orange-50 px-6 py-4">
                <h2 class="text-lg font-bold text-slate-900 flex items-center">
                    <span class="bg-indigo-600 text-white p-1 rounded mr-3 text-xs shadow-sm font-mono">D</span>
                    Technical Documentation
                </h2>
                <p class="text-slate-600 text-xs mt-1 ml-9">
                    Detailed technical explanation of the indicator's logic, math, and implementation details.
                </p>
            </div>
            <!-- Content Body -->
            <div class="p-6 flex flex-col lg:flex-row gap-12">
                <!-- Left: Article -->
                <article class="flex-1 min-w-0">
                    <div class="prose prose-slate max-w-none prose-headings:scroll-mt-24 prose-headings:font-bold prose-h2:text-2xl prose-h2:border-b prose-h2:pb-2 prose-h2:mt-8 prose-a:text-indigo-600 hover:prose-a:text-indigo-800">
                        <h1 id="envelope">Envelope</h1>

<p class="mb-4"><h2 class="text-2xl font-bold mt-12 mb-6 border-b pb-2">PART 1: MAIN GUIDE</h2></p>

<h2 id="1-identity">1. Identity</h2>

<p class="mb-4">Full Name: Trading Envelope (Moving Average Envelope)  </p>
<p class="mb-4">Abbreviation: ENV  </p>
<p class="mb-4">Category: Overlay / Band / Channel  </p>
<p class="mb-4">Creator: Various (Early Technical Analysts / Chester Keltner influence)  </p>

<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">One-Sentence Definition: Trading Envelopes plot two bands at fixed percentage distances above and below a moving average to define the statistically "normal" trading range and identify overbought/oversold conditions.</blockquote>

<hr class="border-[#2a2e39] my-8">

<h2 id="2-calculation-logic">2. Calculation Logic</h2>

<h3 id="formula">Formula</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Component</td><td class="px-4 py-2 border-b border-[#2a2e39]">Formula</td><td class="px-4 py-2 border-b border-[#2a2e39]">Role</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Middle Band</td><td class="px-4 py-2 border-b border-[#2a2e39]">$SMA_n(Close)$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Consensus value</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Upper Band</td><td class="px-4 py-2 border-b border-[#2a2e39]">$Middle \times (1 + k/100)$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Overbought boundary</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Lower Band</td><td class="px-4 py-2 border-b border-[#2a2e39]">$Middle \times (1 - k/100)$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Oversold boundary</td></tr>
</table></div>

<p class="mb-4">Variables:</p>
<p class="mb-4">- $n$ = Period (typically 20)</p>
<p class="mb-4">- $k$ = Percentage deviation (e.g., 2.5% to 10%)</p>

<p class="mb-4">Step-by-Step Logic:</p>
<p class="mb-4">1. Calculate SMA of Close prices over $n$ periods</p>
<p class="mb-4">2. Compute offset: $offset = SMA \times (k / 100)$</p>
<p class="mb-4">3. Upper Band = SMA + offset</p>
<p class="mb-4">4. Lower Band = SMA − offset</p>

<h3 id="real-world-analogy">Real-World Analogy</h3>

<p class="mb-4">Think of Envelopes like speed limit signs on a highway. The center line is the average traffic flow. Prices touching the upper envelope are "speeding" and will likely slow down. Prices at the lower envelope are "crawling" and will likely accelerate back toward normal traffic.</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="3-market-standards">3. Market Standards</h2>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Parameter</td><td class="px-4 py-2 border-b border-[#2a2e39]">Value</td><td class="px-4 py-2 border-b border-[#2a2e39]">Purpose</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Period</td><td class="px-4 py-2 border-b border-[#2a2e39]">20</td><td class="px-4 py-2 border-b border-[#2a2e39]">One month of trading</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Percentage</td><td class="px-4 py-2 border-b border-[#2a2e39]">2-5%</td><td class="px-4 py-2 border-b border-[#2a2e39]">Normal volatility range</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Volatile Assets</td><td class="px-4 py-2 border-b border-[#2a2e39]">5-10%</td><td class="px-4 py-2 border-b border-[#2a2e39]">Crypto, tech stocks</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Stable Assets</td><td class="px-4 py-2 border-b border-[#2a2e39]">0.5-2%</td><td class="px-4 py-2 border-b border-[#2a2e39]">Forex, utilities</td></tr>
</table></div>

<hr class="border-[#2a2e39] my-8">

<h2 id="4-market-context">4. Market Context</h2>

<p class="mb-4">Best: Ranging/Sideways markets (Mean Reversion trades)  </p>
<p class="mb-4">Good: High-volatility breakouts (with volume confirmation)  </p>
<p class="mb-4">Worst: Low-volatility creeping trends (price hugs band without reversing)</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="5-entry-signals">5. Entry Signals</h2>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Signal Type</td><td class="px-4 py-2 border-b border-[#2a2e39]">Condition</td><td class="px-4 py-2 border-b border-[#2a2e39]">Direction</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strength</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Reversion Buy</td><td class="px-4 py-2 border-b border-[#2a2e39]">Price touches Lower Band, closes back inside</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bullish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Breakout Buy</td><td class="px-4 py-2 border-b border-[#2a2e39]">Close above Upper Band (momentum)</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bullish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Moderate</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Reversion Sell</td><td class="px-4 py-2 border-b border-[#2a2e39]">Price touches Upper Band, closes back inside</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bearish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Breakdown Sell</td><td class="px-4 py-2 border-b border-[#2a2e39]">Close below Lower Band</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bearish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Moderate</td></tr>
</table></div>

<h3 id="primary-buy-signal-mean-reversion">Primary Buy Signal (Mean Reversion)</h3>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
IF Price dips below LowerBand
AND Close &gt; LowerBand          // Closed back inside
THEN → BUY (Oversold reversion)
</code></pre>

<hr class="border-[#2a2e39] my-8">

<h2 id="6-filter-usage">6. Filter Usage</h2>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Partner</td><td class="px-4 py-2 border-b border-[#2a2e39]">Synergy</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">RSI</td><td class="px-4 py-2 border-b border-[#2a2e39]">Confirm momentum exhaustion at band touch</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">ADX</td><td class="px-4 py-2 border-b border-[#2a2e39]">ADX < 20 for reversion; ADX > 25 for breakout</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Slope</td><td class="px-4 py-2 border-b border-[#2a2e39]">Only fade bands if center MA is flat</td></tr>
</table></div>

<hr class="border-[#2a2e39] my-8">

<h2 id="7-practical-cautions">7. Practical Cautions</h2>

<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">The "Close" Rule: Wait for candle to CLOSE. Intraday wicks often pierce bands and reverse (whipsaws).</blockquote>

<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">Penny Stocks: Fixed percentages on low-priced stocks may be smaller than tick size, rendering envelopes useless.</blockquote>

<hr class="border-[#2a2e39] my-8">

<h2 id="8-pro-insights">8. Pro Insights</h2>

<p class="mb-4">The "Tiered Entry" Technique: Plot two sets of envelopes (e.g., 2% inner, 5% outer). The inner band is a warning zone to tighten stops. The outer band is the hard reversal entry zone.</p>

<p class="mb-4">Volatility Regimes: Unlike Bollinger Bands, envelopes don't dynamically adjust. This "rigidity" filters noisy spikes but fails during high-volatility expansions.</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="9-summary">9. Summary</h2>

<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">"Envelopes are your market's speed limit—prices touching the edges are overextended and statistically likely to revert to the road's center."</blockquote>

<p class="mb-4"><h2 class="text-2xl font-bold mt-12 mb-6 border-b pb-2">PART 2: SUPPLEMENTARY GUIDE</h2></p>

<h2 id="1-core-concept">1. Core Concept</h2>

<p class="mb-4">Envelopes answer: "How far from normal is the current price?"</p>

<p class="mb-4">The Mean Reversion Hypothesis states prices eventually return to their average. Envelopes visualize this elasticity—like a rubber band stretched from the center.</p>

<h2 id="2-statistical-edge">2. Statistical Edge</h2>

<p class="mb-4">The deviation percentage should contain ~90-95% of normal price action. Backtests show mean-reversion trades from envelope extremes in ranging markets have a 55-60% win rate.</p>

<h2 id="3-actionable-strategy:-"wash-&-rinse"">3. Actionable Strategy: "Wash & Rinse"</h2>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
SETUP: Price makes a Lower Low that punctures the Lower Band
TRIGGER: Candle closes BACK INSIDE the band (long lower wick)
TARGET: Centerline (Moving Average)
STOP: 1× band distance below the low
</code></pre>

<h2 id="4-risks-&-limitations">4. Risks & Limitations</h2>

<p class="mb-4">- Constant width: Doesn't adapt to volatility cycles</p>
<p class="mb-4">- Trend following: Breakouts require volume confirmation</p>
<p class="mb-4">- Scale issues: Penny stocks render fixed % useless</p>

<h2 id="5-further-study">5. Further Study</h2>

<p class="mb-4">Related: Bollinger Bands, Keltner Channels, Donchian Channels, Price Channels</p>

<h3 id="55-related-indicators-comparison">5.5 Related Indicators Comparison</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Feature</td><td class="px-4 py-2 border-b border-[#2a2e39]">Envelope</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bollinger Bands</td><td class="px-4 py-2 border-b border-[#2a2e39]">Keltner Channel</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Band Width</td><td class="px-4 py-2 border-b border-[#2a2e39]">Fixed %</td><td class="px-4 py-2 border-b border-[#2a2e39]">Dynamic (StdDev)</td><td class="px-4 py-2 border-b border-[#2a2e39]">Dynamic (ATR)</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Adapts to Volatility</td><td class="px-4 py-2 border-b border-[#2a2e39]">No</td><td class="px-4 py-2 border-b border-[#2a2e39]">Yes</td><td class="px-4 py-2 border-b border-[#2a2e39]">Yes</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Best For</td><td class="px-4 py-2 border-b border-[#2a2e39]">Ranging markets</td><td class="px-4 py-2 border-b border-[#2a2e39]">All conditions</td><td class="px-4 py-2 border-b border-[#2a2e39]">Trend following</td></tr>
</table></div>

<p class="mb-4"><h2 class="text-2xl font-bold mt-12 mb-6 border-b pb-2">PART 3: ADVANCED SIGNAL REFERENCE</h2></p>

<h3 id="signal-patterns">Signal Patterns</h3>

<h4 id="envelope-reversion-buy-wash-&-rinse">Envelope Reversion Buy (Wash & Rinse)</h4>

<p class="mb-4">This mean-reversion pattern triggers when price pierces the lower band but closes back inside, indicating the oversold condition attracted buyer interest. The "Wash & Rinse" name describes the market washing out weak longs then rinsing in fresh buying. This signal works best in ranging markets where prices oscillate around the moving average center.</p>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-python">
def envelope_reversion_buy(price_low, lower_band, close):
&nbsp;&nbsp;&nbsp;&nbsp;pierced = price_low &lt; lower_band
&nbsp;&nbsp;&nbsp;&nbsp;recovered = close &gt; lower_band
&nbsp;&nbsp;&nbsp;&nbsp;return pierced and recovered  # &quot;Wash &amp; Rinse&quot; pattern
</code></pre>

<h3 id="screening-filters">Screening Filters</h3>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
SET CenterMA = SMA(Close, 20)
SET LowerBand = CenterMA * 0.95

FILTER =
&nbsp;&nbsp;(Low[1] &lt; LowerBand) AND  // Yesterday pierced band
&nbsp;&nbsp;(Close &gt; LowerBand)        // Today closed back inside
</code></pre>

<h3 id="combination-strategy:-rsi-confirmation">Combination Strategy: RSI Confirmation</h3>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
IF Price touches LowerBand
AND RSI(14) &lt; 30 AND RSI(14) crosses above 30
THEN BUY (Double-confirmed reversion)
</code></pre>






                    </div>
                </article>
                <!-- Right: Sticky TOC -->
                <aside class="lg:block w-64 flex-shrink-0">
                    <div class="sticky top-24">
                        <h3 class="font-bold text-slate-900 mb-4 pb-2 border-b border-slate-100 text-sm uppercase tracking-wider">
                            On this page
                        </h3>
                        <nav id="toc-nav" class="space-y-1 text-sm text-slate-600">
                            <a href="#1-identity" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">1. Identity</a>
<a href="#2-calculation-logic" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">2. Calculation Logic</a>
<a href="#formula" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Formula</a>
<a href="#real-world-analogy" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Real-World Analogy</a>
<a href="#3-market-standards" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">3. Market Standards</a>
<a href="#4-market-context" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">4. Market Context</a>
<a href="#5-entry-signals" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">5. Entry Signals</a>
<a href="#primary-buy-signal-mean-reversion" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Primary Buy Signal (Mean Reversion)</a>
<a href="#6-filter-usage" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">6. Filter Usage</a>
<a href="#7-practical-cautions" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">7. Practical Cautions</a>
<a href="#8-pro-insights" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">8. Pro Insights</a>
<a href="#9-summary" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">9. Summary</a>
<a href="#1-core-concept" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">1. Core Concept</a>
<a href="#2-statistical-edge" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">2. Statistical Edge</a>
<a href="#3-actionable-strategy:-"wash-&-rinse"" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">3. Actionable Strategy: "Wash & Rinse"</a>
<a href="#4-risks-&-limitations" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">4. Risks & Limitations</a>
<a href="#5-further-study" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">5. Further Study</a>
<a href="#55-related-indicators-comparison" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">5.5 Related Indicators Comparison</a>
<a href="#signal-patterns" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Signal Patterns</a>
<a href="#screening-filters" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Screening Filters</a>
<a href="#combination-strategy:-rsi-confirmation" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Combination Strategy: RSI Confirmation</a>

                        </nav>
                        <div class="mt-8 pt-4 border-t border-slate-100">
                            <a href="#" class="text-xs text-slate-400 hover:text-indigo-600 flex items-center transition-colors">
                                Back to Top
                            </a>
                        </div>
                    </div>
                </aside>
            </div>
        </section>


    </div>


        <!-- Footer -->
    <footer id="site-footer" class="border-t border-slate-200 bg-white mt-auto">
        <div class="mx-auto flex max-w-5xl flex-col gap-3 px-4 py-8 text-xs text-slate-500 sm:flex-row sm:items-center sm:justify-between">
            <div class="flex items-center gap-2">
                <span class="inline-flex h-6 w-6 items-center justify-center rounded-full bg-indigo-600 text-[10px] font-semibold text-white font-mono">I</span>
                <span class="text-[11px]">&copy; 2026 I ant I Investigates</span>
            </div>
            <div class="flex flex-wrap items-center gap-4">
                <span class="text-[11px]">Static Documents / No Tracking</span>
                <nav class="flex gap-4">
                    <a href="./" class="text-[11px] font-semibold text-indigo-600" aria-current="page">Indicators</a>
                    <a href="../screening/" class="text-[11px] text-slate-500 hover:text-indigo-600 transition-colors">Screening</a>
                    <span class="text-[11px] text-slate-300 cursor-not-allowed">Software</span>
                </nav>
            </div>
        </div>
    </footer>
        <!-- ========================================== -->
    <!-- 1. DATA & LOGIC INJECTION                  -->
    <!-- ========================================== -->
    <script>
        window.IndicatorLogic = {
            name: "Envelope",
            params: [],
            calculate: null
        };
        (function() {
            try {
                const injectedCode = `
        window.IndicatorLogic = {
            calculate: (data, params) => {
                const period = params.period || 20;
                const percentage = params.percentage || 2.5;
                const result = Envelope.calculate(data, period, percentage);
                // Handle both array and object returns
                if (Array.isArray(result)) {
                    return { main: result };
                }
                return result;
            }
        };
        `;
                const isTemplatePlaceholder = injectedCode.includes('{{') && injectedCode.includes('CODE_INDICATOR_LOGIC');
                if (injectedCode && injectedCode.trim().length > 0 && !isTemplatePlaceholder) {
                    new Function(injectedCode)();
                } else {
                    console.warn("Playground Logic: Running in Preview/Fallback mode.");
                    window.IndicatorLogic.calculate = () => []; 
                }
            } catch (e) {
                console.error("Critical Error in Logic Injection:", e);
                window.IndicatorLogic.calculate = () => [];
            }
        })();
    </script>

    <!-- ========================================== -->
    <!-- 2. VISUALIZATION ENGINE                    -->
    <!-- ========================================== -->
    <script>
        mermaid.initialize({ startOnLoad: false, theme: 'neutral', securityLevel: 'loose' });
    </script>
    <!-- ========================================== -->
    <!-- 3. UI CONTROLLERS & APP INITIALIZATION     -->
    <!-- ========================================== -->
    <!-- INLINE UI CONTROLLERS (PORTED FROM 0117) -->
    <script src="../assets/js/Envelope.js"></script>
    <!-- JSON Data Containers (XSS-safe) -->
    <script id="data-indicator-config" type="application/json">
[{"id": "period", "label": "Period (20)", "type": "number", "value": 20, "min": 2, "max": 100}, {"id": "percentage", "label": "Percentage (2.5)", "type": "number", "value": 2.5, "min": 0.0, "max": 1.0, "step": 0.01}]
    </script>
    <script id="data-indicator-display" type="application/json">
{"isOverlay": true, "plots": {"main": {"label": "Envelope", "color": "#4f46e5", "type": "line"}}}
    </script>
    <script>
        // --- 0. Indicator Data Injection ---
        // Use existing IndicatorLogic (set in earlier script block), only set if not exists
        var IndicatorLogic = window.IndicatorLogic || { calculate: null };
        var IndicatorConfig = [];
        var IndicatorDisplay = { isOverlay: false, plots: {} };

        // 1. Library Code - loaded externally before this block

        // 2. Configuration (XSS-safe via script type="application/json")
        try {
            var configEl = document.getElementById('data-indicator-config');
            if(configEl && configEl.textContent.trim()) {
                IndicatorConfig = JSON.parse(configEl.textContent);
            }
        } catch(e){ console.warn('Config parse error', e); }

        try {
            var displayEl = document.getElementById('data-indicator-display');
            if(displayEl && displayEl.textContent.trim()) {
                IndicatorDisplay = JSON.parse(displayEl.textContent);
            }
        } catch(e){ console.warn('Display parse error', e); }

        // 3. Logic Adapter
        window.IndicatorLogic = {
            calculate: (data, params) => {
                const period = params.period || 20;
                const percentage = params.percentage || 2.5;
                const result = Envelope.calculate(data, period, percentage);
                // Handle both array and object returns
                if (Array.isArray(result)) {
                    return { main: result };
                }
                return result;
            }
        };
    </script>

    <!-- UI Controllers: indicator.js loads first to define PlaygroundController -->
    <script src="../assets/js/indicator.js" defer></script>
    <!-- script.js loads second, skips PlaygroundController if already defined -->
    <script src="../assets/js/script.js" defer></script>

</body>
</html>