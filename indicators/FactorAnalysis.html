<!DOCTYPE html>
<html lang="ja" class="scroll-smooth">
<head>
        <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FactorAnalysis - I ant I Investigates</title>
    <meta name="description" content="FactorAnalysis - Technical Indicator">
    <meta name="keywords" content="FactorAnalysis, technical indicator, stock analysis">
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3375094177283762"
         crossorigin="anonymous"></script>
    <!-- Canonical URL -->
    <link rel="canonical" href="https://akuro17.github.io/indicators/factoranalysis.html">
    <!-- OGP (Open Graph Protocol) -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="FactorAnalysis - I ant I Investigates">
    <meta property="og:description" content="FactorAnalysis - Technical Indicator">
    <meta property="og:url" content="https://akuro17.github.io/indicators/factoranalysis.html">
    <meta property="og:site_name" content="I ant I Investigates">
    <meta property="og:image" content="https://akuro17.github.io/assets/images/ogp/factoranalysis.png">
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="FactorAnalysis">
    <meta name="twitter:description" content="FactorAnalysis - Technical Indicator">
    <meta name="twitter:image" content="https://akuro17.github.io/assets/images/ogp/factoranalysis.png">
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
        {
    "@context": "https://schema.org",
    "@graph": [
        {
            "@context": "https://schema.org",
            "@type": "TechArticle",
            "headline": "FactorAnalysis Technical Indicator",
            "description": "Factor Analysis aggregates multiple market drivers\u2014such as Momentum, Value, and Volatility\u2014into a composite score that identifies assets with structural advantages across several dimensions simultaneously.",
            "image": "https://akuro17.github.io/assets/images/ogp/factoranalysis.png",
            "author": {
                "@type": "Organization",
                "name": "I ant I Investigates",
                "url": "https://akuro17.github.io"
            },
            "publisher": {
                "@type": "Organization",
                "name": "I ant I Investigates",
                "logo": {
                    "@type": "ImageObject",
                    "url": "https://akuro17.github.io/assets/images/logo.png"
                }
            },
            "mainEntityOfPage": {
                "@type": "WebPage",
                "@id": "https://akuro17.github.io/indicators/factoranalysis.html"
            },
            "about": {
                "@type": "SoftwareSourceCode",
                "name": "FactorAnalysis Indicator Code",
                "programmingLanguage": [
                    "C#",
                    "Python"
                ]
            }
        },
        {
            "@context": "https://schema.org",
            "@type": "BreadcrumbList",
            "itemListElement": [
                {
                    "@type": "ListItem",
                    "position": 1,
                    "name": "Home",
                    "item": "https://akuro17.github.io/"
                },
                {
                    "@type": "ListItem",
                    "position": 2,
                    "name": "Indicators",
                    "item": "https://akuro17.github.io/indicators/"
                },
                {
                    "@type": "ListItem",
                    "position": 3,
                    "name": "FactorAnalysis",
                    "item": "https://akuro17.github.io/indicators/factoranalysis.html"
                }
            ]
        }
    ]
}
    </script>
    <!-- Resource Hints -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <!-- Styles -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/indicator.css">
    <!-- KaTeX (Math) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <!-- Libraries (defer for non-blocking load) -->
    <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <!-- Pygments Syntax Highlighting (Externalized) -->
    <link rel="stylesheet" href="../assets/css/pygments.css">

</head>
<body class="bg-slate-50 text-slate-800 font-sans antialiased relative">
        <!-- Navigation -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center mr-6">
                        <a href="../index.html" class="font-bold text-xl text-indigo-600">
                            I ant I Investigates
                        </a>
                    </div>
                    <!-- Breadcrumbs (Moved Here) -->
                    <nav class="flex text-sm text-slate-500 mr-8" aria-label="Breadcrumb">
                        <ol class="flex items-center space-x-2">
                            <li><a href="../index.html" class="hover:text-indigo-600 transition-colors">home</a></li>
                            <li><span class="mx-1">/</span></li>
                            <li><a href="./" class="hover:text-indigo-600 transition-colors">indicators</a></li>
                            <li><span class="mx-1">/</span></li>
                            <li><span class="font-medium text-slate-900">FactorAnalysis</span></li>
                        </ol>
                    </nav>

                    <!-- Page Top Nav (Anchor Links) -->
                    <div class="flex space-x-4 items-center">
                        <a href="#interactive-playground" class="text-slate-600 hover:text-indigo-600 px-3 py-2 text-sm font-medium transition-colors">
                            Chart
                        </a>
                        <a href="#logic-visualization" class="text-slate-600 hover:text-indigo-600 px-3 py-2 text-sm font-medium transition-colors">
                            Logic
                        </a>
                        <a href="#documentation" class="text-slate-600 hover:text-indigo-600 px-3 py-2 text-sm font-medium transition-colors">
                            Docs
                        </a>
                    </div>
                </div>
                <!-- External Links Placeholder -->
                <div class="hidden sm:flex items-center">
                </div>
            </div>
        </div>
    </nav>
    <!-- Main Container: 1-Column Stack -->
    <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12">
        <!-- ======================================================= -->
        <!-- TOP SECTION: CONTEXT & PLAYGROUND                       -->
        <!-- ======================================================= -->
        <div class="flex flex-col gap-6">
            <!-- Hero Header -->
            <header>
                <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4 leading-tight">FactorAnalysis</h1>
                <p class="text-lg text-slate-600 leading-relaxed">Factor Analysis aggregates multiple market drivers—such as Momentum, Value, and Volatility—into a composite score that identifies assets with structural advantages across several dimensions simultaneously.</p>
            </header>

            <!-- Interactive Playground -->
            <section id="interactive-playground" class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden scroll-mt-24">
                <div class="border-b border-slate-200 bg-indigo-50 px-6 py-4">
                    <h2 class="text-lg font-bold text-slate-800 flex items-center">
                        <span class="bg-indigo-600 text-white p-1 rounded mr-3 text-xs shadow-sm font-mono">C</span>
                        Calculator
                    </h2>
                    <p class="text-sm text-slate-600 mt-2">Calculate indicator values from your price data.</p>
                </div>
                <div class="p-6">
                    <!-- Chart Area -->
                    <div class="relative h-[400px] w-full mb-6 border border-slate-100 rounded bg-slate-50">
                        <canvas id="indicatorChart"></canvas>
                    </div>

                    <!-- Controls Area -->
                    <div id="controls" class="grid grid-cols-1 md:grid-cols-3 gap-6 bg-slate-50 p-4 rounded border border-slate-200">
                        <!-- Parameters -->
                        <div class="md:col-span-1 space-y-4">
                            <h3 class="font-bold text-sm text-slate-700 uppercase tracking-wide border-b border-slate-200 pb-2">Parameters</h3>
                            <div id="settings-container">
                                <div class="space-y-3">
                                    <!-- Dynamic settings will be injected here -->
                                </div>
                            </div>
                            <button id="btn-run" onclick="PlaygroundController.update()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition-colors shadow-sm flex items-center justify-center">
                                Calculate
                            </button>
                        </div>

                        <!-- Data I/O -->
                        <div class="md:col-span-2 space-y-4">
                            <!-- Input -->
                            <div class="space-y-2">
                                <div class="flex justify-between items-center pb-2 border-b border-slate-200">
                                    <h3 class="font-bold text-sm text-slate-700 uppercase tracking-wide">Input Data (CSV)</h3>
                                    <div class="flex space-x-2">
                                        <button id="btn-load-sample-ohlcv" class="text-xs text-indigo-600 hover:text-indigo-800 hover:underline transition-colors" title="Load OHLCV Sample Data">Shape (OHLCV)</button>
                                        <span class="text-slate-300">|</span>
                                        <button id="btn-load-sample-single" class="text-xs text-indigo-600 hover:text-indigo-800 hover:underline transition-colors" title="Load Single Value Sample Data">Single</button>
                                    </div>
                                </div>
                                <p class="text-xs text-slate-500">Enter CSV data (Date,Open,High,Low,Close,Volume) or single values.</p>
                                <textarea id="input-data" class="w-full h-24 p-2 text-xs font-mono border border-slate-300 rounded focus:ring-2 focus:ring-indigo-500 transition-shadow" placeholder="e.g. 100.5, 101.2, 99.8, 102.3, 103.1...

or one per line:
100.5
101.2
99.8"></textarea>
                            </div>
                            <!-- Output (Enabled) -->
                            <div class="space-y-2">
                                <div class="flex justify-between items-center pb-2 border-b border-slate-200">
                                    <h3 class="font-bold text-sm text-slate-700 uppercase tracking-wide">Output Data (Result)</h3>
                                </div>
                                <textarea id="output-data" class="w-full h-24 p-2 text-xs font-mono border border-slate-300 rounded bg-slate-100 text-slate-600" readonly placeholder="Calculation results will appear here..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- ======================================================= -->
        <!-- MIDDLE SECTION: LOGIC & ARCHITECTURE (PORTED FROM 0117) -->
        <!-- ======================================================= -->
        <section id="logic-visualization" class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden scroll-mt-24">
            <!-- Section Header (Styled like Playground) -->
            <div class="border-b border-slate-200 bg-emerald-50 px-6 py-4">
                <h2 class="text-lg font-bold text-slate-800 flex items-center">
                    <span class="bg-emerald-600 text-white p-1 rounded mr-3 text-xs shadow-sm font-mono">L</span>
                    Logic & Code Architecture
                </h2>
                <p class="text-sm text-slate-600 mt-2">Visual flowchart showing how the indicator processes data.</p>
            </div>

            <!-- LOGIC FIGURE STRUCTURE -->
            <figure class="logic-figure" style="border: none; border-radius: 0;">
                <!-- 1. Code Panel Toggle Button -->
                <button id="code-panel-toggle-btn" onclick="toggleCodePanel()" title="View Source Code" class="font-bold text-xs">
                    CODE
                </button>

                <!-- 2. Infinite Canvas Layer -->
                <div id="canvas-container" class="chart-scroll-wrapper" 
                     tabindex="0"
                     role="application"
                     aria-label="Flowchart interaction area. Use arrow keys to pan, +/- to zoom, R to reset">
                    <div id="canvas-content" class="mermaid" style="position: absolute; top:0; left:0;">
                        flowchart TD;
subgraph INGESTION["Phase 1: Ingestion"];
A[/"Receive Asset Returns Data"/];
B["Collect Factor Return Series"];
C["Gather Multi-Dimensional Inputs"];
end;
subgraph EVALUATION["Phase 2: Evaluation"];
D["Calculate Return Correlations"];
E["Measure Factor Sensitivities"];
F["Identify Systematic Drivers"];
end;
subgraph WEIGHTING["Phase 3: Weighting"];
G["Standardize via Z-Score Normalization"];
H["Apply Factor Importance Weights"];
I["Balance Multi-Factor Contributions"];
end;
subgraph SYNTHESIS["Phase 4: Synthesis"];
J["Compute Weighted Composite Score"];
K["Rank Assets Across Universe"];
L["Identify Structural Advantages"];
end;
subgraph OUTCOME["Phase 5: Outcome"];
M{"Factor Score Assessment?"};
N["Top Decile = Strong Buy"];
O["Bottom Decile = Avoid/Short"];
P["Middle Range = Neutral"];
Q[/"Generate Factor-Based Signal"/];
end;
A --> B;
B --> C;
C --> D;
D --> E;
E --> F;
F --> G;
G --> H;
H --> I;
I --> J;
J --> K;
K --> L;
L --> M;
M -->|High Score| N;
M -->|Low Score| O;
M -->|Average| P;
N --> Q;
O --> Q;
P --> Q;
style INGESTION fill:#e3f2fd;
style EVALUATION fill:#fff3e0;
style WEIGHTING fill:#e8f5e9;
style SYNTHESIS fill:#fce4ec;
style OUTCOME fill:#f3e5f5;
                    </div>
                </div>

                <!-- 3. Canvas Controls (Zoom) -->
                <div class="absolute top-4 right-4 flex flex-col gap-2 z-20">
                    <button onclick="if(window.resetView) window.resetView()" class="p-2 bg-white rounded shadow border border-slate-200 hover:bg-slate-50 text-slate-600 font-mono text-xs" title="Reset View">R</button>
                    <button onclick="if(window.zoomAction) window.zoomAction('in')" class="p-2 bg-white rounded shadow border border-slate-200 hover:bg-slate-50 text-slate-600 font-mono text-xs" title="Zoom In">+</button>
                    <button onclick="if(window.zoomAction) window.zoomAction('out')" class="p-2 bg-white rounded shadow border border-slate-200 hover:bg-slate-50 text-slate-600 font-mono text-xs" title="Zoom Out">-</button>
                </div>

                <!-- 4. Code Panel Overlay (Slide-in) -->
                <div id="code-panel-overlay" class="panel-hidden" onmousedown="event.stopPropagation();">
                    <!-- Header -->
                    <div class="flex justify-between items-center p-3 border-b border-slate-200 bg-slate-50 shrink-0">
                        <div class="flex gap-2">
                            <button id="btn-lang-csharp" class="px-2 py-1 text-xs rounded transition-colors text-slate-500 hover:bg-slate-100" onclick="setLang('csharp')">C#</button>
                            <button id="btn-lang-python" class="px-2 py-1 text-xs rounded transition-colors text-slate-500 hover:bg-slate-100" onclick="setLang('python')">Python</button>
                        </div>
                        <div class="flex items-center gap-2">
                            <button id="btn-type-simple" class="text-xs text-slate-500 hover:text-indigo-600 transition-colors" onclick="setType('simple')">Simple</button>
                            <button id="btn-type-detailed" class="text-xs text-slate-500 hover:text-indigo-600 transition-colors" onclick="setType('detailed')">Detailed</button>
                            <!-- Copy -->
                            <button id="btn-copy-code" class="ml-2 text-slate-500 hover:text-slate-800 transition-colors" onclick="copyCode()" title="Copy Code">
                                <svg id="icon-copy" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                                <svg id="icon-copy-done" class="hidden text-green-600" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                            </button>
                            <!-- Expand/Collapse -->
                            <button id="btn-panel-expand" class="text-slate-500 hover:text-slate-800 transition-colors" onclick="toggleExpand()" title="Toggle Width">
                                <svg id="icon-expand" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M15 3h6v6" /><path d="M9 21H3v-6" /><path d="M21 3l-7 7" /><path d="M3 21l7-7" />
                                </svg>
                                <svg id="icon-collapse" class="hidden" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 14h6v6" /><path d="M20 10h-6V4" /><path d="M14 10l7-7" /><path d="M10 14l-7 7" />
                                </svg>
                            </button>
                            <!-- Close -->
                            <button class="text-slate-500 hover:text-red-600 transition-colors" onclick="toggleCodePanel()" title="Close Panel">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <!-- Body -->
                    <div class="code-panel-body custom-scrollbar p-4" 
                         id="code-panel-body"
                         data-code-src="../data/codes/FactorAnalysis.js">
                        <!-- Loading indicator -->
                        <div id="code-loading" class="hidden absolute inset-0 flex items-center justify-center bg-white/80 z-10">
                            <span class="text-slate-400 text-sm">Loading code...</span>
                        </div>
                        <!-- Code containers (populated via JS fetch) -->
                        <div id="code-csharp-simple" class="code-content hidden"></div>
                        <div id="code-csharp-detailed" class="code-content hidden"></div>
                        <div id="code-python-simple" class="code-content hidden"></div>
                        <div id="code-python-detailed" class="code-content hidden"></div>
                    </div>
                </div>
            </figure>

            <!-- Legend (5-Step Model) -->
            <div class="logic-legend">
                <div class="legend-item"><span class="legend-dot l-ingestion"></span>Ingestion</div>
                <div class="legend-item"><span class="legend-dot l-evaluation"></span>Evaluation</div>
                <div class="legend-item"><span class="legend-dot l-weighting"></span>Weighting</div>
                <div class="legend-item"><span class="legend-dot l-synthesis"></span>Synthesis</div>
                <div class="legend-item"><span class="legend-dot l-outcome"></span>Outcome</div>
                <div class="text-xs text-slate-500 ml-auto">Keyboard: Arrows(pan) / +-(zoom) / R(reset)</div>
            </div>
        </section>

        <!-- ======================================================= -->
        <!-- BOTTOM SECTION: DOCS & TOC                              -->
        <!-- ======================================================= -->
        <section id="documentation" class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden scroll-mt-24">
            <!-- Documentation Header -->
            <div class="border-b border-orange-200 bg-orange-50 px-6 py-4">
                <h2 class="text-lg font-bold text-slate-900 flex items-center">
                    <span class="bg-indigo-600 text-white p-1 rounded mr-3 text-xs shadow-sm font-mono">D</span>
                    Technical Documentation
                </h2>
                <p class="text-slate-600 text-xs mt-1 ml-9">
                    Detailed technical explanation of the indicator's logic, math, and implementation details.
                </p>
            </div>
            <!-- Content Body -->
            <div class="p-6 flex flex-col lg:flex-row gap-12">
                <!-- Left: Article -->
                <article class="flex-1 min-w-0">
                    <div class="prose prose-slate max-w-none prose-headings:scroll-mt-24 prose-headings:font-bold prose-h2:text-2xl prose-h2:border-b prose-h2:pb-2 prose-h2:mt-8 prose-a:text-indigo-600 hover:prose-a:text-indigo-800">
                        <h1 id="factor-analysis">Factor Analysis</h1>

<p class="mb-4"><h2 class="text-2xl font-bold mt-12 mb-6 border-b pb-2">PART 1: MAIN GUIDE</h2></p>

<h2 id="1-identity">1. Identity</h2>

<p class="mb-4">Full Name: Factor Analysis Composite  </p>
<p class="mb-4">Abbreviation: FACT  </p>
<p class="mb-4">Category: Fundamental / Quantitative / Econometric  </p>
<p class="mb-4">Creator: Fama & French (Academic Foundation, 1992)  </p>

<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">One-Sentence Definition: Factor Analysis aggregates multiple market drivers—such as Momentum, Value, and Volatility—into a composite score that identifies assets with structural advantages across several dimensions simultaneously.</blockquote>

<hr class="border-[#2a2e39] my-8">

<h2 id="2-calculation-logic">2. Calculation Logic</h2>

<h3 id="formula">Formula</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Step</td><td class="px-4 py-2 border-b border-[#2a2e39]">Formula</td><td class="px-4 py-2 border-b border-[#2a2e39]">Purpose</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Single Factor</td><td class="px-4 py-2 border-b border-[#2a2e39]">$R_i = \alpha + \beta_1 F_1 + \epsilon$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Asset sensitivity to factor</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Multi-Factor</td><td class="px-4 py-2 border-b border-[#2a2e39]">$R_i = \alpha + \sum_{k=1}^{n} \beta_k F_k + \epsilon$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Combined exposures</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Z-Score</td><td class="px-4 py-2 border-b border-[#2a2e39]">$Z = \frac{Value - \mu}{\sigma}$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Standardized comparison</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Composite</td><td class="px-4 py-2 border-b border-[#2a2e39]">$Score = \sum (Z_k \times w_k)$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Weighted aggregate</td></tr>
</table></div>

<p class="mb-4">Key Variables:</p>
<p class="mb-4">- $R_i$ = Asset return</p>
<p class="mb-4">- $\alpha$ = Alpha (unexplained return)</p>
<p class="mb-4">- $\beta_k$ = Factor loading (sensitivity)</p>
<p class="mb-4">- $F_k$ = Factor return (e.g., Market, Size, Value)</p>
<p class="mb-4">- $w_k$ = Factor weight</p>

<p class="mb-4">Common Factors:</p>
<p class="mb-4">- Momentum: 12-month price return</p>
<p class="mb-4">- Value: P/E ratio, P/B ratio (inverse)</p>
<p class="mb-4">- Volatility: Historical volatility (inverse for "Low Vol")</p>
<p class="mb-4">- Quality: ROE, debt ratios</p>

<h3 id="real-world-analogy">Real-World Analogy</h3>

<p class="mb-4">Think of Factor Analysis as a talent scout's scorecard. Instead of judging an athlete on one skill, you score them across multiple dimensions: speed, strength, agility, endurance. A high composite score means the athlete (asset) excels across multiple attributes, not just one. This multi-dimensional view identifies "winners" that single-metric analysis would miss.</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="3-market-standards">3. Market Standards</h2>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Parameter</td><td class="px-4 py-2 border-b border-[#2a2e39]">Value</td><td class="px-4 py-2 border-b border-[#2a2e39]">Purpose</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Lookback</td><td class="px-4 py-2 border-b border-[#2a2e39]">60-252 days</td><td class="px-4 py-2 border-b border-[#2a2e39]">Factor calculation window</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Factors</td><td class="px-4 py-2 border-b border-[#2a2e39]">3-5</td><td class="px-4 py-2 border-b border-[#2a2e39]">Avoid over-complexity</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Ranking</td><td class="px-4 py-2 border-b border-[#2a2e39]">Decile (10%)</td><td class="px-4 py-2 border-b border-[#2a2e39]">Top/Bottom separation</td></tr>
</table></div>

<p class="mb-4">Classic Factor Sets:</p>
<p class="mb-4">- Fama-French 3: Market, Size (SMB), Value (HML)</p>
<p class="mb-4">- Carhart 4: + Momentum</p>
<p class="mb-4">- Fama-French 5: + Profitability, Investment</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="4-market-context">4. Market Context</h2>

<p class="mb-4">Best: Systematic/quantitative portfolio construction  </p>
<p class="mb-4">Good: Stock screening and selection  </p>
<p class="mb-4">Worst: Macro shocks when correlations spike to 1 (all assets move together)</p>

<p class="mb-4">Factor Rotation:</p>
<p class="mb-4">- Bull Market: Momentum, Growth factors dominate</p>
<p class="mb-4">- Bear Market: Quality, Low Volatility factors outperform</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="5-entry-signals">5. Entry Signals</h2>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Signal Type</td><td class="px-4 py-2 border-b border-[#2a2e39]">Condition</td><td class="px-4 py-2 border-b border-[#2a2e39]">Direction</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strength</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Zero Cross Up</td><td class="px-4 py-2 border-b border-[#2a2e39]">Composite > 0</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bullish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Moderate</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Top Decile</td><td class="px-4 py-2 border-b border-[#2a2e39]">Score > 90th percentile</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bullish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Zero Cross Down</td><td class="px-4 py-2 border-b border-[#2a2e39]">Composite < 0</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bearish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Moderate</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Bottom Decile</td><td class="px-4 py-2 border-b border-[#2a2e39]">Score < 10th percentile</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bearish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Divergence</td><td class="px-4 py-2 border-b border-[#2a2e39]">Price HH + Score LH</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bearish warning</td><td class="px-4 py-2 border-b border-[#2a2e39]">Moderate</td></tr>
</table></div>

<h3 id="primary-buy-signal">Primary Buy Signal</h3>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
IF Composite_Score &gt; 0                  // Net-positive factors
AND Asset_Rank in Top_Decile           // Top 10% of universe
THEN → BUY (Structural advantage)
</code></pre>

<h3 id="quantile-exit-signal">Quantile Exit Signal</h3>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
IF Asset_Rank drops to Bottom_Decile   // Bottom 10%
THEN → SELL (Structural disadvantage)
</code></pre>

<hr class="border-[#2a2e39] my-8">

<h2 id="6-filter-usage">6. Filter Usage</h2>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Partner</td><td class="px-4 py-2 border-b border-[#2a2e39]">Synergy</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Relative Volume (RVOL)</td><td class="px-4 py-2 border-b border-[#2a2e39]">Factor score + RVOL > 2 = Institutional activation</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Regime Filter (SMA 200)</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bull regime: Weight Momentum; Bear: Weight Quality</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Diversification</td><td class="px-4 py-2 border-b border-[#2a2e39]">Apply to basket of top-ranked assets, not single picks</td></tr>
</table></div>

<h3 id="institutional-activation-filter">Institutional Activation Filter</h3>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
IF Factor_Score in Top_Decile          // Structurally attractive
AND RVOL &gt; 2.0                         // Institutional volume
AND Close &gt; Close[1]                   // Positive price action
THEN → BUY (Smart money entering)
</code></pre>

<hr class="border-[#2a2e39] my-8">

<h2 id="7-practical-cautions">7. Practical Cautions</h2>

<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">Look-Ahead Bias: If using fundamental data, ensure the data was available at the timestamp. Using future earnings in past calculations invalidates results.</blockquote>

<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">Division by Zero: Z-Score calculation requires non-zero standard deviation. If all values in the window are identical, σ = 0, causing calculation failure.</blockquote>

<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">Data Gaps: Missing data in any single factor input often forces the entire composite score to return NaN. Implement fallbacks or exclusions.</blockquote>

<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">Factor Crowding: When too many quantitative funds use the same factors, factor returns can become crowded and reverse violently.</blockquote>

<hr class="border-[#2a2e39] my-8">

<h2 id="8-pro-insights">8. Pro Insights</h2>

<p class="mb-4">Factor Rotation Strategy: Factors don't work all the time. Smart allocation between factors based on regime:</p>
<p class="mb-4">- Risk-On Environment: Overweight Momentum, Size (small cap)</p>
<p class="mb-4">- Risk-Off Environment: Overweight Quality, Low Volatility</p>
<p class="mb-4">- Transition Periods: Blend evenly or reduce exposure</p>

<p class="mb-4">Avoiding Value Traps: A high Value score alone is dangerous—cheap stocks can stay cheap. Combining Value with Momentum ("Value + Momentum") ensures you're buying assets that are both cheap AND have positive price catalysts.</p>

<p class="mb-4">Information Ratio: Track the Information Ratio of your factor composite:</p>
<p class="mb-4">$$IR = \frac{Mean(Active\ Return)}{StdDev(Active\ Return)}$$</p>
<p class="mb-4">IR > 0.5 indicates a statistically significant edge.</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="9-summary">9. Summary</h2>

<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">"Factor Analysis is your multi-dimensional X-ray of the market—it reveals which assets have structural advantages across Value, Momentum, and Quality simultaneously."</blockquote>

<p class="mb-4"><h2 class="text-2xl font-bold mt-12 mb-6 border-b pb-2">PART 2: SUPPLEMENTARY GUIDE</h2></p>

<h2 id="1-core-concept">1. Core Concept</h2>

<p class="mb-4">Factor Analysis answers: "Why is this asset performing—and will it continue?"</p>

<p class="mb-4">Returns aren't random. They are compensations for exposure to systematic "factors" (risk/return drivers). By measuring an asset's sensitivity (beta) to these factors, you can:</p>
<p class="mb-4">- Explain past performance</p>
<p class="mb-4">- Predict future relative performance</p>
<p class="mb-4">- Construct portfolios with desired factor tilts</p>

<h2 id="2-statistical-edge">2. Statistical Edge</h2>

<p class="mb-4">Factor Analysis provides:</p>
<p class="mb-4">- Decomposition of returns into explainable components</p>
<p class="mb-4">- Alpha identification (excess return beyond factor exposure)</p>
<p class="mb-4">- Quantitative ranking systems outperform equal-weight by 3-5% annually</p>
<p class="mb-4">- Multi-factor portfolios have lower drawdowns than single-factor</p>

<h2 id="3-actionable-strategy:-"multi-factor-long/short"">3. Actionable Strategy: "Multi-Factor Long/Short"</h2>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
STRATEGY: Factor Rank Portfolio
UNIVERSE: S&amp;P 500 constituents
SCORING:
&nbsp;&nbsp;- Momentum: Rank by 12-month return
&nbsp;&nbsp;- Value: Rank by 1/PE ratio
&nbsp;&nbsp;- Quality: Rank by ROE
&nbsp;&nbsp;- Composite: Average of ranks

PORTFOLIO:
&nbsp;&nbsp;LONG: Top 50 stocks by Composite (Top Decile)
&nbsp;&nbsp;SHORT: Bottom 50 stocks by Composite (Bottom Decile)
&nbsp;&nbsp;REBALANCE: Monthly
</code></pre>

<h2 id="4-risks-&-limitations">4. Risks & Limitations</h2>

<p class="mb-4">- Factor crowding: Popular factors become overcrowded</p>
<p class="mb-4">- Regime dependency: Factors cycle in/out of favor</p>
<p class="mb-4">- Data quality: Fundamental data has errors and lags</p>
<p class="mb-4">- Macro shocks: Correlations spike, factors fail together</p>

<h2 id="5-further-study">5. Further Study</h2>

<p class="mb-4">Creator: Eugene Fama and Kenneth French developed foundational factor models (1992)  </p>
<p class="mb-4">Related: CAPM (single factor), Carhart 4-Factor, Smart Beta, Alpha, Beta</p>

<h3 id="55-related-indicators-comparison">5.5 Related Indicators Comparison</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Feature</td><td class="px-4 py-2 border-b border-[#2a2e39]">Factor Analysis</td><td class="px-4 py-2 border-b border-[#2a2e39]">RSI</td><td class="px-4 py-2 border-b border-[#2a2e39]">Moving Average</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Type</td><td class="px-4 py-2 border-b border-[#2a2e39]">Multi-dimensional</td><td class="px-4 py-2 border-b border-[#2a2e39]">Single (momentum)</td><td class="px-4 py-2 border-b border-[#2a2e39]">Single (trend)</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Data</td><td class="px-4 py-2 border-b border-[#2a2e39]">Price + Fundamentals</td><td class="px-4 py-2 border-b border-[#2a2e39]">Price only</td><td class="px-4 py-2 border-b border-[#2a2e39]">Price only</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Output</td><td class="px-4 py-2 border-b border-[#2a2e39]">Score/Rank</td><td class="px-4 py-2 border-b border-[#2a2e39]">0-100</td><td class="px-4 py-2 border-b border-[#2a2e39]">Line</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Best For</td><td class="px-4 py-2 border-b border-[#2a2e39]">Selection</td><td class="px-4 py-2 border-b border-[#2a2e39]">Timing</td><td class="px-4 py-2 border-b border-[#2a2e39]">Trend direction</td></tr>
</table></div>

<p class="mb-4"><h2 class="text-2xl font-bold mt-12 mb-6 border-b pb-2">PART 3: ADVANCED SIGNAL REFERENCE</h2></p>

<h3 id="threshold-matrix">Threshold Matrix</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Composite Score</td><td class="px-4 py-2 border-b border-[#2a2e39]">Interpretation</td><td class="px-4 py-2 border-b border-[#2a2e39]">Action</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Top Decile (>90%)</td><td class="px-4 py-2 border-b border-[#2a2e39]">Structural winner</td><td class="px-4 py-2 border-b border-[#2a2e39]">Buy / Overweight</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">60-90%</td><td class="px-4 py-2 border-b border-[#2a2e39]">Above average</td><td class="px-4 py-2 border-b border-[#2a2e39]">Hold / Small position</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">40-60%</td><td class="px-4 py-2 border-b border-[#2a2e39]">Average</td><td class="px-4 py-2 border-b border-[#2a2e39]">Neutral</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">10-40%</td><td class="px-4 py-2 border-b border-[#2a2e39]">Below average</td><td class="px-4 py-2 border-b border-[#2a2e39]">Avoid / Underweight</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Bottom Decile (<10%)</td><td class="px-4 py-2 border-b border-[#2a2e39]">Structural loser</td><td class="px-4 py-2 border-b border-[#2a2e39]">Sell / Short</td></tr>
</table></div>

<h3 id="signal-patterns">Signal Patterns</h3>

<h4 id="factor-buy-signal">Factor Buy Signal</h4>

<p class="mb-4">This signal identifies assets in the top decile of composite factor rankings with institutional volume confirmation. Requiring RVOL > 2.0 ensures that smart money is actively accumulating, not just a structurally attractive asset. The combination of multi-factor strength and volume surge creates high-conviction entry opportunities.</p>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-python">
def factor_buy_signal(score, rank_percentile, rvol):
&nbsp;&nbsp;&nbsp;&nbsp;top_decile = rank_percentile &gt;= 90
&nbsp;&nbsp;&nbsp;&nbsp;volume_confirm = rvol &gt; 2.0
&nbsp;&nbsp;&nbsp;&nbsp;return top_decile and volume_confirm
</code></pre>

<h4 id="factor-divergence-warning">Factor Divergence Warning</h4>

<p class="mb-4">This pattern detects deterioration in fundamental quality while price continues to rise—a classic distribution signal. When price makes higher highs but the composite factor score makes lower highs, institutional support is weakening. This divergence often precedes significant corrections as the fundamental underpinning erodes.</p>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-python">
def factor_divergence(price_high, prev_price_high, score, prev_score):
&nbsp;&nbsp;&nbsp;&nbsp;higher_price = price_high &gt; prev_price_high
&nbsp;&nbsp;&nbsp;&nbsp;lower_score = score &lt; prev_score
&nbsp;&nbsp;&nbsp;&nbsp;return higher_price and lower_score  # Quality degrading
</code></pre>

<h3 id="screening-filters">Screening Filters</h3>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
// Multi-Factor Winner Scanner
SET MomScore = Rank(ROC(Close, 252), Descending)
SET ValScore = Rank(1 / PE_Ratio, Descending)
SET VolScore = Rank(HV(20), Ascending)           // Low vol = good
SET Composite = (MomScore + ValScore + VolScore) / 3

FILTER =
&nbsp;&nbsp;(Composite &gt; 90)                               // Top 10%
</code></pre>

<h3 id="combination-strategies">Combination Strategies</h3>

<p class="mb-4">Factor + Volume Activation:</p>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
IF Factor_Score in Top_Decile          // Fundamentally strong
AND RVOL &gt; 2.0                         // Institutional interest
AND Price &gt; SMA(200)                   // Bull regime
THEN BUY

HOLD until Factor_Score drops below 50th percentile
</code></pre>

<p class="mb-4">Regime-Adaptive Factor Selection:</p>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
IF SMA(50) &gt; SMA(200):                 // Bull Market
&nbsp;&nbsp;&nbsp;&nbsp;USE Factors: Momentum, Small Cap, Growth
&nbsp;&nbsp;&nbsp;&nbsp;
IF SMA(50) &lt; SMA(200):                 // Bear Market
&nbsp;&nbsp;&nbsp;&nbsp;USE Factors: Quality, Low Volatility, Value
</code></pre>






                    </div>
                </article>
                <!-- Right: Sticky TOC -->
                <aside class="lg:block w-64 flex-shrink-0">
                    <div class="sticky top-24">
                        <h3 class="font-bold text-slate-900 mb-4 pb-2 border-b border-slate-100 text-sm uppercase tracking-wider">
                            On this page
                        </h3>
                        <nav id="toc-nav" class="space-y-1 text-sm text-slate-600">
                            <a href="#1-identity" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">1. Identity</a>
<a href="#2-calculation-logic" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">2. Calculation Logic</a>
<a href="#formula" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Formula</a>
<a href="#real-world-analogy" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Real-World Analogy</a>
<a href="#3-market-standards" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">3. Market Standards</a>
<a href="#4-market-context" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">4. Market Context</a>
<a href="#5-entry-signals" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">5. Entry Signals</a>
<a href="#primary-buy-signal" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Primary Buy Signal</a>
<a href="#quantile-exit-signal" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Quantile Exit Signal</a>
<a href="#6-filter-usage" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">6. Filter Usage</a>
<a href="#institutional-activation-filter" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Institutional Activation Filter</a>
<a href="#7-practical-cautions" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">7. Practical Cautions</a>
<a href="#8-pro-insights" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">8. Pro Insights</a>
<a href="#9-summary" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">9. Summary</a>
<a href="#1-core-concept" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">1. Core Concept</a>
<a href="#2-statistical-edge" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">2. Statistical Edge</a>
<a href="#3-actionable-strategy:-"multi-factor-long/short"" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">3. Actionable Strategy: "Multi-Factor Long/Short"</a>
<a href="#4-risks-&-limitations" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">4. Risks & Limitations</a>
<a href="#5-further-study" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">5. Further Study</a>
<a href="#55-related-indicators-comparison" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">5.5 Related Indicators Comparison</a>
<a href="#threshold-matrix" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Threshold Matrix</a>
<a href="#signal-patterns" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Signal Patterns</a>
<a href="#screening-filters" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Screening Filters</a>
<a href="#combination-strategies" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Combination Strategies</a>

                        </nav>
                        <div class="mt-8 pt-4 border-t border-slate-100">
                            <a href="#" class="text-xs text-slate-400 hover:text-indigo-600 flex items-center transition-colors">
                                Back to Top
                            </a>
                        </div>
                    </div>
                </aside>
            </div>
        </section>


    </div>


        <!-- Footer -->
    <footer class="bg-white border-t border-slate-200 mt-12">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <p class="text-center text-slate-400 text-sm">
                &copy; 2026 I ant I Investigates
            </p>
        </div>
    </footer>
        <!-- ========================================== -->
    <!-- 1. DATA & LOGIC INJECTION                  -->
    <!-- ========================================== -->
    <script>
        window.IndicatorLogic = {
            name: "FactorAnalysis",
            params: [],
            calculate: null
        };
        (function() {
            try {
                const injectedCode = `
        window.IndicatorLogic = {
            calculate: (data, params) => {
                const period = params.period || 14;
                const result = FactorAnalysis.calculate(data, period);
                // Handle both array and object returns
                if (Array.isArray(result)) {
                    return { main: result };
                }
                return result;
            }
        };
        `;
                const isTemplatePlaceholder = injectedCode.includes('{{') && injectedCode.includes('CODE_INDICATOR_LOGIC');
                if (injectedCode && injectedCode.trim().length > 0 && !isTemplatePlaceholder) {
                    new Function(injectedCode)();
                } else {
                    console.warn("Playground Logic: Running in Preview/Fallback mode.");
                    window.IndicatorLogic.calculate = () => []; 
                }
            } catch (e) {
                console.error("Critical Error in Logic Injection:", e);
                window.IndicatorLogic.calculate = () => [];
            }
        })();
    </script>

    <!-- ========================================== -->
    <!-- 2. VISUALIZATION ENGINE                    -->
    <!-- ========================================== -->
    <script>
        mermaid.initialize({ startOnLoad: false, theme: 'neutral', securityLevel: 'loose' });
    </script>
    <!-- ========================================== -->
    <!-- 3. UI CONTROLLERS & APP INITIALIZATION     -->
    <!-- ========================================== -->
    <!-- INLINE UI CONTROLLERS (PORTED FROM 0117) -->
    <script src="../assets/js/FactorAnalysis.js"></script>
    <!-- JSON Data Containers (XSS-safe) -->
    <script id="data-indicator-config" type="application/json">
[{"id": "period", "label": "Period (14)", "type": "number", "value": 14, "min": 2, "max": 100}]
    </script>
    <script id="data-indicator-display" type="application/json">
{"isOverlay": true, "plots": {"main": {"label": "FactorAnalysis", "color": "#4f46e5", "type": "line"}}}
    </script>
    <script>
        // --- 0. Indicator Data Injection ---
        // Use existing IndicatorLogic (set in earlier script block), only set if not exists
        var IndicatorLogic = window.IndicatorLogic || { calculate: null };
        var IndicatorConfig = [];
        var IndicatorDisplay = { isOverlay: false, plots: {} };

        // 1. Library Code - loaded externally before this block

        // 2. Configuration (XSS-safe via script type="application/json")
        try {
            var configEl = document.getElementById('data-indicator-config');
            if(configEl && configEl.textContent.trim()) {
                IndicatorConfig = JSON.parse(configEl.textContent);
            }
        } catch(e){ console.warn('Config parse error', e); }

        try {
            var displayEl = document.getElementById('data-indicator-display');
            if(displayEl && displayEl.textContent.trim()) {
                IndicatorDisplay = JSON.parse(displayEl.textContent);
            }
        } catch(e){ console.warn('Display parse error', e); }

        // 3. Logic Adapter
        window.IndicatorLogic = {
            calculate: (data, params) => {
                const period = params.period || 14;
                const result = FactorAnalysis.calculate(data, period);
                // Handle both array and object returns
                if (Array.isArray(result)) {
                    return { main: result };
                }
                return result;
            }
        };
    </script>

    <!-- UI Controllers: indicator.js loads first to define PlaygroundController -->
    <script src="../assets/js/indicator.js" defer></script>
    <!-- script.js loads second, skips PlaygroundController if already defined -->
    <script src="../assets/js/script.js" defer></script>

</body>
</html>