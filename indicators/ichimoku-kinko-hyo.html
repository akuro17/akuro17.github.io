<!DOCTYPE html>
<html lang="ja" class="scroll-smooth">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ichimoku Kinko Hyo - I ant I Investigates</title>
<meta name="description" content="">
<meta name="keywords" content="">
<script type="application/ld+json">
{
"@context": "https://schema.org",
"@type": "TechArticle",
"headline": "Ichimoku Kinko Hyo (Ichimoku Cloud)",
"description": "Comprehensive guide and interactive chart for Ichimoku Kinko Hyo indicator.",
"author": {
"@type": "Organization",
"name": "I and I Investigates"
}
}
</script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com?plugins=typography"></script>
<link rel="stylesheet" href="../../assets/css/style.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
<style>
/* =========================================
PORTED STYLES (From 0117 Template)
========================================= */
:root {
/* Minimal Variable Set for Logic Panel */
--bg-card: #FFFFFF;
--bg-secondary: #F8FAFC; /* slate-50 */
--bg-hover: #F1F5F9; /* slate-100 */
--border-color: #E2E8F0; /* slate-200 */
--text-primary: #1E293B; /* slate-800 */
--text-muted: #64748B; /* slate-500 */
--accent: #4F46E5; /* indigo-600 */
}
/* Logic Figure Container */
.logic-figure {
margin: 0;
background-color: var(--bg-card);
border: 1px solid var(--border-color);
border-radius: 0.5rem;
position: relative;
overflow: hidden;
height: 600px; /* Fixed height for infinite canvas feel */
}
/* Infinite Canvas Wrapper */
.chart-scroll-wrapper {
width: 100%;
height: 100%;
overflow: hidden;
position: relative;
background-color: #FFFFFF;
background-image: radial-gradient(#E2E8F0 1.5px, transparent 1.5px);
background-size: 20px 20px;
cursor: grab;
touch-action: none;
user-select: none;
}
.chart-scroll-wrapper:active { cursor: grabbing; }
/* Code Panel Overlay */
#code-panel-overlay {
position: absolute;
top: 0;
bottom: 0;
left: 0;
width: 500px;
max-width: 90%;
z-index: 30;
background-color: var(--bg-card);
border-right: 1px solid var(--border-color);
box-shadow: 4px 0 24px rgba(0, 0, 0, 0.1);
display: flex;
flex-direction: column;
transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1), width 0.3s ease;
transform: translateX(0);
}
#code-panel-overlay.panel-hidden {
transform: translateX(-100%);
pointer-events: none;
}
#code-panel-overlay.panel-expanded {
width: 100%;
max-width: 100%;
}
/* Code Content */
.code-panel-body {
background-color: #FAFAFA;
flex: 1;
overflow: auto;
font-family: 'Roboto Mono', monospace;
font-size: 0.85rem;
line-height: 1.5;
padding: 0.5rem 1rem 1rem 1rem; /* Reduced top padding */
white-space: pre; /* Essential for code indentation */
}
.code-content {
font-family: 'Roboto Mono', monospace;
font-size: 0.85rem;
line-height: 1.5;
padding: 1rem;
}
/* Toggle Button */
#code-panel-toggle-btn {
position: absolute;
top: 1rem;
left: 1rem;
z-index: 25;
background: white;
border: 1px solid var(--border-color);
border-radius: 0.5rem;
padding: 0.5rem;
cursor: pointer;
box-shadow: 0 2px 4px rgba(0,0,0,0.05);
transition: all 0.2s;
}
#code-panel-toggle-btn:hover {
color: var(--accent);
border-color: var(--accent);
}
/* Active States for Panel Buttons */
.btn-lang-active {
background-color: var(--accent) !important;
color: white !important;
}
.btn-type-active {
color: var(--text-primary) !important;
font-weight: bold;
text-decoration: underline;
text-decoration-color: var(--accent);
text-decoration-thickness: 2px;
}
/* Custom Scrollbar for Code Blocks */
pre::-webkit-scrollbar, .code-panel-body::-webkit-scrollbar {
height: 8px; width: 8px;
background-color: #f1f5f9;
}
pre::-webkit-scrollbar-thumb, .code-panel-body::-webkit-scrollbar-thumb {
background-color: #cbd5e1;
border-radius: 4px;
}
pre::-webkit-scrollbar-thumb:hover, .code-panel-body::-webkit-scrollbar-thumb:hover {
background-color: #94a3b8;
}
/* Pygments Syntax Highlighting */
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: #ffffcc }
.highlight .c { color: #008000 } /* Comment */
.highlight .err { border: 1px solid #F00 } /* Error */
.highlight .k { color: #00F } /* Keyword */
.highlight .ch { color: #008000 } /* Comment.Hashbang */
.highlight .cm { color: #008000 } /* Comment.Multiline */
.highlight .cp { color: #00F } /* Comment.Preproc */
.highlight .cpf { color: #008000 } /* Comment.PreprocFile */
.highlight .c1 { color: #008000 } /* Comment.Single */
.highlight .cs { color: #008000 } /* Comment.Special */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight .gh { font-weight: bold } /* Generic.Heading */
.highlight .gp { font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { font-weight: bold } /* Generic.Subheading */
.highlight .kc { color: #00F } /* Keyword.Constant */
.highlight .kd { color: #00F } /* Keyword.Declaration */
.highlight .kn { color: #00F } /* Keyword.Namespace */
.highlight .kp { color: #00F } /* Keyword.Pseudo */
.highlight .kr { color: #00F } /* Keyword.Reserved */
.highlight .kt { color: #2B91AF } /* Keyword.Type */
.highlight .s { color: #A31515 } /* Literal.String */
.highlight .nc { color: #2B91AF } /* Name.Class */
.highlight .ow { color: #00F } /* Operator.Word */
.highlight .sa { color: #A31515 } /* Literal.String.Affix */
.highlight .sb { color: #A31515 } /* Literal.String.Backtick */
.highlight .sc { color: #A31515 } /* Literal.String.Char */
.highlight .dl { color: #A31515 } /* Literal.String.Delimiter */
.highlight .sd { color: #A31515 } /* Literal.String.Doc */
.highlight .s2 { color: #A31515 } /* Literal.String.Double */
.highlight .se { color: #A31515 } /* Literal.String.Escape */
.highlight .sh { color: #A31515 } /* Literal.String.Heredoc */
.highlight .si { color: #A31515 } /* Literal.String.Interpol */
.highlight .sx { color: #A31515 } /* Literal.String.Other */
.highlight .sr { color: #A31515 } /* Literal.String.Regex */
.highlight .s1 { color: #A31515 } /* Literal.String.Single */
.highlight .ss { color: #A31515 } /* Literal.String.Symbol */
/* Mermaid Overrides */
.mermaid { transform-origin: 0 0; }
.noselect { user-select: none; -webkit-user-select: none; }
/* Legend Items */
.logic-legend {
border-top: 1px solid var(--border-color);
padding: 1rem;
background-color: var(--bg-card);
display: flex;
flex-wrap: wrap;
justify-content: center;
gap: 1.5rem;
position: relative;
z-index: 20;
}
.legend-item {
display: flex;
align-items: center;
gap: 0.5rem;
font-size: 0.8rem;
color: var(--text-muted);
font-weight: 500;
}
.legend-dot {
width: 10px;
height: 10px;
border-radius: 50%;
border: 1px solid;
}
.l-ingestion { background: #E8F0FE; border-color: #4285F4; }
.l-evaluation { background: #FEF7E0; border-color: #FBBC04; }
.l-weighting { background: #F3E8FD; border-color: #A142F4; }
.l-synthesis { background: #E0F7FA; border-color: #12B5CB; }
.l-outcome { background: #E6F4EA; border-color: #34A853; }
/* TOC Active State Styling */
.toc-link.active {
color: #4f46e5;
border-left-color: #4f46e5;
background-color: #eef2ff;
}
</style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans antialiased relative">
<nav class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
<div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8">
<div class="flex justify-between h-16">
<div class="flex items-center">
<div class="flex-shrink-0 flex items-center mr-6">
<a href="../index.html" class="font-bold text-xl text-indigo-600">
I ant I Investigates
</a>
</div>
<nav class="hidden md:flex text-sm text-slate-500 mr-8" aria-label="Breadcrumb">
<ol class="flex items-center space-x-2">
<li><a href="../index.html" class="hover:text-indigo-600 transition-colors">home</a></li>
<li><span class="mx-1">/</span></li>
<li><a href="./" class="hover:text-indigo-600 transition-colors">indicators</a></li>
<li><span class="mx-1">/</span></li>
<li><span class="font-medium text-slate-900">Ichimoku</span></li>
</ol>
</nav>
<div class="hidden sm:flex sm:space-x-4 items-center">
<a href="#interactive-playground" class="text-slate-600 hover:text-indigo-600 px-3 py-2 text-sm font-medium transition-colors">
Chart
</a>
<a href="#logic-visualization" class="text-slate-600 hover:text-indigo-600 px-3 py-2 text-sm font-medium transition-colors">
Logic
</a>
<a href="#documentation" class="text-slate-600 hover:text-indigo-600 px-3 py-2 text-sm font-medium transition-colors">
Docs
</a>
</div>
</div>
<div class="hidden sm:flex items-center">
</div>
</div>
</div>
</nav>
<div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12">
<div class="flex flex-col gap-6">
<header>
<h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4 leading-tight">Ichimoku Kinko Hyo (Cloud)</h1>
<p class="text-lg text-slate-600 leading-relaxed">Ichimoku is a comprehensive technical analysis system that defines support, resistance, trend direction, and momentum in a single glance through five interrelated components and a projected "cloud" of equilibrium.</p>
</header>
<section id="interactive-playground" class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden scroll-mt-24">
<div class="border-b border-slate-200 bg-indigo-50 px-6 py-4">
<h2 class="text-lg font-bold text-slate-800 flex items-center">
<span class="bg-indigo-600 text-white p-1 rounded mr-3 text-xs shadow-sm font-mono">C</span>
Calculator
</h2>
<p class="text-sm text-slate-600 mt-2">Calculate indicator values from your price data.</p>
</div>
<div class="p-6">
<div class="relative h-[400px] w-full mb-6 border border-slate-100 rounded bg-slate-50">
<canvas id="indicatorChart"></canvas>
</div>
<div id="controls" class="grid grid-cols-1 md:grid-cols-3 gap-6 bg-slate-50 p-4 rounded border border-slate-200">
<div class="md:col-span-1 space-y-4">
<h3 class="font-bold text-sm text-slate-700 uppercase tracking-wide border-b border-slate-200 pb-2">Parameters</h3>
<div id="settings-container">
<div class="space-y-3">
</div>
</div>
<button id="btn-run" onclick="PlaygroundController.update()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition-colors shadow-sm flex items-center justify-center">
Calculate
</button>
</div>
<div class="md:col-span-2 space-y-4">
<div class="space-y-2">
<div class="flex justify-between items-center pb-2 border-b border-slate-200">
<h3 class="font-bold text-sm text-slate-700 uppercase tracking-wide">Input Data (CSV)</h3>
<div class="flex space-x-2">
<button id="btn-load-sample-ohlcv" class="text-xs text-indigo-600 hover:text-indigo-800 hover:underline transition-colors" title="Load OHLCV Sample Data">Shape (OHLCV)</button>
<span class="text-slate-300">|</span>
<button id="btn-load-sample-single" class="text-xs text-indigo-600 hover:text-indigo-800 hover:underline transition-colors" title="Load Single Value Sample Data">Single</button>
</div>
</div>
<p class="text-xs text-slate-500">Enter CSV data (Date,Open,High,Low,Close,Volume) or single values.</p>
<textarea id="input-data" class="w-full h-24 p-2 text-xs font-mono border border-slate-300 rounded focus:ring-2 focus:ring-indigo-500 transition-shadow" placeholder="e.g. 100.5, 101.2, 99.8, 102.3, 103.1...
or one per line:
100.5
101.2
99.8"></textarea>
</div>
<div class="space-y-2">
<div class="flex justify-between items-center pb-2 border-b border-slate-200">
<h3 class="font-bold text-sm text-slate-700 uppercase tracking-wide">Output Data (Result)</h3>
</div>
<textarea id="output-data" class="w-full h-24 p-2 text-xs font-mono border border-slate-300 rounded bg-slate-100 text-slate-600" readonly placeholder="Calculation results will appear here..."></textarea>
</div>
</div>
</div>
</div>
</section>
</div>
<section id="logic-visualization" class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden scroll-mt-24">
<div class="border-b border-slate-200 bg-emerald-50 px-6 py-4">
<h2 class="text-lg font-bold text-slate-800 flex items-center">
<span class="bg-emerald-600 text-white p-1 rounded mr-3 text-xs shadow-sm font-mono">L</span>
Logic & Code Architecture
</h2>
<p class="text-sm text-slate-600 mt-2">Visual flowchart showing how the indicator processes data.</p>
</div>
<figure class="logic-figure" style="border: none; border-radius: 0;">
<button id="code-panel-toggle-btn" onclick="toggleCodePanel()" title="View Source Code" class="font-bold text-xs">
CODE
</button>
<div id="canvas-container" class="chart-scroll-wrapper">
<div id="canvas-content" class="mermaid" style="position: absolute; top:0; left:0;">
flowchart TD;
subgraph INGESTION["Phase 1: Ingestion"];
A[/"Receive OHLC Price Data"/];
B["Capture High/Low Extremes"];
C["Collect Multi-Timeframe Inputs"];
end;
subgraph EVALUATION["Phase 2: Evaluation"];
D["Calculate Short-Term Equilibrium"];
E["Calculate Medium-Term Equilibrium"];
F["Calculate Long-Term Equilibrium"];
G["Reference Historical Close"];
end;
subgraph WEIGHTING["Phase 3: Weighting"];
H["Derive Tenkan-sen Midpoint"];
I["Derive Kijun-sen Midpoint"];
J["Project Future Cloud Boundaries"];
K["Position Lagging Span Historically"];
end;
subgraph SYNTHESIS["Phase 4: Synthesis"];
L["Construct Forward Kumo Cloud"];
M["Assess Cloud Thickness"];
N["Determine Trend Alignment"];
end;
subgraph OUTCOME["Phase 5: Outcome"];
O{"Full Confluence Check?"};
P["Above Cloud + TK Bullish + Chikou Clear = Strong Buy"];
Q["Below Cloud + TK Bearish + Chikou Trapped = Strong Sell"];
R["Inside Cloud = Await Clarity"];
S[/"Generate Multi-Timeframe Equilibrium Signal"/];
end;
A --> B;
B --> C;
C --> D;
D --> E;
E --> F;
F --> G;
G --> H;
H --> I;
I --> J;
J --> K;
K --> L;
L --> M;
M --> N;
N --> O;
O -->|Bullish Alignment| P;
O -->|Bearish Alignment| Q;
O -->|Neutral| R;
P --> S;
Q --> S;
R --> S;
style INGESTION fill:#e3f2fd;
style EVALUATION fill:#fff3e0;
style WEIGHTING fill:#e8f5e9;
style SYNTHESIS fill:#fce4ec;
style OUTCOME fill:#f3e5f5;
</div>
</div>
<div class="absolute top-4 right-4 flex flex-col gap-2 z-20">
<button onclick="if(window.resetView) window.resetView()" class="p-2 bg-white rounded shadow border border-slate-200 hover:bg-slate-50 text-slate-600 font-mono text-xs" title="Reset View">R</button>
<button onclick="if(window.zoomAction) window.zoomAction('in')" class="p-2 bg-white rounded shadow border border-slate-200 hover:bg-slate-50 text-slate-600 font-mono text-xs" title="Zoom In">+</button>
<button onclick="if(window.zoomAction) window.zoomAction('out')" class="p-2 bg-white rounded shadow border border-slate-200 hover:bg-slate-50 text-slate-600 font-mono text-xs" title="Zoom Out">-</button>
</div>
<div id="code-panel-overlay" class="panel-hidden" onmousedown="event.stopPropagation();">
<div class="flex justify-between items-center p-3 border-b border-slate-200 bg-slate-50 shrink-0">
<div class="flex gap-2">
<button id="btn-lang-csharp" class="px-2 py-1 text-xs rounded transition-colors text-slate-500 hover:bg-slate-100" onclick="setLang('csharp')">C#</button>
<button id="btn-lang-python" class="px-2 py-1 text-xs rounded transition-colors text-slate-500 hover:bg-slate-100" onclick="setLang('python')">Python</button>
</div>
<div class="flex items-center gap-2">
<button id="btn-type-simple" class="text-xs text-slate-500 hover:text-indigo-600 transition-colors" onclick="setType('simple')">Simple</button>
<button id="btn-type-detailed" class="text-xs text-slate-500 hover:text-indigo-600 transition-colors" onclick="setType('detailed')">Detailed</button>
<button id="btn-copy-code" class="ml-2 text-slate-500 hover:text-slate-800 transition-colors" onclick="copyCode()" title="Copy Code">
<svg id="icon-copy" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
<rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
<path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
</svg>
<svg id="icon-copy-done" class="hidden text-green-600" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
<polyline points="20 6 9 17 4 12"></polyline>
</svg>
</button>
<button id="btn-panel-expand" class="text-slate-500 hover:text-slate-800 transition-colors" onclick="toggleExpand()" title="Toggle Width">
<svg id="icon-expand" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M15 3h6v6" /><path d="M9 21H3v-6" /><path d="M21 3l-7 7" /><path d="M3 21l7-7" />
</svg>
<svg id="icon-collapse" class="hidden" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<path d="M4 14h6v6" /><path d="M20 10h-6V4" /><path d="M14 10l7-7" /><path d="M10 14l-7 7" />
</svg>
</button>
<button class="text-slate-500 hover:text-red-600 transition-colors" onclick="toggleCodePanel()" title="Close Panel">
<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
<line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" />
</svg>
</button>
</div>
</div>
<div class="code-panel-body custom-scrollbar p-4">
<div id="code-csharp-simple" class="code-content hidden"><div class="highlight"><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">1</span><span class="k">using</span> System;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">2</span><span class="k">using</span> System.Collections.Generic;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">3</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">4</span><span class="k">namespace</span> TechnicalIndicators</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">5</span>{</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">6</span>    <span class="c1">/// &lt;summary&gt;</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">7</span>    <span class="c1">/// Ichimoku Kinko Hyo (Cloud)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">8</span>    <span class="c1">/// &lt;/summary&gt;</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">9</span>    <span class="c1">/// &lt;remarks&gt;</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">10</span>    <span class="c1">/// A comprehensive trend forecasting system.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">11</span>    <span class="c1">/// &lt;list type=&quot;bullet&quot;&gt;</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">12</span>    <span class="c1">/// &lt;item&gt;&lt;description&gt;Tenkan (Signal): (Highest High + Lowest Low) / 2 [9 periods]&lt;/description&gt;&lt;/item&gt;</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">13</span>    <span class="c1">/// &lt;item&gt;&lt;description&gt;Kijun (Base): (Highest High + Lowest Low) / 2 [26 periods]&lt;/description&gt;&lt;/item&gt;</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">14</span>    <span class="c1">/// &lt;item&gt;&lt;description&gt;Span A: (Tenkan + Kijun) / 2 [Shifted forward 26 periods]&lt;/description&gt;&lt;/item&gt;</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">15</span>    <span class="c1">/// &lt;item&gt;&lt;description&gt;Span B: (Highest High + Lowest Low) / 2 [52 periods, Shifted forward 26 periods]&lt;/description&gt;&lt;/item&gt;</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">16</span>    <span class="c1">/// &lt;item&gt;&lt;description&gt;Chikou (Lagging): Close [Shifted back 26 periods]&lt;/description&gt;&lt;/item&gt;</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">17</span>    <span class="c1">/// &lt;/list&gt;</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">18</span>    <span class="c1">/// &lt;/remarks&gt;</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">19</span>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Ichimoku</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">20</span>    {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">21</span>        <span class="k">public</span> <span class="kt">int</span> TenkanPeriod { <span class="k">get</span>; }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">22</span>        <span class="k">public</span> <span class="kt">int</span> KijunPeriod { <span class="k">get</span>; }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">23</span>        <span class="k">public</span> <span class="kt">int</span> SenkouSpanBPeriod { <span class="k">get</span>; }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">24</span>        <span class="k">public</span> <span class="kt">int</span> Displacement { <span class="k">get</span>; }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">25</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">26</span>        <span class="k">public</span> List&lt;<span class="kt">decimal?</span>&gt; TenkanSen { <span class="k">get</span>; } = <span class="k">new</span>();</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">27</span>        <span class="k">public</span> List&lt;<span class="kt">decimal?</span>&gt; KijunSen { <span class="k">get</span>; } = <span class="k">new</span>();</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">28</span>        <span class="k">public</span> List&lt;<span class="kt">decimal?</span>&gt; SenkouSpanA { <span class="k">get</span>; } = <span class="k">new</span>();</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">29</span>        <span class="k">public</span> List&lt;<span class="kt">decimal?</span>&gt; SenkouSpanB { <span class="k">get</span>; } = <span class="k">new</span>();</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">30</span>        <span class="k">public</span> List&lt;<span class="kt">decimal?</span>&gt; ChikouSpan { <span class="k">get</span>; } = <span class="k">new</span>();</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">31</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">32</span>        <span class="k">public</span> Ichimoku(<span class="kt">int</span> tenkanPeriod = 9, <span class="kt">int</span> kijunPeriod = 26, <span class="kt">int</span> senkouSpanBPeriod = 52, <span class="kt">int</span> displacement = 26)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">33</span>        {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">34</span>            TenkanPeriod = tenkanPeriod;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">35</span>            KijunPeriod = kijunPeriod;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">36</span>            SenkouSpanBPeriod = senkouSpanBPeriod;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">37</span>            Displacement = displacement;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">38</span>        }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">39</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">40</span>        <span class="k">public</span> <span class="k">void</span> Calculate(IEnumerable&lt;CandleData&gt; candles)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">41</span>        {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">42</span>            TenkanSen.Clear(); KijunSen.Clear();</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">43</span>            SenkouSpanA.Clear(); SenkouSpanB.Clear(); ChikouSpan.Clear();</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">44</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">45</span>            <span class="kt">var</span> candleList = <span class="k">new</span> List&lt;CandleData&gt;(candles);</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">46</span>            <span class="k">if</span> (candleList.Count == 0) <span class="k">return</span>;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">47</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">48</span>            <span class="c1">// Step 1: Calculate Base Lines</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">49</span>            <span class="k">for</span> (<span class="kt">int</span> i = 0; i &lt; candleList.Count; i++)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">50</span>            {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">51</span>                TenkanSen.Add(CalculateMidpoint(candleList, i, TenkanPeriod));</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">52</span>                KijunSen.Add(CalculateMidpoint(candleList, i, KijunPeriod));</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">53</span>            }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">54</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">55</span>            <span class="c1">// Step 2: Calculate Spans (Cloud) - Shifted Forward logic handled by &quot;Current Bar Calculation&quot; usually</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">56</span>            <span class="c1">// However, typical plotting shifts them. Here we calculate values for the current bar.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">57</span>            <span class="c1">// Note: C# Implementation aligns value generation to the current index. Plotting handles shift or lists are shifted?</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">58</span>            <span class="c1">// Checking source: Source logic stores values at &#x27;i&#x27;. </span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">59</span>            <span class="c1">// SenkouSpanA = (Tenkan + Kijun) / 2</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">60</span>            <span class="c1">// SenkouSpanB = Midpoint(52)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">61</span>            </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">62</span>            <span class="k">for</span> (<span class="kt">int</span> i = 0; i &lt; candleList.Count; i++)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">63</span>            {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">64</span>                <span class="k">if</span> (TenkanSen[i].HasValue &amp;&amp; KijunSen[i].HasValue)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">65</span>                    SenkouSpanA.Add((TenkanSen[i]!.Value + KijunSen[i]!.Value) / 2);</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">66</span>                <span class="k">else</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">67</span>                    SenkouSpanA.Add(<span class="k">null</span>);</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">68</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">69</span>                SenkouSpanB.Add(CalculateMidpoint(candleList, i, SenkouSpanBPeriod));</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">70</span>            }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">71</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">72</span>            <span class="c1">// Step 3: Lagging Span (Chikou)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">73</span>            <span class="c1">// Stored at current index &#x27;i&#x27;. Usually plotted at i-26.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">74</span>            <span class="k">for</span> (<span class="kt">int</span> i = 0; i &lt; candleList.Count; i++)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">75</span>            {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">76</span>                ChikouSpan.Add(candleList[i].Close);</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">77</span>            }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">78</span>        }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">79</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">80</span>        <span class="k">private</span> <span class="k">static</span> <span class="kt">decimal?</span> CalculateMidpoint(List&lt;CandleData&gt; candles, <span class="kt">int</span> index, <span class="kt">int</span> period)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">81</span>        {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">82</span>            <span class="k">if</span> (index &lt; period - 1) <span class="k">return</span> <span class="k">null</span>;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">83</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">84</span>            <span class="kt">decimal</span> highest = <span class="kt">decimal</span>.MinValue;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">85</span>            <span class="kt">decimal</span> lowest = <span class="kt">decimal</span>.MaxValue;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">86</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">87</span>            <span class="k">for</span> (<span class="kt">int</span> i = index - period + 1; i &lt;= index; i++)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">88</span>            {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">89</span>                <span class="k">if</span> (candles[i].High &gt; highest) highest = candles[i].High;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">90</span>                <span class="k">if</span> (candles[i].Low &lt; lowest) lowest = candles[i].Low;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">91</span>            }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">92</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">93</span>            <span class="k">return</span> (highest + lowest) / 2;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">94</span>        }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">95</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">96</span>        <span class="k">public</span> static (List&lt;<span class="kt">decimal?</span>&gt; tenkan, List&lt;<span class="kt">decimal?</span>&gt; kijun, List&lt;<span class="kt">decimal?</span>&gt; spanA, List&lt;<span class="kt">decimal?</span>&gt; spanB, List&lt;<span class="kt">decimal?</span>&gt; chikou) Calculate(</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">97</span>            IEnumerable&lt;CandleData&gt; candles, <span class="kt">int</span> tenkan = 9, <span class="kt">int</span> kijun = 26, <span class="kt">int</span> spanB = 52, <span class="kt">int</span> displacement = 26)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">98</span>        {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">99</span>            <span class="kt">var</span> ichi = <span class="k">new</span> Ichimoku(tenkan, kijun, spanB, displacement);</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">100</span>            ichi.Calculate(candles);</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">101</span>            <span class="k">return</span> (ichi.TenkanSen, ichi.KijunSen, ichi.SenkouSpanA, ichi.SenkouSpanB, ichi.ChikouSpan);</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">102</span>        }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">103</span>    }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">104</span>}</div></div></div>
<div id="code-csharp-detailed" class="code-content hidden"><div class="highlight"><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">1</span><span class="c1">// =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">2</span><span class="c1">// Logic Breakdown (Ichimoku Kinko Hyo)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">3</span><span class="c1">// =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">4</span><span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">5</span><span class="c1">// This document provides a &quot;Deep Dive&quot; into the internal logic of the</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">6</span><span class="c1">// Ichimoku Kinko Hyo (Ichimoku Cloud) technical indicator.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">7</span><span class="c1">// We explain *why* code is written this way and *how* data transforms</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">8</span><span class="c1">// line-by-line, targeting programming beginners.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">9</span><span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">10</span><span class="c1">// [Core Concepts]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">11</span><span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">12</span><span class="c1">// 1. What is Ichimoku?</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">13</span><span class="c1">//    [Origin]  Developed in Japan by Goichi Hosoda over 30 years of research.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">14</span><span class="c1">//              Name means &quot;One glance equilibrium chart&quot;.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">15</span><span class="c1">//    [Purpose] A comprehensive system that shows support/resistance, trend,</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">16</span><span class="c1">//              and momentum ALL IN ONE VIEW.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">17</span><span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">18</span><span class="c1">// 2. The Five Components</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">19</span><span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">20</span><span class="c1">//    | Line            | Calculation                          | Default |</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">21</span><span class="c1">//    |-----------------|--------------------------------------|---------|</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">22</span><span class="c1">//    | Tenkan-Sen      | (Highest High + Lowest Low) / 2      | 9 bars  |</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">23</span><span class="c1">//    | Kijun-Sen       | (Highest High + Lowest Low) / 2      | 26 bars |</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">24</span><span class="c1">//    | Senkou Span A   | (Tenkan + Kijun) / 2, shifted forward| 26 bars |</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">25</span><span class="c1">//    | Senkou Span B   | (HH + LL) / 2, shifted forward       | 52 bars |</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">26</span><span class="c1">//    | Chikou Span     | Current Close, shifted backward      | 26 bars |</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">27</span><span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">28</span><span class="c1">// 3. The Cloud (Kumo)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">29</span><span class="c1">//    [What] The shaded area between Senkou Span A and Senkou Span B.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">30</span><span class="c1">//    [Visual]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">31</span><span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">32</span><span class="c1">//    Price:     ~~~@~~~@~~~~</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">33</span><span class="c1">//               ~~~~~~~~~~~~   Senkou Span A</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">34</span><span class="c1">//                  The &quot;Cloud&quot; (Kumo)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">35</span><span class="c1">//               ~~~~~~~~~~~~   Senkou Span B</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">36</span><span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">37</span><span class="c1">//    [Interpretation]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">38</span><span class="c1">//    - Price ABOVE Cloud = Bullish</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">39</span><span class="c1">//    - Price BELOW Cloud = Bearish</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">40</span><span class="c1">//    - Cloud Twist       = Potential Trend Reversal</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">41</span><span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">42</span><span class="c1">// 4. Signal Interpretation</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">43</span><span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">44</span><span class="c1">//    | Signal             | Condition                             |</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">45</span><span class="c1">//    |--------------------|---------------------------------------|</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">46</span><span class="c1">//    | Strong Buy         | Price above cloud, Tenkan &gt; Kijun     |</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">47</span><span class="c1">//    | Strong Sell        | Price below cloud, Tenkan &lt; Kijun     |</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">48</span><span class="c1">//    | Cloud Twist        | Span A crosses Span B (trend change)  |</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">49</span><span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">50</span><span class="c1">// =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">51</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">52</span><span class="k">using</span> System;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">53</span><span class="k">using</span> System.Collections.Generic;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">54</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">55</span><span class="k">namespace</span> TechnicalIndicators</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">56</span>{</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">57</span>    <span class="c1">// =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">58</span>    <span class="c1">// Logic Explanation: OHLCV Data Container</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">59</span>    <span class="c1">// =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">60</span>    <span class="k">public</span> <span class="k">readonly</span> <span class="k">record</span> <span class="k">struct</span> CandleData(</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">61</span>        DateTime Timestamp,</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">62</span>        <span class="kt">decimal</span> Open,</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">63</span>        <span class="kt">decimal</span> High,</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">64</span>        <span class="kt">decimal</span> Low,</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">65</span>        <span class="kt">decimal</span> Close,</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">66</span>        <span class="kt">long</span> Volume</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">67</span>    );</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">68</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">69</span>    <span class="c1">// =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">70</span>    <span class="c1">// Logic Explanation: Ichimoku Class</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">71</span>    <span class="c1">// =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">72</span>    <span class="k">public</span> <span class="k">class</span> <span class="nc">Ichimoku</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">73</span>    {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">74</span>        <span class="c1">// -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">75</span>        <span class="c1">// Logic Explanation: Configuration Parameters</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">76</span>        <span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">77</span>        <span class="c1">// [Why] The traditional values (9, 26, 52) were based on a</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">78</span>        <span class="c1">//       6-day trading week in Japan (9 days  1.5 weeks etc.)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">79</span>        <span class="c1">//       Modern markets may use different values.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">80</span>        <span class="c1">// -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">81</span>        <span class="k">public</span> <span class="kt">int</span> TenkanPeriod { <span class="k">get</span>; }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">82</span>        <span class="k">public</span> <span class="kt">int</span> KijunPeriod { <span class="k">get</span>; }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">83</span>        <span class="k">public</span> <span class="kt">int</span> SenkouSpanBPeriod { <span class="k">get</span>; }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">84</span>        <span class="k">public</span> <span class="kt">int</span> Displacement { <span class="k">get</span>; }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">85</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">86</span>        <span class="c1">// -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">87</span>        <span class="c1">// Logic Explanation: Output Lists (One per Component)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">88</span>        <span class="c1">// -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">89</span>        <span class="k">public</span> List&lt;<span class="kt">decimal?</span>&gt; TenkanSen { <span class="k">get</span>; } = <span class="k">new</span>();</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">90</span>        <span class="k">public</span> List&lt;<span class="kt">decimal?</span>&gt; KijunSen { <span class="k">get</span>; } = <span class="k">new</span>();</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">91</span>        <span class="k">public</span> List&lt;<span class="kt">decimal?</span>&gt; SenkouSpanA { <span class="k">get</span>; } = <span class="k">new</span>();</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">92</span>        <span class="k">public</span> List&lt;<span class="kt">decimal?</span>&gt; SenkouSpanB { <span class="k">get</span>; } = <span class="k">new</span>();</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">93</span>        <span class="k">public</span> List&lt;<span class="kt">decimal?</span>&gt; ChikouSpan { <span class="k">get</span>; } = <span class="k">new</span>();</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">94</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">95</span>        <span class="c1">// =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">96</span>        <span class="c1">// Logic Explanation: Constructor</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">97</span>        <span class="c1">// =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">98</span>        <span class="k">public</span> Ichimoku(<span class="kt">int</span> tenkanPeriod = 9, <span class="kt">int</span> kijunPeriod = 26, <span class="kt">int</span> senkouSpanBPeriod = 52, <span class="kt">int</span> displacement = 26)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">99</span>        {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">100</span>            TenkanPeriod = tenkanPeriod;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">101</span>            KijunPeriod = kijunPeriod;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">102</span>            SenkouSpanBPeriod = senkouSpanBPeriod;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">103</span>            Displacement = displacement;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">104</span>        }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">105</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">106</span>        <span class="c1">// =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">107</span>        <span class="c1">// Logic Explanation: Main Calculation Method</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">108</span>        <span class="c1">// =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">109</span>        <span class="k">public</span> <span class="k">void</span> Calculate(IEnumerable&lt;CandleData&gt; candles)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">110</span>        {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">111</span>            <span class="c1">// -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">112</span>            <span class="c1">// Step 1: Cleanup</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">113</span>            <span class="c1">// -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">114</span>            TenkanSen.Clear();</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">115</span>            KijunSen.Clear();</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">116</span>            SenkouSpanA.Clear();</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">117</span>            SenkouSpanB.Clear();</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">118</span>            ChikouSpan.Clear();</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">119</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">120</span>            <span class="kt">var</span> candleList = <span class="k">new</span> List&lt;CandleData&gt;(candles);</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">121</span>            <span class="k">if</span> (candleList.Count == 0) <span class="k">return</span>;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">122</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">123</span>            <span class="c1">// -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">124</span>            <span class="c1">// Step 2: Calculate Tenkan-Sen and Kijun-Sen</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">125</span>            <span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">126</span>            <span class="c1">// [Visual: Midpoint Calculation]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">127</span>            <span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">128</span>            <span class="c1">//   Window: [Candle_{i-Period+1}, ..., Candle_i]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">129</span>            <span class="c1">//   Find:   Highest High (HH), Lowest Low (LL)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">130</span>            <span class="c1">//   Result: (HH + LL) / 2</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">131</span>            <span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">132</span>            <span class="c1">//   Example (Period=3):</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">133</span>            <span class="c1">//     Highs: [10, 12, 11] -&gt; HH = 12</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">134</span>            <span class="c1">//     Lows:  [8, 9, 7]    -&gt; LL = 7</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">135</span>            <span class="c1">//     Midpoint = (12 + 7) / 2 = 9.5</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">136</span>            <span class="c1">// -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">137</span>            <span class="k">for</span> (<span class="kt">int</span> i = 0; i &lt; candleList.Count; i++)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">138</span>            {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">139</span>                TenkanSen.Add(CalculateMidpoint(candleList, i, TenkanPeriod));</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">140</span>                KijunSen.Add(CalculateMidpoint(candleList, i, KijunPeriod));</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">141</span>            }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">142</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">143</span>            <span class="c1">// -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">144</span>            <span class="c1">// Step 3: Calculate Senkou Span A and Senkou Span B</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">145</span>            <span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">146</span>            <span class="c1">// [Formula]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">147</span>            <span class="c1">//   Senkou Span A = (Tenkan + Kijun) / 2</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">148</span>            <span class="c1">//   Senkou Span B = Midpoint(52 period)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">149</span>            <span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">150</span>            <span class="c1">// [Note] In charting, these are typically displayed shifted</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">151</span>            <span class="c1">//        FORWARD by &#x27;Displacement&#x27; periods. This code computes</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">152</span>            <span class="c1">//        the raw values; shifting is a display concern.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">153</span>            <span class="c1">// -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">154</span>            <span class="k">for</span> (<span class="kt">int</span> i = 0; i &lt; candleList.Count; i++)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">155</span>            {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">156</span>                <span class="c1">// Senkou Span A: Average of Tenkan and Kijun</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">157</span>                <span class="k">if</span> (TenkanSen[i].HasValue &amp;&amp; KijunSen[i].HasValue)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">158</span>                {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">159</span>                    SenkouSpanA.Add((TenkanSen[i]!.Value + KijunSen[i]!.Value) / 2);</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">160</span>                }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">161</span>                <span class="k">else</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">162</span>                {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">163</span>                    SenkouSpanA.Add(<span class="k">null</span>);</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">164</span>                }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">165</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">166</span>                <span class="c1">// Senkou Span B: 52-period midpoint</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">167</span>                SenkouSpanB.Add(CalculateMidpoint(candleList, i, SenkouSpanBPeriod));</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">168</span>            }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">169</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">170</span>            <span class="c1">// -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">171</span>            <span class="c1">// Step 4: Calculate Chikou Span</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">172</span>            <span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">173</span>            <span class="c1">// [What] Chikou Span is simply the current close price.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">174</span>            <span class="c1">// [Display] In charting, it is plotted BACKWARD by &#x27;Displacement&#x27;.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">175</span>            <span class="c1">//           This allows comparison of current price to past price action.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">176</span>            <span class="c1">// -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">177</span>            <span class="k">for</span> (<span class="kt">int</span> i = 0; i &lt; candleList.Count; i++)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">178</span>            {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">179</span>                ChikouSpan.Add(candleList[i].Close);</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">180</span>            }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">181</span>        }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">182</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">183</span>        <span class="c1">// =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">184</span>        <span class="c1">// Helper Method: CalculateMidpoint</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">185</span>        <span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">186</span>        <span class="c1">// [IPO Block]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">187</span>        <span class="c1">// Input:   List&lt;CandleData&gt; candles, int index, int period</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">188</span>        <span class="c1">// Process: Finds (Highest High + Lowest Low) / 2 over the window</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">189</span>        <span class="c1">// Output:  decimal? midpoint, or null if insufficient data</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">190</span>        <span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">191</span>        <span class="c1">// [Visual]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">192</span>        <span class="c1">//   Window: [Candle_{index-period+1} ... Candle_{index}]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">193</span>        <span class="c1">//                                                   </span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">194</span>        <span class="c1">//           Start of window                   End of window (current)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">195</span>        <span class="c1">// =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">196</span>        <span class="k">private</span> <span class="k">static</span> <span class="kt">decimal?</span> CalculateMidpoint(List&lt;CandleData&gt; candles, <span class="kt">int</span> index, <span class="kt">int</span> period)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">197</span>        {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">198</span>            <span class="c1">// [Check] Need enough historical data</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">199</span>            <span class="k">if</span> (index &lt; period - 1) <span class="k">return</span> <span class="k">null</span>;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">200</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">201</span>            <span class="kt">decimal</span> highest = <span class="kt">decimal</span>.MinValue;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">202</span>            <span class="kt">decimal</span> lowest = <span class="kt">decimal</span>.MaxValue;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">203</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">204</span>            <span class="c1">// Scan through the window</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">205</span>            <span class="k">for</span> (<span class="kt">int</span> i = index - period + 1; i &lt;= index; i++)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">206</span>            {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">207</span>                <span class="k">if</span> (candles[i].High &gt; highest)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">208</span>                    highest = candles[i].High;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">209</span>                </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">210</span>                <span class="k">if</span> (candles[i].Low &lt; lowest)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">211</span>                    lowest = candles[i].Low;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">212</span>            }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">213</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">214</span>            <span class="c1">// [Formula] Midpoint = (Highest + Lowest) / 2</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">215</span>            <span class="k">return</span> (highest + lowest) / 2;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">216</span>        }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">217</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">218</span>        <span class="c1">// =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">219</span>        <span class="c1">// Logic Explanation: Static Convenience Wrapper</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">220</span>        <span class="c1">//</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">221</span>        <span class="c1">// [IPO Block]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">222</span>        <span class="c1">// Input:   IEnumerable&lt;CandleData&gt;, parameter overrides</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">223</span>        <span class="c1">// Process: Creates instance, runs Calculate()</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">224</span>        <span class="c1">// Output:  Tuple of all 5 component lists</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">225</span>        <span class="c1">// =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">226</span>        <span class="k">public</span> static (List&lt;<span class="kt">decimal?</span>&gt; tenkan, List&lt;<span class="kt">decimal?</span>&gt; kijun, List&lt;<span class="kt">decimal?</span>&gt; spanA, List&lt;<span class="kt">decimal?</span>&gt; spanB, List&lt;<span class="kt">decimal?</span>&gt; chikou) Calculate(</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">227</span>            IEnumerable&lt;CandleData&gt; candles, <span class="kt">int</span> tenkan = 9, <span class="kt">int</span> kijun = 26, <span class="kt">int</span> spanB = 52, <span class="kt">int</span> displacement = 26)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">228</span>        {</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">229</span>            <span class="kt">var</span> ichi = <span class="k">new</span> Ichimoku(tenkan, kijun, spanB, displacement);</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">230</span>            ichi.Calculate(candles);</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">231</span>            <span class="k">return</span> (ichi.TenkanSen, ichi.KijunSen, ichi.SenkouSpanA, ichi.SenkouSpanB, ichi.ChikouSpan);</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">232</span>        }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">233</span>    }</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">234</span>}</div></div></div>
<div id="code-python-simple" class="code-content hidden"><div class="highlight"><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">1</span><span class="k">class</span> <span class="nc">Ichimoku</span>:</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">2</span>    <span class="sd">&quot;&quot;&quot;</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">3</span><span class="sd">    Ichimoku Kinko Hyo</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">4</span><span class="sd">    Comprehensive trend forecasting.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">5</span><span class="sd">    &quot;&quot;&quot;</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">6</span>    <span class="k">def</span> __init__(self, tenkan_period=9, kijun_period=26, span_b_period=52, displacement=26):</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">7</span>        self.tenkan_period = tenkan_period</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">8</span>        self.kijun_period = kijun_period</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">9</span>        self.span_b_period = span_b_period</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">10</span>        self.displacement = displacement</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">11</span>        </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">12</span>        self.tenkan_sen = []</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">13</span>        self.kijun_sen = []</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">14</span>        self.senkou_span_a = []</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">15</span>        self.senkou_span_b = []</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">16</span>        self.chikou_span = []</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">17</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">18</span>    <span class="k">def</span> calculate(self, candles):</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">19</span>        self.tenkan_sen.clear()</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">20</span>        self.kijun_sen.clear()</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">21</span>        self.senkou_span_a.clear()</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">22</span>        self.senkou_span_b.clear()</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">23</span>        self.chikou_span.clear()</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">24</span>        </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">25</span>        <span class="k">if</span> len(candles) == 0: <span class="k">return</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">26</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">27</span>        <span class="c1"># 1. Tenkan &amp; Kijun</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">28</span>        <span class="k">for</span> i <span class="ow">in</span> range(len(candles)):</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">29</span>            self.tenkan_sen.append(self._midpoint(candles, i, self.tenkan_period))</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">30</span>            self.kijun_sen.append(self._midpoint(candles, i, self.kijun_period))</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">31</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">32</span>        <span class="c1"># 2. Spans (Cloud) - Values aligned to calculation time (not shifted yet)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">33</span>        <span class="k">for</span> i <span class="ow">in</span> range(len(candles)):</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">34</span>            <span class="k">if</span> self.tenkan_sen[i] <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> self.kijun_sen[i] <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>:</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">35</span>                val = (self.tenkan_sen[i] + self.kijun_sen[i]) / 2.0</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">36</span>                self.senkou_span_a.append(val)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">37</span>            <span class="k">else</span>:</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">38</span>                self.senkou_span_a.append(<span class="kc">None</span>)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">39</span>                </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">40</span>            self.senkou_span_b.append(self._midpoint(candles, i, self.span_b_period))</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">41</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">42</span>        <span class="c1"># 3. Chikou (Close)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">43</span>        <span class="k">for</span> i <span class="ow">in</span> range(len(candles)):</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">44</span>            self.chikou_span.append(candles[i][<span class="s1">&#x27;</span><span class="s1">close</span><span class="s1">&#x27;</span>])</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">45</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">46</span>    <span class="k">def</span> _midpoint(self, candles, index, period):</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">47</span>        <span class="k">if</span> index &lt; period - 1: <span class="k">return</span> <span class="kc">None</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">48</span>        </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">49</span>        highest = float(<span class="s1">&#x27;</span><span class="s1">-inf</span><span class="s1">&#x27;</span>)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">50</span>        lowest = float(<span class="s1">&#x27;</span><span class="s1">inf</span><span class="s1">&#x27;</span>)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">51</span>        </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">52</span>        <span class="k">for</span> i <span class="ow">in</span> range(index - period + 1, index + 1):</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">53</span>            h = candles[i][<span class="s1">&#x27;</span><span class="s1">high</span><span class="s1">&#x27;</span>]</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">54</span>            l = candles[i][<span class="s1">&#x27;</span><span class="s1">low</span><span class="s1">&#x27;</span>]</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">55</span>            <span class="k">if</span> h &gt; highest: highest = h</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">56</span>            <span class="k">if</span> l &lt; lowest: lowest = l</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">57</span>            </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">58</span>        <span class="k">return</span> (highest + lowest) / 2.0</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">59</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">60</span><span class="k">def</span> calculate(candles, tenkan=9, kijun=26, span_b=52, displacement=26):</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">61</span>    ichi = Ichimoku(tenkan, kijun, span_b, displacement)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">62</span>    ichi.calculate(candles)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">63</span>    <span class="k">return</span> ichi.tenkan_sen, ichi.kijun_sen, ichi.senkou_span_a, ichi.senkou_span_b, ichi.chikou_span</div></div></div>
<div id="code-python-detailed" class="code-content hidden"><div class="highlight"><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">1</span><span class="c1"># =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">2</span><span class="c1"># Logic Breakdown (Ichimoku Kinko Hyo)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">3</span><span class="c1"># =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">4</span><span class="c1">#</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">5</span><span class="c1"># This document provides a &quot;Deep Dive&quot; into the internal logic of the</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">6</span><span class="c1"># Ichimoku Kinko Hyo (Equilibrium Chart). We explain *why* code is written</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">7</span><span class="c1"># this way and *how* data transforms line-by-line, targeting beginners.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">8</span><span class="c1">#</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">9</span><span class="c1"># [Core Concepts]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">10</span><span class="c1"># 1. Price Equilibrium (Midpoint vs Average)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">11</span><span class="c1">#    Western technical analysis often uses Moving Averages (Close Price).</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">12</span><span class="c1">#    Ichimoku uses the &quot;Midpoint&quot; of the High-Low range.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">13</span><span class="c1">#    Formula: (Highest High + Lowest Low) / 2</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">14</span><span class="c1">#    [Why] It focuses on the &quot;center&quot; of the price battleground, not the consensus close.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">15</span><span class="c1">#</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">16</span><span class="c1"># 2. Time Shifting (The 3 Dimensions)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">17</span><span class="c1">#    - Past: Chikou Span (Shifted Backwards). &quot;How does today compare to 26 days ago?&quot;</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">18</span><span class="c1">#    - Present: Tenkan &amp; Kijun. &quot;What is the current trend state?&quot;</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">19</span><span class="c1">#    - Future: Senkou Span A &amp; B (Shifted Forwards). &quot;Where is support/resistance likely to be?&quot;</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">20</span><span class="c1">#</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">21</span><span class="c1"># 3. The Cloud (Kumo)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">22</span><span class="c1">#    The area between Span A and Span B.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">23</span><span class="c1">#    - Thick Cloud: Strong Support/Resistance.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">24</span><span class="c1">#    - Thin Cloud: Weak Support/Resistance.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">25</span><span class="c1">#</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">26</span><span class="c1"># =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">27</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">28</span><span class="kn">import</span> math</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">29</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">30</span><span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">31</span><span class="c1"># Type-Level Explanation: Ichimoku (class)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">32</span><span class="c1">#</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">33</span><span class="c1"># [Why]  Encapsulates 5 mutable data series for a comprehensive system.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">34</span><span class="c1"># [What] A complete trend-following and support/resistance system.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">35</span><span class="c1"># [How]  Calculates five lines (Tenkan-sen, Kijun-sen, Senkou Span A, Senkou Span B, Chikou Span) based on midpoints of highs and lows over different periods to identify trends, support/resistance, and momentum.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">36</span><span class="c1"># [Who]  Trend Traders, Crypto Analysts.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">37</span><span class="c1"># [Where] Heap.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">38</span><span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">39</span><span class="k">class</span> <span class="nc">Ichimoku</span>:</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">40</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">41</span>    <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">42</span>    <span class="c1"># Logic Explanation: Indicator Configuration (Public Properties)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">43</span>    <span class="c1">#</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">44</span>    <span class="c1"># [Why]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">45</span>    <span class="c1"># Traditional settings (9, 26, 52) are based on traditional Japanese</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">46</span>    <span class="c1"># trading weeks (6 days/week). Modern crypto/forex sometimes adjust these.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">47</span>    <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">48</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">49</span>    <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">50</span>    <span class="c1"># Constructor: __init__</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">51</span>    <span class="c1">#</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">52</span>    <span class="c1"># [Input]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">53</span>    <span class="c1"># - tenkan_period: int (Default 9) - The &quot;Conversion Line&quot; (Fast)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">54</span>    <span class="c1"># - kijun_period: int (Default 26) - The &quot;Base Line&quot; (Slow)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">55</span>    <span class="c1"># - senkou_b_period: int (Default 52) - The &quot;Leading Span B&quot; len</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">56</span>    <span class="c1"># - displacement: int (Default 26) - The visual shift</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">57</span>    <span class="c1">#</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">58</span>    <span class="c1"># [Why]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">59</span>    <span class="c1"># Initialize implementation constants and buffers.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">60</span>    <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">61</span>    <span class="k">def</span> __init__(self, tenkan_period=9, kijun_period=26, senkou_b_period=52, displacement=26):</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">62</span>        </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">63</span>        <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">64</span>        <span class="c1"># Logic Step 1: Validation</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">65</span>        <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">66</span>        <span class="k">if</span> tenkan_period &lt;= 1:</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">67</span>            <span class="k">raise</span> ValueError(<span class="sa">f</span><span class="s2">&quot;</span><span class="s2">Tenkan Period must be &gt; 1. Got: </span><span class="si">{</span>tenkan_period<span class="si">}</span><span class="s2">&quot;</span>)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">68</span>        <span class="k">if</span> kijun_period &lt;= 1:</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">69</span>            <span class="k">raise</span> ValueError(<span class="sa">f</span><span class="s2">&quot;</span><span class="s2">Kijun Period must be &gt; 1. Got: </span><span class="si">{</span>kijun_period<span class="si">}</span><span class="s2">&quot;</span>)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">70</span>        <span class="k">if</span> senkou_b_period &lt;= 1:</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">71</span>            <span class="k">raise</span> ValueError(<span class="sa">f</span><span class="s2">&quot;</span><span class="s2">Senkou B Period must be &gt; 1. Got: </span><span class="si">{</span>senkou_b_period<span class="si">}</span><span class="s2">&quot;</span>)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">72</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">73</span>        self.tenkan_period = tenkan_period</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">74</span>        self.kijun_period = kijun_period</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">75</span>        self.senkou_b_period = senkou_b_period</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">76</span>        self.displacement = displacement</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">77</span>        </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">78</span>        <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">79</span>        <span class="c1"># Variable Definition: Outputs</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">80</span>        <span class="c1"># [Role]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">81</span>        <span class="c1"># - Tenkan-sen: Fast moving trend line.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">82</span>        <span class="c1"># - Kijun-sen: Medium moving trend line (major support).</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">83</span>        <span class="c1"># - Senkou A: Average of Tenkan/Kijun (Projected Forward).</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">84</span>        <span class="c1"># - Senkou B: Midpoint of 52-period (Projected Forward).</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">85</span>        <span class="c1"># - Chikou: Close price (Projected Backward).</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">86</span>        <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">87</span>        self.tenkan_sen = []</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">88</span>        self.kijun_sen = []</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">89</span>        self.senkou_span_a = []</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">90</span>        self.senkou_span_b = []</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">91</span>        self.chikou_span = []</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">92</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">93</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">94</span>    <span class="c1"># =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">95</span>    <span class="c1"># IPO: calculate</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">96</span>    <span class="c1"># =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">97</span>    <span class="c1">#</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">98</span>    <span class="c1"># [Input]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">99</span>    <span class="c1"># - candles: list[dict] (Must have &#x27;high&#x27;, &#x27;low&#x27;, &#x27;close&#x27;)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">100</span>    <span class="c1">#</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">101</span>    <span class="c1"># [Process]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">102</span>    <span class="c1"># 1. Compute Tenkan-sen (9-period Midpoint).</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">103</span>    <span class="c1"># 2. Compute Kijun-sen (26-period Midpoint).</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">104</span>    <span class="c1"># 3. Compute Senkou Span A ( (Tenkan+Kijun)/2 ).</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">105</span>    <span class="c1"># 4. Compute Senkou Span B (52-period Midpoint).</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">106</span>    <span class="c1"># 5. Compute Chikou Span (Current Close).</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">107</span>    <span class="c1">#</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">108</span>    <span class="c1"># [Note on Displacement]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">109</span>    <span class="c1"># This class calculates the *data values* for the current logical index.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">110</span>    <span class="c1"># Charting libraries are responsible for visually plotting:</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">111</span>    <span class="c1"># - Span A/B shifted +26 bars (Future).</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">112</span>    <span class="c1"># - Chikou shifted -26 bars (Past).</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">113</span>    <span class="c1">#</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">114</span>    <span class="c1"># [Output]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">115</span>    <span class="c1"># - None (populates lists)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">116</span>    <span class="c1"># =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">117</span>    <span class="k">def</span> calculate(self, candles):</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">118</span>        </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">119</span>        <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">120</span>        <span class="c1"># Logic Step 1: Reset</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">121</span>        <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">122</span>        self.tenkan_sen.clear()</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">123</span>        self.kijun_sen.clear()</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">124</span>        self.senkou_span_a.clear()</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">125</span>        self.senkou_span_b.clear()</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">126</span>        self.chikou_span.clear()</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">127</span>        </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">128</span>        count = len(candles)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">129</span>        <span class="k">if</span> count == 0:</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">130</span>            <span class="k">return</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">131</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">132</span>        <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">133</span>        <span class="c1"># Logic Step 2: Main Loop</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">134</span>        <span class="c1">#</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">135</span>        <span class="c1"># [Why]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">136</span>        <span class="c1"># Iterate through all candles to generate the 5 lines.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">137</span>        <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">138</span>        <span class="k">for</span> i <span class="ow">in</span> range(count):</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">139</span>            </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">140</span>            <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">141</span>            <span class="c1"># Logic Step 2.1: Tenkan-sen (Conversion Line)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">142</span>            <span class="c1"># [Formula] (Max(High, 9) + Min(Low, 9)) / 2</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">143</span>            <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">144</span>            tenkan = self._midpoint(candles, i, self.tenkan_period)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">145</span>            self.tenkan_sen.append(tenkan)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">146</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">147</span>            <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">148</span>            <span class="c1"># Logic Step 2.2: Kijun-sen (Base Line)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">149</span>            <span class="c1"># [Formula] (Max(High, 26) + Min(Low, 26)) / 2</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">150</span>            <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">151</span>            kijun = self._midpoint(candles, i, self.kijun_period)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">152</span>            self.kijun_sen.append(kijun)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">153</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">154</span>            <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">155</span>            <span class="c1"># Logic Step 2.3: Senkou Span A (Leading Span A)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">156</span>            <span class="c1"># [Formula] (Tenkan + Kijun) / 2</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">157</span>            <span class="c1"># [Note] Future projection happens in rendering, not storage here usually.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">158</span>            <span class="c1">#        If we want to strictly align data, we would push this to i+26.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">159</span>            <span class="c1">#        Standard implementation: Store calculated value at i.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">160</span>            <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">161</span>            <span class="k">if</span> tenkan <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> kijun <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>:</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">162</span>                span_a = (tenkan + kijun) / 2.0</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">163</span>                self.senkou_span_a.append(span_a)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">164</span>            <span class="k">else</span>:</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">165</span>                self.senkou_span_a.append(<span class="kc">None</span>)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">166</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">167</span>            <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">168</span>            <span class="c1"># Logic Step 2.4: Senkou Span B (Leading Span B)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">169</span>            <span class="c1"># [Formula] (Max(High, 52) + Min(Low, 52)) / 2</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">170</span>            <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">171</span>            span_b = self._midpoint(candles, i, self.senkou_b_period)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">172</span>            self.senkou_span_b.append(span_b)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">173</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">174</span>            <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">175</span>            <span class="c1"># Logic Step 2.5: Chikou Span (Lagging Span)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">176</span>            <span class="c1"># [Formula] Close Price (shifted back 26)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">177</span>            <span class="c1"># -------------------------------------------------------------</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">178</span>            self.chikou_span.append(candles[i][<span class="s1">&#x27;</span><span class="s1">close</span><span class="s1">&#x27;</span>])</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">179</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">180</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">181</span>    <span class="c1"># =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">182</span>    <span class="c1"># IPO: _midpoint (Helper)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">183</span>    <span class="c1"># =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">184</span>    <span class="c1">#</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">185</span>    <span class="c1"># [Input]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">186</span>    <span class="c1"># - candles: list[dict]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">187</span>    <span class="c1"># - index: int (Current position)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">188</span>    <span class="c1"># - period: int (Lookback size)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">189</span>    <span class="c1">#</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">190</span>    <span class="c1"># [Process]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">191</span>    <span class="c1"># Find Highest High and Lowest Low in [index-period+1 ... index].</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">192</span>    <span class="c1"># Return Average of High and Low.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">193</span>    <span class="c1">#</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">194</span>    <span class="c1"># [Output]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">195</span>    <span class="c1"># - float or None</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">196</span>    <span class="c1"># =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">197</span>    <span class="k">def</span> _midpoint(self, candles, index, period):</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">198</span>        </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">199</span>        <span class="c1"># Logic Step 1: Check Data Availability</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">200</span>        <span class="k">if</span> index &lt; period - 1:</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">201</span>            <span class="k">return</span> <span class="kc">None</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">202</span>            </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">203</span>        <span class="c1"># Logic Step 2: Find Extremes (Linear Scan)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">204</span>        <span class="c1"># [Why] Need the range of price action over the period.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">205</span>        <span class="c1"># [Visual] Period=3</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">206</span>        <span class="c1"># Bars: [H:10, L:8], [H:12, L:9], [H:11, L:7]</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">207</span>        <span class="c1"># Max: 12, Min: 7</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">208</span>        <span class="c1"># Mid: (12+7)/2 = 9.5</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">209</span>        highest = float(<span class="s1">&#x27;</span><span class="s1">-inf</span><span class="s1">&#x27;</span>)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">210</span>        lowest = float(<span class="s1">&#x27;</span><span class="s1">inf</span><span class="s1">&#x27;</span>)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">211</span>        </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">212</span>        <span class="c1"># Iterate backwards &#x27;period&#x27; times</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">213</span>        <span class="k">for</span> j <span class="ow">in</span> range(period):</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">214</span>            idx = index - j</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">215</span>            h = candles[idx][<span class="s1">&#x27;</span><span class="s1">high</span><span class="s1">&#x27;</span>]</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">216</span>            l = candles[idx][<span class="s1">&#x27;</span><span class="s1">low</span><span class="s1">&#x27;</span>]</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">217</span>            </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">218</span>            <span class="k">if</span> h &gt; highest:</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">219</span>                highest = h</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">220</span>            <span class="k">if</span> l &lt; lowest:</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">221</span>                lowest = l</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">222</span>                </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">223</span>        <span class="c1"># Logic Step 3: Compute Average</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">224</span>        <span class="k">return</span> (highest + lowest) / 2.0</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">225</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">226</span>&#8203;</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">227</span><span class="c1"># =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">228</span><span class="c1"># Functional Wrapper (Procedural Interface)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">229</span><span class="c1"># =============================================================================</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">230</span><span class="k">def</span> calculate(candles, tenkan=9, kijun=26, span_b=52, displacement=26):</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">231</span>    <span class="sd">&quot;&quot;&quot;</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">232</span><span class="sd">    Computes Ichimoku Kinko Hyo (Cloud) values.</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">233</span><span class="sd">    Returns tuple: (tenkan, kijun, span_a, span_b, chikou)</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">234</span><span class="sd">    &quot;&quot;&quot;</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">235</span>    <span class="c1"># 1. Instantiation</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">236</span>    instance = Ichimoku(tenkan, kijun, span_b, displacement)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">237</span>    </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">238</span>    <span class="c1"># 2. Execution</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">239</span>    instance.calculate(candles)</div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">240</span>    </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">241</span>    <span class="c1"># 3. Extraction</span></div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">242</span>    <span class="k">return</span> (instance.tenkan_sen, </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">243</span>            instance.kijun_sen, </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">244</span>            instance.senkou_span_a, </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">245</span>            instance.senkou_span_b, </div><div class="code-line" style="white-space: pre;"><span style="display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;">246</span>            instance.chikou_span)</div></div></div>
</div>
</div>
</figure>
<div class="logic-legend">
<div class="legend-item"><span class="legend-dot l-ingestion"></span>Ingestion</div>
<div class="legend-item"><span class="legend-dot l-evaluation"></span>Evaluation</div>
<div class="legend-item"><span class="legend-dot l-weighting"></span>Weighting</div>
<div class="legend-item"><span class="legend-dot l-synthesis"></span>Synthesis</div>
<div class="legend-item"><span class="legend-dot l-outcome"></span>Outcome</div>
</div>
</section>
<section id="documentation" class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden scroll-mt-24">
<div class="border-b border-orange-200 bg-orange-50 px-6 py-4">
<h2 class="text-lg font-bold text-slate-900 flex items-center">
<span class="bg-indigo-600 text-white p-1 rounded mr-3 text-xs shadow-sm font-mono">D</span>
Technical Documentation
</h2>
<p class="text-slate-600 text-xs mt-1 ml-9">
Detailed technical explanation of the indicator's logic, math, and implementation details.
</p>
</div>
<div class="p-6 flex flex-col lg:flex-row gap-12">
<article class="flex-1 min-w-0">
<div class="prose prose-slate max-w-none prose-headings:scroll-mt-24 prose-headings:font-bold prose-h2:text-2xl prose-h2:border-b prose-h2:pb-2 prose-h2:mt-8 prose-a:text-indigo-600 hover:prose-a:text-indigo-800">
<h1 id="ichimoku-kinko-hyo-ichimoku-cloud">Ichimoku Kinko Hyo (Ichimoku Cloud)</h1>
<p class="mb-4"><h2 class="text-2xl font-bold mt-12 mb-6 border-b pb-2">PART 1: MAIN GUIDE</h2></p>
<h2 id="1-identity">1. Identity</h2>
<p class="mb-4">Full Name: Ichimoku Kinko Hyo  </p>
<p class="mb-4">English Translation: "One Glance Equilibrium Chart"  </p>
<p class="mb-4">Abbreviation: Ichimoku  </p>
<p class="mb-4">Category: Trend Following / Support & Resistance Overlay  </p>
<p class="mb-4">Creator: Goichi Hosoda (pen name: Ichimoku Sanjin), 1968  </p>
<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">One-Sentence Definition: Ichimoku is a comprehensive technical analysis system that defines support, resistance, trend direction, and momentum in a single glance through five interrelated components and a projected "cloud" of equilibrium.</blockquote>
<hr class="border-[#2a2e39] my-8">
<h2 id="2-calculation-logic">2. Calculation Logic</h2>
<h3 id="formula">Formula</h3>
<p class="mb-4">The Ichimoku system comprises five lines, each calculated using the midpoint of High-Low ranges over specific periods:</p>
<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Component</td><td class="px-4 py-2 border-b border-[#2a2e39]">Formula</td><td class="px-4 py-2 border-b border-[#2a2e39]">Purpose</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Tenkan-sen (Conversion Line)</td><td class="px-4 py-2 border-b border-[#2a2e39]">$\frac{\max(High, 9) + \min(Low, 9)}{2}$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Short-term equilibrium (9-period midpoint)</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Kijun-sen (Base Line)</td><td class="px-4 py-2 border-b border-[#2a2e39]">$\frac{\max(High, 26) + \min(Low, 26)}{2}$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Medium-term equilibrium (26-period midpoint)</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Senkou Span A (Leading Span A)</td><td class="px-4 py-2 border-b border-[#2a2e39]">$\frac{Tenkan + Kijun}{2}$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Average of short/medium equilibrium, plotted 26 periods ahead</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Senkou Span B (Leading Span B)</td><td class="px-4 py-2 border-b border-[#2a2e39]">$\frac{\max(High, 52) + \min(Low, 52)}{2}$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Long-term equilibrium, plotted 26 periods ahead</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Chikou Span (Lagging Span)</td><td class="px-4 py-2 border-b border-[#2a2e39]">$Close_{current}$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Current close, plotted 26 periods behind</td></tr>
</table></div>
<p class="mb-4">The Kumo (Cloud): The shaded area between Senkou Span A and Senkou Span B. This represents the zone of equilibriumthick clouds indicate strong support/resistance while thin clouds suggest weakness.</p>
<h3 id="real-world-analogy">Real-World Analogy</h3>
<p class="mb-4">Think of Ichimoku like a weather forecast system for trading. The five lines are like different meteorological readings (temperature, humidity, pressure), while the Cloud is the forecast zone itself. Just as you wouldn't plan an outdoor event without checking the weather, you shouldn't enter a trade without understanding where price sits relative to the Cloud. The Cloud "forecasts" future support/resistance 26 periods aheadit's the market's weather map.</p>
<hr class="border-[#2a2e39] my-8">
<h2 id="3-market-standards">3. Market Standards</h2>
<h3 id="default-parameters">Default Parameters</h3>
<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Parameter</td><td class="px-4 py-2 border-b border-[#2a2e39]">Standard Value</td><td class="px-4 py-2 border-b border-[#2a2e39]">Rationale</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Tenkan-sen</td><td class="px-4 py-2 border-b border-[#2a2e39]">9</td><td class="px-4 py-2 border-b border-[#2a2e39]">Represents 1.5 trading weeks (original 6-day week)</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Kijun-sen</td><td class="px-4 py-2 border-b border-[#2a2e39]">26</td><td class="px-4 py-2 border-b border-[#2a2e39]">Represents one trading month</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Senkou Span B</td><td class="px-4 py-2 border-b border-[#2a2e39]">52</td><td class="px-4 py-2 border-b border-[#2a2e39]">Represents two trading months</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Displacement</td><td class="px-4 py-2 border-b border-[#2a2e39]">26</td><td class="px-4 py-2 border-b border-[#2a2e39]">Forward/backward projection period</td></tr>
</table></div>
<h3 id="alternative-parameters">Alternative Parameters</h3>
<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Market Type</td><td class="px-4 py-2 border-b border-[#2a2e39]">Tenkan</td><td class="px-4 py-2 border-b border-[#2a2e39]">Kijun</td><td class="px-4 py-2 border-b border-[#2a2e39]">Span B</td><td class="px-4 py-2 border-b border-[#2a2e39]">Rationale</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Standard</td><td class="px-4 py-2 border-b border-[#2a2e39]">9</td><td class="px-4 py-2 border-b border-[#2a2e39]">26</td><td class="px-4 py-2 border-b border-[#2a2e39]">52</td><td class="px-4 py-2 border-b border-[#2a2e39]">Hosoda's original settings</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Crypto/24-7</td><td class="px-4 py-2 border-b border-[#2a2e39]">10</td><td class="px-4 py-2 border-b border-[#2a2e39]">30</td><td class="px-4 py-2 border-b border-[#2a2e39]">60</td><td class="px-4 py-2 border-b border-[#2a2e39]">Adjusted for continuous markets</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Western 5-day</td><td class="px-4 py-2 border-b border-[#2a2e39]">7</td><td class="px-4 py-2 border-b border-[#2a2e39]">22</td><td class="px-4 py-2 border-b border-[#2a2e39]">44</td><td class="px-4 py-2 border-b border-[#2a2e39]">Some adjust for modern week</td></tr>
</table></div>
<h3 id="timeframe-recommendations">Timeframe Recommendations</h3>
<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Trading Style</td><td class="px-4 py-2 border-b border-[#2a2e39]">Timeframe</td><td class="px-4 py-2 border-b border-[#2a2e39]">Notes</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Day Trading</td><td class="px-4 py-2 border-b border-[#2a2e39]">15-min to 1-hour</td><td class="px-4 py-2 border-b border-[#2a2e39]">Faster signals, more noise</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Swing Trading</td><td class="px-4 py-2 border-b border-[#2a2e39]">Daily</td><td class="px-4 py-2 border-b border-[#2a2e39]">Optimal for standard settings</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Position Trading</td><td class="px-4 py-2 border-b border-[#2a2e39]">Weekly</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong trend identification</td></tr>
</table></div>
<hr class="border-[#2a2e39] my-8">
<h2 id="4-market-context">4. Market Context</h2>
<h3 id="best-conditions">Best Conditions</h3>
<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Condition</td><td class="px-4 py-2 border-b border-[#2a2e39]">Why It Works</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Strong Trending Markets</td><td class="px-4 py-2 border-b border-[#2a2e39]">System designed for equilibrium-based trend following</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Breakouts from Consolidation</td><td class="px-4 py-2 border-b border-[#2a2e39]">Cloud provides clear breakout levels</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Currency Pairs</td><td class="px-4 py-2 border-b border-[#2a2e39]">Originally optimized for Japanese markets but excels in Forex</td></tr>
</table></div>
<h3 id="limitations">Limitations</h3>
<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Condition</td><td class="px-4 py-2 border-b border-[#2a2e39]">Problem</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Choppy/Ranging Markets</td><td class="px-4 py-2 border-b border-[#2a2e39]">Price weaves in and out of Cloud, causing whipsaws</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Low Liquidity Assets</td><td class="px-4 py-2 border-b border-[#2a2e39]">Flat High=Low periods cause line convergence</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Very Short Timeframes</td><td class="px-4 py-2 border-b border-[#2a2e39]">Too much noise for equilibrium calculations</td></tr>
</table></div>
<h3 id="asset-class-suitability">Asset Class Suitability</h3>
<p class="mb-4">- Forex  Excellent, widely used by Japanese institutional traders</p>
<p class="mb-4">- Equities  Strong for trending stocks</p>
<p class="mb-4">- Futures/Commodities  Works well on trending instruments</p>
<p class="mb-4">- Crypto  Requires parameter adjustment for 24/7 markets</p>
<hr class="border-[#2a2e39] my-8">
<h2 id="5-entry-signals">5. Entry Signals</h2>
<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Signal Type</td><td class="px-4 py-2 border-b border-[#2a2e39]">Condition</td><td class="px-4 py-2 border-b border-[#2a2e39]">Direction</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strength</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">TK Cross (Golden)</td><td class="px-4 py-2 border-b border-[#2a2e39]">Tenkan crosses above Kijun above Cloud</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bullish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">TK Cross (Neutral)</td><td class="px-4 py-2 border-b border-[#2a2e39]">Tenkan crosses above Kijun inside Cloud</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bullish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Moderate</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">TK Cross (Weak)</td><td class="px-4 py-2 border-b border-[#2a2e39]">Tenkan crosses above Kijun below Cloud</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bullish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Weak</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Dead Cross</td><td class="px-4 py-2 border-b border-[#2a2e39]">Tenkan crosses below Kijun below Cloud</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bearish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Kumo Breakout (Up)</td><td class="px-4 py-2 border-b border-[#2a2e39]">Price closes above Cloud</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bullish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Kumo Breakout (Down)</td><td class="px-4 py-2 border-b border-[#2a2e39]">Price closes below Cloud</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bearish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Chikou Confirmation</td><td class="px-4 py-2 border-b border-[#2a2e39]">Chikou Span crosses above price 26 bars ago</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bullish Confirmation</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Kumo Twist</td><td class="px-4 py-2 border-b border-[#2a2e39]">Span A crosses Span B in future Cloud</td><td class="px-4 py-2 border-b border-[#2a2e39]">Trend Change Warning</td><td class="px-4 py-2 border-b border-[#2a2e39]">Moderate</td></tr>
</table></div>
<h3 id="primary-buy-signal">Primary Buy Signal</h3>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
IF Price &gt; Cloud (Senkou Span A AND Senkou Span B)
AND Tenkan-sen crosses above Kijun-sen
AND Chikou Span &gt; Price[26 bars ago]
THEN  BUY (Full Bullish Alignment)
</code></pre>
<h3 id="primary-sell/exit-signal">Primary Sell/Exit Signal</h3>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
IF Price &lt; Cloud
OR Tenkan-sen crosses below Kijun-sen while Price in/below Cloud
OR Chikou Span crosses below Price[26 bars ago]
THEN  SELL/EXIT
</code></pre>
<hr class="border-[#2a2e39] my-8">
<h2 id="6-filter-usage">6. Filter Usage</h2>
<p class="mb-4">Ichimoku excels as a comprehensive trend filter. The Cloud itself is a regime identifiertrade only in the direction of the Cloud.</p>
<h3 id="filter-rules">Filter Rules</h3>
<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Rule</td><td class="px-4 py-2 border-b border-[#2a2e39]">Application</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]"><code>Price > Cloud</code></td><td class="px-4 py-2 border-b border-[#2a2e39]">Only take long positions</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]"><code>Price < Cloud</code></td><td class="px-4 py-2 border-b border-[#2a2e39]">Only take short positions</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]"><code>Price inside Cloud</code></td><td class="px-4 py-2 border-b border-[#2a2e39]">Avoid trading or reduce size</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]"><code>Thick Cloud ahead</code></td><td class="px-4 py-2 border-b border-[#2a2e39]">Expect strong resistance/support</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]"><code>Thin Cloud ahead</code></td><td class="px-4 py-2 border-b border-[#2a2e39]">Easier breakout zone</td></tr>
</table></div>
<h3 id="recommended-pairings">Recommended Pairings</h3>
<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Partner Indicator</td><td class="px-4 py-2 border-b border-[#2a2e39]">Synergy Logic</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">RSI (14)</td><td class="px-4 py-2 border-b border-[#2a2e39]">Ichimoku confirms trend; RSI times overbought/oversold entries</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Volume</td><td class="px-4 py-2 border-b border-[#2a2e39]">Confirm Cloud breakouts with volume spikes</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Fibonacci Retracements</td><td class="px-4 py-2 border-b border-[#2a2e39]">Cloud levels often coincide with Fib zones</td></tr>
</table></div>
<h3 id="example-combined-strategy">Example Combined Strategy</h3>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
ENTRY CONDITIONS:
&nbsp;&nbsp;Price closes above Cloud              // Bullish regime
&nbsp;&nbsp;Tenkan-sen &gt; Kijun-sen                // Short-term bullish
&nbsp;&nbsp;RSI(14) between 50-70                 // Momentum but not exhausted
&nbsp;&nbsp;Chikou Span &gt; Price[26]               // Historical confirmation
ACTION: BUY with stop below Kijun-sen
</code></pre>
<hr class="border-[#2a2e39] my-8">
<h2 id="7-practical-cautions">7. Practical Cautions</h2>
<h3 id="lag-characteristics">Lag Characteristics</h3>
<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Component</td><td class="px-4 py-2 border-b border-[#2a2e39]">Approximate Lag</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Tenkan-sen</td><td class="px-4 py-2 border-b border-[#2a2e39]">4-5 bars</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Kijun-sen</td><td class="px-4 py-2 border-b border-[#2a2e39]">13-14 bars</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">First Valid Cloud</td><td class="px-4 py-2 border-b border-[#2a2e39]">52 bars minimum</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Chikou Confirmation</td><td class="px-4 py-2 border-b border-[#2a2e39]">26 bars (by design)</td></tr>
</table></div>
<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">Reality Check: The Ichimoku system is inherently laggingit confirms trends rather than predicting them. The Cloud projected forward is based on past equilibrium, not future prediction.</blockquote>
<h3 id="false-signal-scenarios">False Signal Scenarios</h3>
<p class="mb-4">1. The Kumo Trap  </p>
<p class="mb-4">   Price breaks above Cloud, triggers buy, then immediately falls back into Cloud. Wait for candle to *close* above Cloud, not just wick through.</p>
<p class="mb-4">2. Flat Market Flatline  </p>
<p class="mb-4">   When Tenkan and Kijun converge and flatten, TK crosses become meaningless. Check for Kijun slope before trading crosses.</p>
<p class="mb-4">3. Thin Cloud Whipsaws  </p>
<p class="mb-4">   Thin Cloud zones offer less support/resistance. Multiple false breakouts occur in these areas.</p>
<h3 id="mitigation-strategies">Mitigation Strategies</h3>
<p class="mb-4">- Chikou Span Filter: Never trade unless Chikou is clear of price action from 26 periods ago</p>
<p class="mb-4">- Cloud Thickness Check: Avoid entries when Cloud ahead is thin</p>
<p class="mb-4">- Wait for Close: Require candle close above/below Cloud, not intraday penetration</p>
<hr class="border-[#2a2e39] my-8">
<h2 id="8-pro-insights">8. Pro Insights</h2>
<h3 id="the-kumo-shadow-strategy">The Kumo Shadow Strategy</h3>
<p class="mb-4">Most traders focus on Cloud breakouts. Professionals watch the Chikou Span. If the Chikou Span hits the historical price candles, it often bouncesthe past price acts as support/resistance for the lagging line. A "pure" breakout only happens when Chikou enters "open sky" (above all past price action).</p>
<h3 id="the-future-cloud-as-a-time-target">The Future Cloud as a Time Target</h3>
<p class="mb-4">When a Kumo Twist appears (Span A crosses Span B in the future projection), mark that future date. Significant price action often occurs on or near that date. Use it as a time-based target for trade management.</p>
<h3 id="portfolio-selection-technique">Portfolio Selection Technique</h3>
<p class="mb-4">Screen for stocks where:</p>
<p class="mb-4">- Price just broke above Cloud (within past 5 bars)</p>
<p class="mb-4">- Tenkan > Kijun (bullish alignment)</p>
<p class="mb-4">- Chikou in "open sky" (no resistance from past price)</p>
<p class="mb-4">- Cloud ahead is thick (strong trend potential)</p>
<p class="mb-4">This identifies fresh breakouts with structural support.</p>
<hr class="border-[#2a2e39] my-8">
<h2 id="9-summary">9. Summary</h2>
<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">"Ichimoku is your market's weather mapthe Cloud shows where equilibrium lies, and price above or below it tells you whether you're in sunny bulls or stormy bears."</blockquote>
<p class="mb-4"><h2 class="text-2xl font-bold mt-12 mb-6 border-b pb-2">PART 2: SUPPLEMENTARY GUIDE</h2></p>
<h2 id="1-core-concept">1. Core Concept</h2>
<p class="mb-4">Ichimoku answers: "Where is the market's balance point, and which side of it are we on?"</p>
<p class="mb-4">Unlike Western indicators that focus on closing prices, Ichimoku uses the *midpoint* of High-Low ranges. This captures the "center of gravity" of each period's price battle between buyers and sellers. The five lines represent equilibrium at different timeframes:</p>
<p class="mb-4">- Tenkan-sen: Where's the balance over the short term?</p>
<p class="mb-4">- Kijun-sen: Where's the balance over the medium term?</p>
<p class="mb-4">- Senkou Spans: Where will the balance zone be in the future?</p>
<p class="mb-4">- Chikou Span: How does today's price compare to past balance?</p>
<p class="mb-4">The genius is the projection. By plotting Span A and B forward 26 periods, Ichimoku creates a "forecast" of where support and resistance will appearbased on current equilibrium dynamics.</p>
<hr class="border-[#2a2e39] my-8">
<h2 id="2-statistical-edge">2. Statistical Edge</h2>
<h3 id="why-it-works">Why It Works</h3>
<p class="mb-4">The statistical edge comes from multi-timeframe equilibrium confirmation. A valid Ichimoku signal requires alignment across:</p>
<p class="mb-4">- Short-term (Tenkan)</p>
<p class="mb-4">- Medium-term (Kijun)</p>
<p class="mb-4">- Future projection (Cloud)</p>
<p class="mb-4">- Historical comparison (Chikou)</p>
<p class="mb-4">This multi-layer confirmation naturally filters out many false signals.</p>
<h3 id="backtest-context">Backtest Context</h3>
<p class="mb-4">Studies on Ichimoku-filtered trend strategies show:</p>
<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Metric</td><td class="px-4 py-2 border-b border-[#2a2e39]">Without Ichimoku</td><td class="px-4 py-2 border-b border-[#2a2e39]">With Full Ichimoku</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Win Rate</td><td class="px-4 py-2 border-b border-[#2a2e39]">~45%</td><td class="px-4 py-2 border-b border-[#2a2e39]">~55%</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">False Breakouts</td><td class="px-4 py-2 border-b border-[#2a2e39]">High</td><td class="px-4 py-2 border-b border-[#2a2e39]">Reduced by 30-40%</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Trend Capture</td><td class="px-4 py-2 border-b border-[#2a2e39]">Partial</td><td class="px-4 py-2 border-b border-[#2a2e39]">More complete</td></tr>
</table></div>
<h3 id="academic-reference">Academic Reference</h3>
<p class="mb-4">Hosoda spent over 30 years developing and backtesting the system with teams of students before publishing in 1968. The original Japanese text spans seven volumes of detailed analysis.</p>
<hr class="border-[#2a2e39] my-8">
<h2 id="3-actionable-strategy">3. Actionable Strategy</h2>
<h3 id="strategy-name:-"triple-cloud-confirmation"">Strategy Name: "Triple Cloud Confirmation"</h3>
<p class="mb-4">Concept: Only enter when all five Ichimoku components align bullishly.</p>
<p class="mb-4">Setup Requirements:</p>
<p class="mb-4">1. Price > Cloud (both Span A and Span B)</p>
<p class="mb-4">2. Tenkan-sen > Kijun-sen</p>
<p class="mb-4">3. Tenkan-sen slope is positive</p>
<p class="mb-4">4. Chikou Span > Price from 26 periods ago</p>
<p class="mb-4">5. Future Cloud is green (Span A > Span B)</p>
<p class="mb-4">Entry Trigger:</p>
<p class="mb-4">- All five conditions met</p>
<p class="mb-4">- Enter on next candle open</p>
<p class="mb-4">Position Sizing:</p>
<p class="mb-4">- Full size when Cloud ahead is thick</p>
<p class="mb-4">- Half size when Cloud ahead is thin</p>
<p class="mb-4">Exit Rules:</p>
<p class="mb-4">1. Primary Exit: Tenkan crosses below Kijun</p>
<p class="mb-4">2. Stop Loss: Below Kijun-sen (or Cloud bottom if closer)</p>
<p class="mb-4">3. Trailing Stop: Move stop to below Kijun as it rises</p>
<hr class="border-[#2a2e39] my-8">
<h2 id="4-risks-&-limitations">4. Risks & Limitations</h2>
<h3 id="failure-patterns">Failure Patterns</h3>
<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Pattern</td><td class="px-4 py-2 border-b border-[#2a2e39]">Description</td><td class="px-4 py-2 border-b border-[#2a2e39]">Mitigation</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Cloud Trap</td><td class="px-4 py-2 border-b border-[#2a2e39]">Price breaks Cloud, then reverses back inside</td><td class="px-4 py-2 border-b border-[#2a2e39]">Wait for close + Chikou confirmation</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Flat Kijun</td><td class="px-4 py-2 border-b border-[#2a2e39]">Kijun goes horizontal, TK crosses meaningless</td><td class="px-4 py-2 border-b border-[#2a2e39]">Avoid trading when Kijun slope = 0</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Market Gap</td><td class="px-4 py-2 border-b border-[#2a2e39]">Price gaps through Cloud, no equilibrium test</td><td class="px-4 py-2 border-b border-[#2a2e39]">Use volume confirmation on gaps</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Thin Cloud Entry</td><td class="px-4 py-2 border-b border-[#2a2e39]">Breakout into thin Cloud section</td><td class="px-4 py-2 border-b border-[#2a2e39]">Reduce size or wait for thicker Cloud</td></tr>
</table></div>
<h3 id="psychological-traps">Psychological Traps</h3>
<p class="mb-4">1. Complexity Paralysis  </p>
<p class="mb-4">   Five lines overwhelm new traders. Start by focusing on just Price vs. Cloud.</p>
<p class="mb-4">2. Over-Confirmation Bias  </p>
<p class="mb-4">   Waiting for "perfect" alignment means missing many trades. Accept moderate signals.</p>
<p class="mb-4">3. Ignoring the Chikou  </p>
<p class="mb-4">   The Chikou Span is often overlooked but is the ultimate filter. Use it.</p>
<h3 id="common-misinterpretations">Common Misinterpretations</h3>
<p class="mb-4">- "Thick Cloud = Strong Trend"  Thick Cloud = Strong *Support/Resistance*, not direction</p>
<p class="mb-4">- "TK Cross is the signal"  TK Cross is *one* component; check Cloud position and Chikou</p>
<p class="mb-4">- "Future Cloud predicts price"  Future Cloud shows projected *equilibrium zones*, not price</p>
<hr class="border-[#2a2e39] my-8">
<h2 id="5-further-study">5. Further Study</h2>
<h3 id="creator-attribution">Creator Attribution</h3>
<p class="mb-4">Goichi Hosoda (18981982), writing as "Ichimoku Sanjin," was a Japanese journalist who developed the system over 30 years. He famously employed university students to manually calculate and backtest formulas before computers existed. His seven-volume work *Ichimoku Kinko Hyo* remains the definitive reference.</p>
<h3 id="parent/child-indicators">Parent/Child Indicators</h3>
<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Indicator</td><td class="px-4 py-2 border-b border-[#2a2e39]">Relationship</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Tenkan-sen</td><td class="px-4 py-2 border-b border-[#2a2e39]">Component  9-period midpoint</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Kijun-sen</td><td class="px-4 py-2 border-b border-[#2a2e39]">Component  26-period midpoint</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Senkou Span A</td><td class="px-4 py-2 border-b border-[#2a2e39]">Component  Tenkan/Kijun average, projected</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Senkou Span B</td><td class="px-4 py-2 border-b border-[#2a2e39]">Component  52-period midpoint, projected</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Chikou Span</td><td class="px-4 py-2 border-b border-[#2a2e39]">Component  Current close, lagged</td></tr>
</table></div>
<h3 id="recommended-readings">Recommended Readings</h3>
<p class="mb-4">1. *Ichimoku Charts: An Introduction*  Nicole Elliott</p>
<p class="mb-4">2. *Cloud Charts*  David Linton</p>
<p class="mb-4">3. Original works by Goichi Hosoda (Japanese)</p>
<hr class="border-[#2a2e39] my-8">
<h3 id="55-related-indicators-comparison">5.5 Related Indicators Comparison</h3>
<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Feature</td><td class="px-4 py-2 border-b border-[#2a2e39]">Ichimoku</td><td class="px-4 py-2 border-b border-[#2a2e39]">Moving Averages</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bollinger Bands</td><td class="px-4 py-2 border-b border-[#2a2e39]">Parabolic SAR</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Measures</td><td class="px-4 py-2 border-b border-[#2a2e39]">Multi-timeframe equilibrium</td><td class="px-4 py-2 border-b border-[#2a2e39]">Single price average</td><td class="px-4 py-2 border-b border-[#2a2e39]">Volatility bands</td><td class="px-4 py-2 border-b border-[#2a2e39]">Trend reversal points</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Components</td><td class="px-4 py-2 border-b border-[#2a2e39]">5 lines + Cloud</td><td class="px-4 py-2 border-b border-[#2a2e39]">1-3 lines</td><td class="px-4 py-2 border-b border-[#2a2e39]">3 lines</td><td class="px-4 py-2 border-b border-[#2a2e39]">Dots</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Directional</td><td class="px-4 py-2 border-b border-[#2a2e39]">Via Cloud position</td><td class="px-4 py-2 border-b border-[#2a2e39]">Via slope</td><td class="px-4 py-2 border-b border-[#2a2e39]">Via band position</td><td class="px-4 py-2 border-b border-[#2a2e39]">Yes</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Forward Looking</td><td class="px-4 py-2 border-b border-[#2a2e39]">Yes (26 periods)</td><td class="px-4 py-2 border-b border-[#2a2e39]">No</td><td class="px-4 py-2 border-b border-[#2a2e39]">No</td><td class="px-4 py-2 border-b border-[#2a2e39]">No</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Complexity</td><td class="px-4 py-2 border-b border-[#2a2e39]">High</td><td class="px-4 py-2 border-b border-[#2a2e39]">Low</td><td class="px-4 py-2 border-b border-[#2a2e39]">Low</td><td class="px-4 py-2 border-b border-[#2a2e39]">Low</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Best Use</td><td class="px-4 py-2 border-b border-[#2a2e39]">Comprehensive trend system</td><td class="px-4 py-2 border-b border-[#2a2e39]">Simple trend</td><td class="px-4 py-2 border-b border-[#2a2e39]">Volatility/Mean reversion</td><td class="px-4 py-2 border-b border-[#2a2e39]">Trailing stops</td></tr>
</table></div>
<p class="mb-4">When to Use Which:</p>
<p class="mb-4">- Ichimoku  Complete system for trend identification, entry, and exit</p>
<p class="mb-4">- Moving Averages  Simple trend confirmation</p>
<p class="mb-4">- Bollinger Bands  Volatility expansion/contraction</p>
<p class="mb-4">- Parabolic SAR  Trailing stop placement</p>
<p class="mb-4"><h2 class="text-2xl font-bold mt-12 mb-6 border-b pb-2">PART 3: ADVANCED SIGNAL REFERENCE</h2></p>
<h2 id="advanced-signal-reference">Advanced Signal Reference</h2>
<h3 id="threshold-matrix">Threshold Matrix</h3>
<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Market State</td><td class="px-4 py-2 border-b border-[#2a2e39]">Cloud Position</td><td class="px-4 py-2 border-b border-[#2a2e39]">Interpretation</td><td class="px-4 py-2 border-b border-[#2a2e39]">Action</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Price >> Cloud</td><td class="px-4 py-2 border-b border-[#2a2e39]">Well above</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong uptrend</td><td class="px-4 py-2 border-b border-[#2a2e39]">Hold longs, trail stops</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Price > Cloud</td><td class="px-4 py-2 border-b border-[#2a2e39]">Just above</td><td class="px-4 py-2 border-b border-[#2a2e39]">Uptrend confirmed</td><td class="px-4 py-2 border-b border-[#2a2e39]">Enter/hold longs</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Price in Cloud</td><td class="px-4 py-2 border-b border-[#2a2e39]">Inside</td><td class="px-4 py-2 border-b border-[#2a2e39]">Neutral/Transition</td><td class="px-4 py-2 border-b border-[#2a2e39]">Reduce size or avoid</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Price < Cloud</td><td class="px-4 py-2 border-b border-[#2a2e39]">Just below</td><td class="px-4 py-2 border-b border-[#2a2e39]">Downtrend confirmed</td><td class="px-4 py-2 border-b border-[#2a2e39]">Enter/hold shorts</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Price << Cloud</td><td class="px-4 py-2 border-b border-[#2a2e39]">Well below</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong downtrend</td><td class="px-4 py-2 border-b border-[#2a2e39]">Hold shorts, trail stops</td></tr>
</table></div>
<h3 id="signal-patterns">Signal Patterns</h3>
<h4 id="buy-signal-full-alignment">Buy Signal (Full Alignment)</h4>
<p class="mb-4">This signal requires complete bullish alignment across all five Ichimoku components: price above cloud, Tenkan above Kijun, Chikou clear of past price, and bullish future cloud. The multi-layer confirmation naturally filters out many false signals. Studies show Ichimoku-filtered strategies reduce false breakouts by 30-40%.</p>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-python">
def ichimoku_buy_signal(price, tenkan, kijun, span_a, span_b, chikou, price_26_ago):
&nbsp;&nbsp;&nbsp;&nbsp;cloud_top = max(span_a, span_b)
&nbsp;&nbsp;&nbsp;&nbsp;cloud_bottom = min(span_a, span_b)
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;above_cloud = price &gt; cloud_top
&nbsp;&nbsp;&nbsp;&nbsp;tk_bullish = tenkan &gt; kijun
&nbsp;&nbsp;&nbsp;&nbsp;chikou_clear = chikou &gt; price_26_ago
&nbsp;&nbsp;&nbsp;&nbsp;future_cloud_bullish = span_a &gt; span_b  # at current position
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;return all([above_cloud, tk_bullish, chikou_clear, future_cloud_bullish])
</code></pre>
<h4 id="sell/exit-signal">Sell/Exit Signal</h4>
<p class="mb-4">This signal identifies bearish conditions requiring exit from long positions. A cross below the cloud or TK bearish cross inside/below cloud indicates structural breakdown. The signal prioritizes risk management by exiting when multi-timeframe alignment deteriorates.</p>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-python">
def ichimoku_exit_signal(price, tenkan, kijun, span_a, span_b, chikou, price_26_ago):
&nbsp;&nbsp;&nbsp;&nbsp;cloud_bottom = min(span_a, span_b)
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;below_cloud = price &lt; cloud_bottom
&nbsp;&nbsp;&nbsp;&nbsp;tk_bearish = tenkan &lt; kijun
&nbsp;&nbsp;&nbsp;&nbsp;chikou_trapped = chikou &lt; price_26_ago
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;return below_cloud or (tk_bearish and price &lt; max(span_a, span_b))
</code></pre>
<h4 id="kumo-twist-signal">Kumo Twist Signal</h4>
<p class="mb-4">This pattern detects when Senkou Span A crosses Senkou Span B in the projected future cloud, signaling an imminent change in trend equilibrium. A bullish twist (Span A crosses above B) often precedes significant upward moves, while bearish twists warn of downside. The date of the twist frequently coincides with significant price action.</p>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-python">
def kumo_twist_signal(span_a, span_a_prev, span_b, span_b_prev):
&nbsp;&nbsp;&nbsp;&nbsp;# Bullish twist: Span A crosses above Span B
&nbsp;&nbsp;&nbsp;&nbsp;bullish_twist = span_a &gt; span_b and span_a_prev &lt;= span_b_prev
&nbsp;&nbsp;&nbsp;&nbsp;# Bearish twist: Span A crosses below Span B
&nbsp;&nbsp;&nbsp;&nbsp;bearish_twist = span_a &lt; span_b and span_a_prev &gt;= span_b_prev
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;return bullish_twist, bearish_twist
</code></pre>
<h3 id="screening-filters">Screening Filters</h3>
<h4 id="bullish-breakout-scanner">Bullish Breakout Scanner</h4>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
Price &gt; Senkou_Span_A(26)
AND Price &gt; Senkou_Span_B(26)
AND Price[1] &lt;= MAX(Senkou_Span_A[1], Senkou_Span_B[1])  // Just broke out
AND Tenkan_Sen &gt; Kijun_Sen
AND Close &gt; Chikou_Span_Price[26]  // Chikou clear
</code></pre>
<h4 id="strong-trend-scanner">Strong Trend Scanner</h4>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
Price &gt; Senkou_Span_A(26) + ATR(14)  // Well above cloud
AND Tenkan_Sen &gt; Kijun_Sen
AND Kijun_Sen &gt; Kijun_Sen[5]  // Kijun rising
AND Senkou_Span_A &gt; Senkou_Span_B  // Bullish future cloud
</code></pre>
<h4 id="trend-reversal-warning">Trend Reversal Warning</h4>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
Senkou_Span_A crosses below Senkou_Span_B (Future Cloud, 26 periods ahead)
AND Price still above Cloud
// Warning: Future equilibrium turning bearish
</code></pre>
<h3 id="combination-strategies">Combination Strategies</h3>
<h4 id="ichimoku-+-rsi-momentum-strategy">Ichimoku + RSI Momentum Strategy</h4>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
FILTER:
&nbsp;&nbsp;Price &gt; Cloud (both spans)
&nbsp;&nbsp;Tenkan &gt; Kijun
&nbsp;&nbsp;
ENTRY:
&nbsp;&nbsp;RSI(14) dips below 40
&nbsp;&nbsp;RSI(14) crosses back above 40
&nbsp;&nbsp;
STOP_LOSS:
&nbsp;&nbsp;Below Kijun-sen
&nbsp;&nbsp;
TAKE_PROFIT:
&nbsp;&nbsp;RSI &gt; 70 OR Tenkan crosses below Kijun
</code></pre>
<h4 id="ichimoku-+-volume-breakout-strategy">Ichimoku + Volume Breakout Strategy</h4>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
SETUP:
&nbsp;&nbsp;Price inside Cloud (consolidation)
&nbsp;&nbsp;Volume declining (coiling)
&nbsp;&nbsp;
TRIGGER:
&nbsp;&nbsp;Price closes above Cloud
&nbsp;&nbsp;Volume &gt; 2  SMA(Volume, 20)
&nbsp;&nbsp;
CONFIRMATION:
&nbsp;&nbsp;Next candle holds above Cloud
&nbsp;&nbsp;Chikou Span clear of past price
&nbsp;&nbsp;
STOP_LOSS:
&nbsp;&nbsp;Below Cloud or Kijun-sen (whichever higher)
</code></pre>
</div>
</article>
<aside class="hidden lg:block w-64 flex-shrink-0">
<div class="sticky top-24">
<h3 class="font-bold text-slate-900 mb-4 pb-2 border-b border-slate-100 text-sm uppercase tracking-wider">
On this page
</h3>
<nav id="toc-nav" class="space-y-1 text-sm text-slate-600">
<a href="#1-identity" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">1. Identity</a>
<a href="#2-calculation-logic" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">2. Calculation Logic</a>
<a href="#formula" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Formula</a>
<a href="#real-world-analogy" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Real-World Analogy</a>
<a href="#3-market-standards" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">3. Market Standards</a>
<a href="#default-parameters" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Default Parameters</a>
<a href="#alternative-parameters" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Alternative Parameters</a>
<a href="#timeframe-recommendations" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Timeframe Recommendations</a>
<a href="#4-market-context" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">4. Market Context</a>
<a href="#best-conditions" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Best Conditions</a>
<a href="#limitations" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Limitations</a>
<a href="#asset-class-suitability" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Asset Class Suitability</a>
<a href="#5-entry-signals" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">5. Entry Signals</a>
<a href="#primary-buy-signal" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Primary Buy Signal</a>
<a href="#primary-sell/exit-signal" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Primary Sell/Exit Signal</a>
<a href="#6-filter-usage" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">6. Filter Usage</a>
<a href="#filter-rules" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Filter Rules</a>
<a href="#recommended-pairings" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Recommended Pairings</a>
<a href="#example-combined-strategy" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Example Combined Strategy</a>
<a href="#7-practical-cautions" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">7. Practical Cautions</a>
<a href="#lag-characteristics" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Lag Characteristics</a>
<a href="#false-signal-scenarios" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">False Signal Scenarios</a>
<a href="#mitigation-strategies" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Mitigation Strategies</a>
<a href="#8-pro-insights" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">8. Pro Insights</a>
<a href="#the-kumo-shadow-strategy" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">The Kumo Shadow Strategy</a>
<a href="#the-future-cloud-as-a-time-target" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">The Future Cloud as a Time Target</a>
<a href="#portfolio-selection-technique" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Portfolio Selection Technique</a>
<a href="#9-summary" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">9. Summary</a>
<a href="#1-core-concept" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">1. Core Concept</a>
<a href="#2-statistical-edge" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">2. Statistical Edge</a>
<a href="#why-it-works" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Why It Works</a>
<a href="#backtest-context" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Backtest Context</a>
<a href="#academic-reference" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Academic Reference</a>
<a href="#3-actionable-strategy" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">3. Actionable Strategy</a>
<a href="#strategy-name:-"triple-cloud-confirmation"" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Strategy Name: "Triple Cloud Confirmation"</a>
<a href="#4-risks-&-limitations" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">4. Risks & Limitations</a>
<a href="#failure-patterns" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Failure Patterns</a>
<a href="#psychological-traps" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Psychological Traps</a>
<a href="#common-misinterpretations" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Common Misinterpretations</a>
<a href="#5-further-study" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">5. Further Study</a>
<a href="#creator-attribution" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Creator Attribution</a>
<a href="#parent/child-indicators" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Parent/Child Indicators</a>
<a href="#recommended-readings" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Recommended Readings</a>
<a href="#55-related-indicators-comparison" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">5.5 Related Indicators Comparison</a>
<a href="#advanced-signal-reference" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">Advanced Signal Reference</a>
<a href="#threshold-matrix" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Threshold Matrix</a>
<a href="#signal-patterns" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Signal Patterns</a>
<a href="#screening-filters" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Screening Filters</a>
<a href="#combination-strategies" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Combination Strategies</a>
</nav>
<div class="mt-8 pt-4 border-t border-slate-100">
<a href="#" class="text-xs text-slate-400 hover:text-indigo-600 flex items-center transition-colors">
Back to Top
</a>
</div>
</div>
</aside>
</div>
</section>
</div>
<footer class="bg-white border-t border-slate-200 mt-12">
<div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
<p class="text-center text-slate-400 text-sm">
&copy; 2023-2025 I ant I Investigates. All rights reserved.
</p>
</div>
</footer>
<script>
window.IndicatorLogic = {
name: "Ichimoku",
params: [],
calculate: null
};
(function() {
try {
const injectedCode = `
window.IndicatorLogic = {
calculate: (data, params) => {
if (typeof Ichimoku !== 'undefined') {
return Ichimoku.calculate(data,
params.tenkan || 9,
params.kijun || 26,
params.spanB || 52,
params.displacement || 26
);
}
throw new Error("Ichimoku class is not available.");
}
};
`;
const isTemplatePlaceholder = injectedCode.includes('{{') && injectedCode.includes('PLAYGROUND_LOGIC');
if (injectedCode && injectedCode.trim().length > 0 && !isTemplatePlaceholder) {
new Function(injectedCode)();
} else {
console.warn("Playground Logic: Running in Preview/Fallback mode.");
window.IndicatorLogic.calculate = () => [];
}
} catch (e) {
console.error("Critical Error in Logic Injection:", e);
window.IndicatorLogic.calculate = () => [];
}
})();
</script>
<script>
mermaid.initialize({ startOnLoad: true, theme: 'neutral', securityLevel: 'loose' });
</script>
<script src="../../assets/js/script.js" defer></script>
<script>
// --- 0. Indicator Data Injection ---
// These are populated by the generator script
var IndicatorLogic = {};
var IndicatorConfig = [];
var IndicatorDisplay = { isOverlay: false, plots: {} };
// 1. Library Code (e.g. class definitions)
class Ichimoku {
constructor(tenkanPeriod = 9, kijunPeriod = 26, senkouSpanBPeriod = 52, displacement = 26) {
this.tenkanPeriod = tenkanPeriod;
this.kijunPeriod = kijunPeriod;
this.senkouSpanBPeriod = senkouSpanBPeriod;
this.displacement = displacement;
}
calculate(candles) {
if (!candles || candles.length === 0) return;
const count = candles.length;
// Prepare arrays aligned with input candles
// However, Chart.js plots based on index.
// Chikou is shifted BACKWARDS (left). Value at i is plotted at i - displacement.
// Senkou A/B are shifted FORWARDS (right). Value at i is plotted at i + displacement.
// To make it easy for Chart.js, we will return arrays where index matches the candle's time.
// BUT for projected values (Cloud), we need to extend into the future?
// Or simply aligning valid values.
// Standard approach for web charts:
// Return arrays of same length as input, filled with null where no data.
// Future cloud requires extending the X-axis, which Playground might not support yet.
// For now, we align to the extent of 'candles' PLUS future displacement if possible.
// But PlaygroundController maps specific time indices.
// Let's stick to 1:1 mapping with candles for now, and handle shifts by padding.
const tenkanRaw = [];
const kijunRaw = [];
const spanARaw = [];
const spanBRaw = [];
// 1. Calculate Raw Components (at current candle i)
for (let i = 0; i < count; i++) {
tenkanRaw.push(this._midpoint(candles, i, this.tenkanPeriod));
kijunRaw.push(this._midpoint(candles, i, this.kijunPeriod));
spanBRaw.push(this._midpoint(candles, i, this.senkouSpanBPeriod));
}
// 2. Calculate Span A (from raw Tenkan/Kijun)
for (let i = 0; i < count; i++) {
if (tenkanRaw[i] !== null && kijunRaw[i] !== null) {
spanARaw.push((tenkanRaw[i] + kijunRaw[i]) / 2);
} else {
spanARaw.push(null);
}
}
// 3. Construct Final Arrays with Shifts
// Chart.js plots array index i at x-axis label i.
// We need to align the shifts relative to the input candles.
// Chikou Span (Lagging): Current Close plotted 26 periods ago.
// Value at index i should be the Close from i+26.
// The first 26 values will be null because there is no "future" close to pull back yet (if we only have 'count' candles).
// Wait, standard definition: "Plot current close 26 periods behind."
// So at index i, we plot Close[i]. But visually it appears at i-26.
// Chart.js doesn't do "visual shift" easily without altering data index.
// So we shift the data in the array:
// Array[i] should contain the value that belongs at time i.
// If Chikou at time T is Close[T+26], then:
// Array[i] = Close[i + 26]
const chikou = new Array(count).fill(null);
for (let i = 0; i < count - this.displacement; i++) {
chikou[i] = candles[i + this.displacement].close;
}
// Senkou Span A/B (Leading): Calculated at T, plotted at T+26.
// Value at index i should be the calculation from i-26.
// Array[i] = Calculation[i - 26]
const spanA = new Array(count).fill(null);
const spanB = new Array(count).fill(null);
for (let i = this.displacement; i < count; i++) {
spanA[i] = spanARaw[i - this.displacement];
spanB[i] = spanBRaw[i - this.displacement];
}
// Note: Ideally, for Cloud, we want to project into the future (indices >= count).
// But PlaygroundController currently maps 1:1 with input data length for chart labels.
// So we only fill up to 'count'. Future cloud values are computed but truncated here.
// To show future cloud, the Chart labels/data need to be extended, which requires
// PlaygroundController update. For now, we show the cloud up to "Today".
this.tenkanSen = tenkanRaw;
this.kijunSen = kijunRaw;
this.senkouSpanA = spanA;
this.senkouSpanB = spanB;
this.chikouSpan = chikou;
}
_midpoint(candles, index, period) {
if (index < period - 1) return null;
let highest = -Infinity;
let lowest = Infinity;
for (let i = index - period + 1; i <= index; i++) {
const c = candles[i];
// Fallback for missing high/low
const h = (c.high !== undefined) ? c.high : c.close;
const l = (c.low !== undefined) ? c.low : c.close;
if (h > highest) highest = h;
if (l < lowest) lowest = l;
}
return (highest + lowest) / 2;
}
static calculate(candles, tenkan = 9, kijun = 26, spanB = 52, displacement = 26) {
const ichi = new Ichimoku(tenkan, kijun, spanB, displacement);
ichi.calculate(candles);
return {
tenkan: ichi.tenkanSen,
kijun: ichi.kijunSen,
spanA: ichi.senkouSpanA,
spanB: ichi.senkouSpanB,
chikou: ichi.chikouSpan
};
}
}
//
// 2. Configuration
try {
var rawConfig = '[{"id": "tenkan", "label": "Tenkan (9)", "type": "number", "value": 9, "min": 2, "max": 100}, {"id": "kijun", "label": "Kijun (26)", "type": "number", "value": 26, "min": 2, "max": 200}, {"id": "spanB", "label": "Span B (52)", "type": "number", "value": 52, "min": 2, "max": 300}, {"id": "displacement", "label": "Shift (26)", "type": "number", "value": 26, "min": 0, "max": 100}]';
if(rawConfig && !rawConfig.startsWith('{{')) IndicatorConfig = JSON.parse(rawConfig);
} catch(e){ console.warn('Config parse error', e); }
try {
var rawDisplay = '{"isOverlay": true, "plots": {"tenkan": {"label": "Tenkan-sen", "color": "#EF4444"}, "kijun": {"label": "Kijun-sen", "color": "#3B82F6"}, "spanA": {"label": "Span A", "color": "#10B981"}, "spanB": {"label": "Span B", "color": "#D946EF"}, "chikou": {"label": "Chikou Span", "color": "#8B5CF6"}}}';
if(rawDisplay && !rawDisplay.startsWith('{{')) IndicatorDisplay = JSON.parse(rawDisplay);
} catch(e){ console.warn('Display parse error', e); }
// 3. Logic Adapter
window.IndicatorLogic = {
calculate: (data, params) => {
if (typeof Ichimoku !== 'undefined') {
return Ichimoku.calculate(data,
params.tenkan || 9,
params.kijun || 26,
params.spanB || 52,
params.displacement || 26
);
}
throw new Error("Ichimoku class is not available.");
}
};
</script>
<script>
// --- 1. Code Panel Logic ---
const AppState = {
activeLang: 'csharp',
codeType: 'simple',
isPanelVisible: false,  // Start hidden to show flowchart
isPanelExpanded: false,
};
// --- 2. Canvas State (Full Pan/Zoom from 0117) ---
const CanvasState = {
scale: 1, panX: 0, panY: 0,
isDragging: false, startX: 0, startY: 0,
minScale: 0.1, maxScale: 5.0
};
// Element references (populated after DOM ready)
let els = {};
function updateView() {
// 1. Code Content Visibility
document.querySelectorAll('.code-content').forEach(el => el.classList.add('hidden'));
const activeId = `code-${AppState.activeLang}-${AppState.codeType}`;
const activeEl = document.getElementById(activeId);
if (activeEl) activeEl.classList.remove('hidden');
// 2. Overlay Visibility
const overlay = document.getElementById('code-panel-overlay');
if (overlay) {
if (AppState.isPanelVisible) overlay.classList.remove('panel-hidden');
else overlay.classList.add('panel-hidden');
if (AppState.isPanelExpanded) {
overlay.classList.add('panel-expanded');
const iconExp = document.getElementById('icon-expand');
const iconCol = document.getElementById('icon-collapse');
if(iconExp) iconExp.classList.add('hidden');
if(iconCol) iconCol.classList.remove('hidden');
} else {
overlay.classList.remove('panel-expanded');
const iconExp = document.getElementById('icon-expand');
const iconCol = document.getElementById('icon-collapse');
if(iconExp) iconExp.classList.remove('hidden');
if(iconCol) iconCol.classList.add('hidden');
}
}
// 3. Button States
const btnCs = document.getElementById('btn-lang-csharp');
const btnPy = document.getElementById('btn-lang-python');
[btnCs, btnPy].forEach(btn => {
if(btn) btn.className = "px-2 py-1 text-xs rounded transition-colors text-slate-500 hover:bg-slate-100";
});
if (AppState.activeLang === 'csharp' && btnCs) {
btnCs.className = "px-2 py-1 text-xs rounded transition-colors btn-lang-active";
} else if (AppState.activeLang === 'python' && btnPy) {
btnPy.className = "px-2 py-1 text-xs rounded transition-colors btn-lang-active";
}
const btnSimple = document.getElementById('btn-type-simple');
const btnDetailed = document.getElementById('btn-type-detailed');
if(btnSimple) btnSimple.className = `text-xs transition-colors ${AppState.codeType === 'simple' ? 'btn-type-active' : 'text-slate-500 hover:text-indigo-600'}`;
if(btnDetailed) btnDetailed.className = `text-xs transition-colors ${AppState.codeType === 'detailed' ? 'btn-type-active' : 'text-slate-500 hover:text-indigo-600'}`;
}
// Global exports for inline onclick handlers
window.setLang = (lang) => { AppState.activeLang = lang; updateView(); }
window.setType = (type) => { AppState.codeType = type; updateView(); }
window.toggleCodePanel = () => { AppState.isPanelVisible = !AppState.isPanelVisible; updateView(); }
window.toggleExpand = () => { AppState.isPanelExpanded = !AppState.isPanelExpanded; updateView(); }
window.copyCode = async () => {
const activeId = `code-${AppState.activeLang}-${AppState.codeType}`;
const el = document.getElementById(activeId);
if (!el) return;
let text = "";
const lines = el.querySelectorAll('.code-line');
if (lines.length > 0) {
text = Array.from(lines).map(line => line.textContent).join('\n');
} else {
text = el.textContent;
}
try {
await navigator.clipboard.writeText(text);
const iconCopy = document.getElementById('icon-copy');
const iconDone = document.getElementById('icon-copy-done');
if (iconCopy && iconDone) {
iconCopy.classList.add('hidden');
iconDone.classList.remove('hidden');
setTimeout(() => {
iconCopy.classList.remove('hidden');
iconDone.classList.add('hidden');
}, 2000);
}
} catch (err) { console.error("Failed to copy:", err); }
}
// --- Canvas Transform Functions (Full Pan/Zoom) ---
// PlaygroundController (Ported from template_0117.html)
window.PlaygroundController = {
instanceChart: null,
showError: (msg) => {
console.error('Playground Error:', msg);
const outputEl = document.getElementById('output-data');
if (outputEl) outputEl.value = 'Error: ' + msg;
},
clearError: () => {},
init: () => {
try {
// 1. Render Dynamic Settings if Config exists
const settingsContainer = document.getElementById('settings-container');
if (IndicatorConfig && Array.isArray(IndicatorConfig) && IndicatorConfig.length > 0 && settingsContainer) {
settingsContainer.innerHTML = ''; // Clear default "Period"
IndicatorConfig.forEach(cfg => {
const div = document.createElement('div');
div.className = "flex flex-col";
const label = document.createElement('label');
label.className = "text-xs text-slate-400 mb-1";
label.textContent = cfg.label;
const input = document.createElement('input');
input.id = `param-${cfg.id}`;
input.type = cfg.type || "number";
// Light theme styling to match textarea
input.className = "bg-white border border-slate-300 rounded px-2 py-1 text-sm text-slate-800 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-shadow";
input.value = cfg.value;
if(cfg.min !== undefined) input.min = cfg.min;
if(cfg.max !== undefined) input.max = cfg.max;
// Add change listener to auto-update
input.addEventListener('change', PlaygroundController.update);
div.appendChild(label);
div.appendChild(input);
settingsContainer.appendChild(div);
});
}
// 2. Generate Initial Random Sample Data (Default to Single for simplicity, or OHLCV)
PlaygroundController.generateSample('ohlcv'); // Default to OHLCV for robustness
} catch(e) { PlaygroundController.showError(e.message); }
},
generateSample: (type) => {
const sampleData = [];
const count = 150;
let price = 100;
if (type === 'ohlcv') {
// OHLCV Generation
sampleData.push("Date,Open,High,Low,Close,Volume");
const now = new Date();
for (let i = 0; i < count; i++) {
const date = new Date(now.getTime() - (count - i) * 86400000).toISOString().split('T')[0];
const trend = Math.sin(i * 0.1) * 2;
const noise = (Math.random() - 0.5) * 2;
const close = 100 + trend + noise + (i * 0.1);
const open = close + (Math.random() - 0.5);
const high = Math.max(open, close) + Math.random();
const low = Math.min(open, close) - Math.random();
const vol = Math.floor(1000 + Math.random() * 500);
sampleData.push(`${date},${open.toFixed(2)},${high.toFixed(2)},${low.toFixed(2)},${close.toFixed(2)},${vol}`);
}
} else {
// Single Value Generation
for (let i = 0; i < count; i++) {
price = price + (Math.random() - 0.5) * 5;
sampleData.push(price.toFixed(2));
}
}
const inputEl = document.getElementById('input-data');
if (inputEl) inputEl.value = sampleData.join('\n');
PlaygroundController.update();
},
update: () => {
PlaygroundController.clearError();
// Dynamic Params Collection
const params = {};
if (IndicatorConfig && Array.isArray(IndicatorConfig) && IndicatorConfig.length > 0) {
IndicatorConfig.forEach(cfg => {
const el = document.getElementById(`param-${cfg.id}`);
if (el) params[cfg.id] = parseFloat(el.value);
});
} else {
// Fallback to default Period if no config
const periodEl = document.getElementById('param-period');
params.period = periodEl ? parseInt(periodEl.value) || 14 : 14;
}
const rawData = document.getElementById('input-data').value.trim();
let lines = [];
// Robust split: handle comma, newline, or mixed
if (rawData.includes('\n')) {
// Split by newline first
lines = rawData.split('\n').map(l => l.trim()).filter(l => l);
// If it's NOT multi-column (header check), and lines contain commas, try to flatten
const firstVal = parseFloat(lines[0].split(/[,\t]/)[0]);
const isHeader = isNaN(firstVal) && /[a-zA-Z]/.test(lines[0]);
if (!isHeader && lines.some(l => l.includes(','))) {
// Flatten mixed content like "100, 101\n102, 103"
lines = rawData.split(/[\n,]+/).map(l => l.trim()).filter(l => l);
}
} else {
// Single line, split by comma
lines = rawData.split(',').map(l => l.trim()).filter(l => l);
}
let parsedData = [];
const firstLine = lines[0] || "";
const firstVal = parseFloat(firstLine.split(/[,\t]/)[0]);
const isMultiColumn = isNaN(firstVal) && /[a-zA-Z]/.test(firstLine);
if (isMultiColumn && lines.length > 1) {
const headers = firstLine.split(/[,\t]+/).map(h => h.trim().toLowerCase());
for (let i = 1; i < lines.length; i++) {
const parts = lines[i].split(/[,\t]+/).map(v => parseFloat(v));
if (parts.some(isNaN)) continue;
const row = { time: i - 1 };
headers.forEach((h, idx) => { row[h] = parts[idx]; });
if (row.close === undefined && row.c !== undefined) row.close = row.c;
parsedData.push(row);
}
} else {
parsedData = lines.map((l, i) => {
const val = parseFloat(l);
return isNaN(val) ? null : { time: i, close: val };
}).filter(d => d);
}
if (parsedData.length < 2) {
PlaygroundController.showError("Insufficient data.");
return;
}
let indicatorValues = [];
try {
if (typeof IndicatorLogic !== 'undefined' && IndicatorLogic.calculate) {
indicatorValues = IndicatorLogic.calculate(parsedData, params);
} else {
// Fallback: Simple RSI calculation for demo
indicatorValues = PlaygroundController.calculateRSI(parsedData, params.period);
}
} catch (e) {
console.error("Calculation Error", e);
PlaygroundController.showError("Calculation Error: " + e.message);
return;
}
// --- Format Output (CSV/TSV for Excel) ---
const outputEl = document.getElementById('output-data');
// --- Format Output (CSV/TSV for Excel) ---
if (outputEl) {
if (Array.isArray(indicatorValues)) {
// Single Array (e.g. RSI)
outputEl.value = indicatorValues.map(v => v === null ? "" : v).join('\n');
} else if (typeof indicatorValues === 'object') {
// Multi-line Object (e.g. Ichimoku)
const keys = Object.keys(indicatorValues);
if (keys.length === 0) {
outputEl.value = "";
} else {
const length = indicatorValues[keys[0]].length;
// Comma separated as requested by user
const separator = ',';
let csv = keys.join(separator) + '\n';
for (let i = 0; i < length; i++) {
const row = keys.map(k => {
const val = indicatorValues[k][i];
// Handle missing/undefined
return (val === null || val === undefined) ? "" : val;
});
csv += row.join(separator) + '\n';
}
outputEl.value = csv;
}
} else {
outputEl.value = JSON.stringify(indicatorValues, null, 2);
}
}
PlaygroundController.renderChart(parsedData, indicatorValues);
},
calculateRSI: (data, period) => {
// Simple RSI fallback
const values = [];
values.push(null); // First value is null
if (data.length < 2) return values;
let sumGains = 0, sumLosses = 0;
for (let i = 1; i < data.length; i++) {
const change = data[i].close - data[i-1].close;
const gain = change > 0 ? change : 0;
const loss = change < 0 ? -change : 0;
if (i < period) {
sumGains += gain; sumLosses += loss;
values.push(null);
continue;
}
if (i === period) {
sumGains += gain; sumLosses += loss;
const avgGain = sumGains / period;
const avgLoss = sumLosses / period;
const rs = avgLoss < 0.0001 ? 100 : avgGain / avgLoss;
values.push(100 - (100 / (1 + rs)));
sumGains = avgGain; sumLosses = avgLoss;
continue;
}
sumGains = (sumGains * (period - 1) + gain) / period;
sumLosses = (sumLosses * (period - 1) + loss) / period;
const rs = sumLosses < 0.0001 ? 100 : sumGains / sumLosses;
values.push(100 - (100 / (1 + rs)));
}
return values;
},
renderChart: (prices, indicatorValues) => {
const canvas = document.getElementById('indicatorChart');
if (!canvas) return;
const ctx = canvas.getContext('2d');
const labels = prices.map((_, i) => i);
if (PlaygroundController.instanceChart) PlaygroundController.instanceChart.destroy();
const datasets = [];
// 1. Overlay: Close Price (if enabled)
if (IndicatorDisplay && IndicatorDisplay.isOverlay) {
datasets.push({
label: 'Close Price',
data: prices.map(p => p.close),
borderColor: '#94a3b8', // slate-400
backgroundColor: 'transparent',
borderDash: [5, 5],
borderWidth: 1,
pointRadius: 0,
tension: 0.1
});
}
// 2. Indicator Data
const defaultColors = ['#4F46E5', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6'];
if (Array.isArray(indicatorValues)) {
datasets.push({
label: 'Indicator',
data: indicatorValues,
borderColor: IndicatorDisplay.plots && IndicatorDisplay.plots.main ? IndicatorDisplay.plots.main.color : '#4F46E5',
backgroundColor: 'transparent',
tension: 0.1, pointRadius: 0, borderWidth: 2
});
} else if (typeof indicatorValues === 'object' && indicatorValues !== null) {
// Multi-line indicator
Object.keys(indicatorValues).forEach((key, idx) => {
const conf = (IndicatorDisplay.plots && IndicatorDisplay.plots[key]) || {};
const color = conf.color || defaultColors[idx % defaultColors.length];
datasets.push({
label: conf.label || key,
data: indicatorValues[key],
borderColor: color,
backgroundColor: 'transparent', // TODO: fill logic
tension: 0.1, pointRadius: 0, borderWidth: 2
});
});
}
PlaygroundController.instanceChart = new Chart(ctx, {
type: 'line',
data: { labels: labels, datasets: datasets },
options: {
responsive: true, maintainAspectRatio: false,
interaction: { mode: 'index', intersect: false },
scales: {
y: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'Value' } }
}
}
});
}
};
function updateTransform() {
if (els.content) {
els.content.style.transform = `translate(${CanvasState.panX}px, ${CanvasState.panY}px) scale(${CanvasState.scale})`;
}
}
function handleWheel(e) {
e.preventDefault();
const rect = els.container.getBoundingClientRect();
const mouseX = e.clientX - rect.left;
const mouseY = e.clientY - rect.top;
const zoomSensitivity = 0.001;
const delta = -e.deltaY * zoomSensitivity;
let newScale = CanvasState.scale * (1 + delta);
newScale = Math.max(CanvasState.minScale, Math.min(CanvasState.maxScale, newScale));
const scaleRatio = newScale / CanvasState.scale;
CanvasState.panX = mouseX - (mouseX - CanvasState.panX) * scaleRatio;
CanvasState.panY = mouseY - (mouseY - CanvasState.panY) * scaleRatio;
CanvasState.scale = newScale;
updateTransform();
}
function startDrag(e) {
if (e.button !== 0 && e.button !== 1) return;
CanvasState.isDragging = true;
CanvasState.startX = e.clientX;
CanvasState.startY = e.clientY;
els.container.style.cursor = 'grabbing';
}
function drag(e) {
if (!CanvasState.isDragging) return;
e.preventDefault();
const dx = e.clientX - CanvasState.startX;
const dy = e.clientY - CanvasState.startY;
CanvasState.panX += dx;
CanvasState.panY += dy;
CanvasState.startX = e.clientX;
CanvasState.startY = e.clientY;
updateTransform();
}
function stopDrag() {
CanvasState.isDragging = false;
if (els.container) els.container.style.cursor = 'grab';
}
window.zoomAction = (direction) => {
if (!els.container || !els.content) return;
const factor = direction === 'in' ? 1.2 : 0.8;
let newScale = CanvasState.scale * factor;
newScale = Math.max(CanvasState.minScale, Math.min(CanvasState.maxScale, newScale));
const rect = els.container.getBoundingClientRect();
const cx = rect.width / 2;
const cy = rect.height / 2;
const scaleRatio = newScale / CanvasState.scale;
CanvasState.panX = cx - (cx - CanvasState.panX) * scaleRatio;
CanvasState.panY = cy - (cy - CanvasState.panY) * scaleRatio;
CanvasState.scale = newScale;
updateTransform();
}
window.resetView = () => { centerContent(); }
function centerContent() {
if (!els.content || !els.container) return;
const containerRect = els.container.getBoundingClientRect();
const unscaledWidth = els.content.scrollWidth;
const unscaledHeight = els.content.scrollHeight;
let initialScale = 1.0;
if (unscaledWidth > containerRect.width) {
initialScale = (containerRect.width / unscaledWidth) * 0.9;
}
initialScale = Math.max(0.5, Math.min(1.0, initialScale));
CanvasState.scale = initialScale;
CanvasState.panX = (containerRect.width - unscaledWidth * initialScale) / 2;
CanvasState.panY = (containerRect.height - unscaledHeight * initialScale) / 2;
CanvasState.panY = Math.max(20, CanvasState.panY);
updateTransform();
}
// --- 3. Init ---
document.addEventListener('DOMContentLoaded', async () => {
// Bind element references
els.container = document.getElementById('canvas-container');
els.content = document.getElementById('canvas-content');
// Init code panel state
updateView();
// Init Playground
if (window.PlaygroundController) PlaygroundController.init();
// Mermaid rendering + center
if (window.mermaid) {
try {
const nodes = document.querySelectorAll('.mermaid');
if (nodes.length > 0) {
await mermaid.run({ nodes: nodes });
setTimeout(centerContent, 100);
}
} catch (e) { console.error("Mermaid render failed", e); }
}
// Canvas Events (Wheel zoom + Drag pan)
if (els.container) {
els.container.addEventListener('wheel', handleWheel, { passive: false });
els.container.addEventListener('mousedown', startDrag);
window.addEventListener('mousemove', drag);
window.addEventListener('mouseup', stopDrag);
}
// KaTeX Auto Render
if (window.renderMathInElement) {
renderMathInElement(document.body, {
delimiters: [
{left: '$$', right: '$$', display: true},
{left: '$', right: '$', display: false},
{left: '\\(', right: '\\)', display: false},
{left: '\\[', right: '\\]', display: true}
],
throwOnError: false
});
}
// TOC ScrollSpy
const tocLinks = document.querySelectorAll('.toc-link');
if (tocLinks.length > 0) {
const headings = document.querySelectorAll('article h2[id], article h3[id]');
const observer = new IntersectionObserver((entries) => {
entries.forEach(entry => {
if (entry.isIntersecting) {
tocLinks.forEach(link => link.classList.remove('active'));
const id = entry.target.getAttribute('id');
const activeLink = document.querySelector(`.toc-link[href="#${id}"]`);
if (activeLink) activeLink.classList.add('active');
}
});
}, { rootMargin: '-20% 0px -60% 0px' });
headings.forEach(h => observer.observe(h));
}
// Load Sample buttons
const btnOhlcv = document.getElementById('btn-load-sample-ohlcv');
if (btnOhlcv) {
btnOhlcv.addEventListener('click', () => {
if (window.PlaygroundController) PlaygroundController.generateSample('ohlcv');
});
}
const btnSingle = document.getElementById('btn-load-sample-single');
if (btnSingle) {
btnSingle.addEventListener('click', () => {
if (window.PlaygroundController) PlaygroundController.generateSample('single');
});
}
});
</script>
</body>
</html>