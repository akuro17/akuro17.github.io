<!DOCTYPE html>
<html lang="ja" class="scroll-smooth">
<head>
        <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KaufmanAdaptiveMovingAverage - I ant I Investigates</title>
    <meta name="description" content="KaufmanAdaptiveMovingAverage - Technical Indicator">
    <meta name="keywords" content="KaufmanAdaptiveMovingAverage, technical indicator, stock analysis">
    <!-- Canonical URL -->
    <link rel="canonical" href="https://iantinvestigates.com/indicators/kaufmanadaptivemovingaverage.html">
    <!-- OGP (Open Graph Protocol) -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="KaufmanAdaptiveMovingAverage - I ant I Investigates">
    <meta property="og:description" content="KaufmanAdaptiveMovingAverage - Technical Indicator">
    <meta property="og:url" content="https://iantinvestigates.com/indicators/kaufmanadaptivemovingaverage.html">
    <meta property="og:site_name" content="I ant I Investigates">
    <meta property="og:image" content="https://iantinvestigates.com/assets/images/ogp/kaufmanadaptivemovingaverage.png">
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="KaufmanAdaptiveMovingAverage">
    <meta name="twitter:description" content="KaufmanAdaptiveMovingAverage - Technical Indicator">
    <meta name="twitter:image" content="https://iantinvestigates.com/assets/images/ogp/kaufmanadaptivemovingaverage.png">
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    </script>
    <!-- Resource Hints -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <!-- Styles -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/indicator.css">
    <!-- KaTeX (Math) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <!-- Libraries (defer for non-blocking load) -->
    <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <!-- Pygments Syntax Highlighting (Externalized) -->
    <link rel="stylesheet" href="../assets/css/pygments.css">

</head>
<body class="bg-slate-50 text-slate-800 font-sans antialiased relative">
        <!-- Navigation -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center mr-6">
                        <a href="../index.html" class="font-bold text-xl text-indigo-600">
                            I ant I Investigates
                        </a>
                    </div>
                    <!-- Breadcrumbs (Moved Here) -->
                    <nav class="flex text-sm text-slate-500 mr-8" aria-label="Breadcrumb">
                        <ol class="flex items-center space-x-2">
                            <li><a href="../index.html" class="hover:text-indigo-600 transition-colors">home</a></li>
                            <li><span class="mx-1">/</span></li>
                            <li><a href="./" class="hover:text-indigo-600 transition-colors">indicators</a></li>
                            <li><span class="mx-1">/</span></li>
                            <li><span class="font-medium text-slate-900">KaufmanAdaptiveMovingAverage</span></li>
                        </ol>
                    </nav>

                    <!-- Page Top Nav (Anchor Links) -->
                    <div class="flex space-x-4 items-center">
                        <a href="#interactive-playground" class="text-slate-600 hover:text-indigo-600 px-3 py-2 text-sm font-medium transition-colors">
                            Chart
                        </a>
                        <a href="#logic-visualization" class="text-slate-600 hover:text-indigo-600 px-3 py-2 text-sm font-medium transition-colors">
                            Logic
                        </a>
                        <a href="#documentation" class="text-slate-600 hover:text-indigo-600 px-3 py-2 text-sm font-medium transition-colors">
                            Docs
                        </a>
                    </div>
                </div>
                <!-- External Links Placeholder -->
                <div class="hidden sm:flex items-center">
                </div>
            </div>
        </div>
    </nav>
    <!-- Main Container: 1-Column Stack -->
    <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12">
        <!-- ======================================================= -->
        <!-- TOP SECTION: CONTEXT & PLAYGROUND                       -->
        <!-- ======================================================= -->
        <div class="flex flex-col gap-6">
            <!-- Hero Header -->
            <header>
                <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4 leading-tight">KaufmanAdaptiveMovingAverage</h1>
                <p class="text-lg text-slate-600 leading-relaxed">KAMA is an intelligent moving average that automatically adjusts its sensitivity based on market noise—speeding up during trends and slowing down during sideways chop to minimize false signals.</p>
            </header>

            <!-- Interactive Playground -->
            <section id="interactive-playground" class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden scroll-mt-24">
                <div class="border-b border-slate-200 bg-indigo-50 px-6 py-4">
                    <h2 class="text-lg font-bold text-slate-800 flex items-center">
                        <span class="bg-indigo-600 text-white p-1 rounded mr-3 text-xs shadow-sm font-mono">C</span>
                        Calculator
                    </h2>
                    <p class="text-sm text-slate-600 mt-2">Calculate indicator values from your price data.</p>
                </div>
                <div class="p-6">
                    <!-- Chart Area -->
                    <div class="relative h-[400px] w-full mb-6 border border-slate-100 rounded bg-slate-50">
                        <canvas id="indicatorChart"></canvas>
                    </div>

                    <!-- Controls Area -->
                    <div id="controls" class="grid grid-cols-1 md:grid-cols-3 gap-6 bg-slate-50 p-4 rounded border border-slate-200">
                        <!-- Parameters -->
                        <div class="md:col-span-1 space-y-4">
                            <h3 class="font-bold text-sm text-slate-700 uppercase tracking-wide border-b border-slate-200 pb-2">Parameters</h3>
                            <div id="settings-container">
                                <div class="space-y-3">
                                    <!-- Dynamic settings will be injected here -->
                                </div>
                            </div>
                            <button id="btn-run" onclick="PlaygroundController.update()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition-colors shadow-sm flex items-center justify-center">
                                Calculate
                            </button>
                        </div>

                        <!-- Data I/O -->
                        <div class="md:col-span-2 space-y-4">
                            <!-- Input -->
                            <div class="space-y-2">
                                <div class="flex justify-between items-center pb-2 border-b border-slate-200">
                                    <h3 class="font-bold text-sm text-slate-700 uppercase tracking-wide">Input Data (CSV)</h3>
                                    <div class="flex space-x-2">
                                        <button id="btn-load-sample-ohlcv" class="text-xs text-indigo-600 hover:text-indigo-800 hover:underline transition-colors" title="Load OHLCV Sample Data">Shape (OHLCV)</button>
                                        <span class="text-slate-300">|</span>
                                        <button id="btn-load-sample-single" class="text-xs text-indigo-600 hover:text-indigo-800 hover:underline transition-colors" title="Load Single Value Sample Data">Single</button>
                                    </div>
                                </div>
                                <p class="text-xs text-slate-500">Enter CSV data (Date,Open,High,Low,Close,Volume) or single values.</p>
                                <textarea id="input-data" class="w-full h-24 p-2 text-xs font-mono border border-slate-300 rounded focus:ring-2 focus:ring-indigo-500 transition-shadow" placeholder="e.g. 100.5, 101.2, 99.8, 102.3, 103.1...

or one per line:
100.5
101.2
99.8"></textarea>
                            </div>
                            <!-- Output (Enabled) -->
                            <div class="space-y-2">
                                <div class="flex justify-between items-center pb-2 border-b border-slate-200">
                                    <h3 class="font-bold text-sm text-slate-700 uppercase tracking-wide">Output Data (Result)</h3>
                                </div>
                                <textarea id="output-data" class="w-full h-24 p-2 text-xs font-mono border border-slate-300 rounded bg-slate-100 text-slate-600" readonly placeholder="Calculation results will appear here..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- ======================================================= -->
        <!-- MIDDLE SECTION: LOGIC & ARCHITECTURE (PORTED FROM 0117) -->
        <!-- ======================================================= -->
        <section id="logic-visualization" class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden scroll-mt-24">
            <!-- Section Header (Styled like Playground) -->
            <div class="border-b border-slate-200 bg-emerald-50 px-6 py-4">
                <h2 class="text-lg font-bold text-slate-800 flex items-center">
                    <span class="bg-emerald-600 text-white p-1 rounded mr-3 text-xs shadow-sm font-mono">L</span>
                    Logic & Code Architecture
                </h2>
                <p class="text-sm text-slate-600 mt-2">Visual flowchart showing how the indicator processes data.</p>
            </div>

            <!-- LOGIC FIGURE STRUCTURE -->
            <figure class="logic-figure" style="border: none; border-radius: 0;">
                <!-- 1. Code Panel Toggle Button -->
                <button id="code-panel-toggle-btn" onclick="toggleCodePanel()" title="View Source Code" class="font-bold text-xs">
                    CODE
                </button>

                <!-- 2. Infinite Canvas Layer -->
                <div id="canvas-container" class="chart-scroll-wrapper" 
                     tabindex="0"
                     role="application"
                     aria-label="フローチャート操作エリア。矢印キーで移動、+/-でズーム、Rでリセット">
                    <div id="canvas-content" class="mermaid" style="position: absolute; top:0; left:0;">
                        flowchart TD;
subgraph INGESTION["Phase 1: Ingestion"];
A[/"Receive Price Data Stream"/];
B["Capture Closing Prices"];
C["Define Adaptive Parameters"];
end;
subgraph EVALUATION["Phase 2: Evaluation"];
D["Measure Net Directional Change"];
E["Measure Total Path Volatility"];
F["Calculate Efficiency Ratio"];
end;
subgraph WEIGHTING["Phase 3: Weighting"];
G["Determine Market Regime"];
H["Set Fast Smoothing for Trends"];
I["Set Slow Smoothing for Chop"];
J["Square Constant for Sensitivity"];
end;
subgraph SYNTHESIS["Phase 4: Synthesis"];
K["Apply Adaptive Smoothing"];
L["Generate Responsive Trend Line"];
M["Detect Regime Transitions"];
end;
subgraph OUTCOME["Phase 5: Outcome"];
N{"Trend Assessment?"};
O["High ER + Rising KAMA = Strong Trend"];
P["Low ER + Flat KAMA = Noise Zone"];
Q["ER Rising = Trend Emerging"];
R[/"Generate Adaptive Trend Signal"/];
end;
A --> B;
B --> C;
C --> D;
D --> E;
E --> F;
F --> G;
G --> H;
H --> I;
I --> J;
J --> K;
K --> L;
L --> M;
M --> N;
N -->|Trending| O;
N -->|Ranging| P;
N -->|Transitioning| Q;
O --> R;
P --> R;
Q --> R;
style INGESTION fill:#e3f2fd;
style EVALUATION fill:#fff3e0;
style WEIGHTING fill:#e8f5e9;
style SYNTHESIS fill:#fce4ec;
style OUTCOME fill:#f3e5f5;
                    </div>
                </div>

                <!-- 3. Canvas Controls (Zoom) -->
                <div class="absolute top-4 right-4 flex flex-col gap-2 z-20">
                    <button onclick="if(window.resetView) window.resetView()" class="p-2 bg-white rounded shadow border border-slate-200 hover:bg-slate-50 text-slate-600 font-mono text-xs" title="Reset View">R</button>
                    <button onclick="if(window.zoomAction) window.zoomAction('in')" class="p-2 bg-white rounded shadow border border-slate-200 hover:bg-slate-50 text-slate-600 font-mono text-xs" title="Zoom In">+</button>
                    <button onclick="if(window.zoomAction) window.zoomAction('out')" class="p-2 bg-white rounded shadow border border-slate-200 hover:bg-slate-50 text-slate-600 font-mono text-xs" title="Zoom Out">-</button>
                </div>

                <!-- 4. Code Panel Overlay (Slide-in) -->
                <div id="code-panel-overlay" class="panel-hidden" onmousedown="event.stopPropagation();">
                    <!-- Header -->
                    <div class="flex justify-between items-center p-3 border-b border-slate-200 bg-slate-50 shrink-0">
                        <div class="flex gap-2">
                            <button id="btn-lang-csharp" class="px-2 py-1 text-xs rounded transition-colors text-slate-500 hover:bg-slate-100" onclick="setLang('csharp')">C#</button>
                            <button id="btn-lang-python" class="px-2 py-1 text-xs rounded transition-colors text-slate-500 hover:bg-slate-100" onclick="setLang('python')">Python</button>
                        </div>
                        <div class="flex items-center gap-2">
                            <button id="btn-type-simple" class="text-xs text-slate-500 hover:text-indigo-600 transition-colors" onclick="setType('simple')">Simple</button>
                            <button id="btn-type-detailed" class="text-xs text-slate-500 hover:text-indigo-600 transition-colors" onclick="setType('detailed')">Detailed</button>
                            <!-- Copy -->
                            <button id="btn-copy-code" class="ml-2 text-slate-500 hover:text-slate-800 transition-colors" onclick="copyCode()" title="Copy Code">
                                <svg id="icon-copy" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                                <svg id="icon-copy-done" class="hidden text-green-600" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                            </button>
                            <!-- Expand/Collapse -->
                            <button id="btn-panel-expand" class="text-slate-500 hover:text-slate-800 transition-colors" onclick="toggleExpand()" title="Toggle Width">
                                <svg id="icon-expand" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M15 3h6v6" /><path d="M9 21H3v-6" /><path d="M21 3l-7 7" /><path d="M3 21l7-7" />
                                </svg>
                                <svg id="icon-collapse" class="hidden" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 14h6v6" /><path d="M20 10h-6V4" /><path d="M14 10l7-7" /><path d="M10 14l-7 7" />
                                </svg>
                            </button>
                            <!-- Close -->
                            <button class="text-slate-500 hover:text-red-600 transition-colors" onclick="toggleCodePanel()" title="Close Panel">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <!-- Body -->
                    <div class="code-panel-body custom-scrollbar p-4" 
                         id="code-panel-body"
                         data-code-src="../data/codes/KaufmanAdaptiveMovingAverage.js">
                        <!-- Loading indicator -->
                        <div id="code-loading" class="hidden absolute inset-0 flex items-center justify-center bg-white/80 z-10">
                            <span class="text-slate-400 text-sm">Loading code...</span>
                        </div>
                        <!-- Code containers (populated via JS fetch) -->
                        <div id="code-csharp-simple" class="code-content hidden"></div>
                        <div id="code-csharp-detailed" class="code-content hidden"></div>
                        <div id="code-python-simple" class="code-content hidden"></div>
                        <div id="code-python-detailed" class="code-content hidden"></div>
                    </div>
                </div>
            </figure>

            <!-- Legend (5-Step Model) -->
            <div class="logic-legend">
                <div class="legend-item"><span class="legend-dot l-ingestion"></span>Ingestion</div>
                <div class="legend-item"><span class="legend-dot l-evaluation"></span>Evaluation</div>
                <div class="legend-item"><span class="legend-dot l-weighting"></span>Weighting</div>
                <div class="legend-item"><span class="legend-dot l-synthesis"></span>Synthesis</div>
                <div class="legend-item"><span class="legend-dot l-outcome"></span>Outcome</div>
                <div class="text-xs text-slate-500 ml-auto">Keyboard: Arrows(pan) / +-(zoom) / R(reset)</div>
            </div>
        </section>

        <!-- ======================================================= -->
        <!-- BOTTOM SECTION: DOCS & TOC                              -->
        <!-- ======================================================= -->
        <section id="documentation" class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden scroll-mt-24">
            <!-- Documentation Header -->
            <div class="border-b border-orange-200 bg-orange-50 px-6 py-4">
                <h2 class="text-lg font-bold text-slate-900 flex items-center">
                    <span class="bg-indigo-600 text-white p-1 rounded mr-3 text-xs shadow-sm font-mono">D</span>
                    Technical Documentation
                </h2>
                <p class="text-slate-600 text-xs mt-1 ml-9">
                    Detailed technical explanation of the indicator's logic, math, and implementation details.
                </p>
            </div>
            <!-- Content Body -->
            <div class="p-6 flex flex-col lg:flex-row gap-12">
                <!-- Left: Article -->
                <article class="flex-1 min-w-0">
                    <div class="prose prose-slate max-w-none prose-headings:scroll-mt-24 prose-headings:font-bold prose-h2:text-2xl prose-h2:border-b prose-h2:pb-2 prose-h2:mt-8 prose-a:text-indigo-600 hover:prose-a:text-indigo-800">
                        <h1 id="kaufman-adaptive-moving-average-kama">Kaufman Adaptive Moving Average (KAMA)</h1>

<p class="mb-4"><h2 class="text-2xl font-bold mt-12 mb-6 border-b pb-2">PART 1: MAIN GUIDE</h2></p>

<h2 id="1-identity">1. Identity</h2>

<p class="mb-4">Full Name: Kaufman Adaptive Moving Average  </p>
<p class="mb-4">Abbreviation: KAMA  </p>
<p class="mb-4">Category: Adaptive Trend Indicator  </p>
<p class="mb-4">Creator: Perry J. Kaufman, 1995  </p>

<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">One-Sentence Definition: KAMA is an intelligent moving average that automatically adjusts its sensitivity based on market noise—speeding up during trends and slowing down during sideways chop to minimize false signals.</blockquote>

<hr class="border-[#2a2e39] my-8">

<h2 id="2-calculation-logic">2. Calculation Logic</h2>

<h3 id="formula">Formula</h3>

<p class="mb-4">KAMA adapts using an Efficiency Ratio (ER) that measures the "trendiness" of price movement:</p>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Step</td><td class="px-4 py-2 border-b border-[#2a2e39]">Formula</td><td class="px-4 py-2 border-b border-[#2a2e39]">Purpose</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">1</td><td class="px-4 py-2 border-b border-[#2a2e39]">$Change = \</td><td class="px-4 py-2 border-b border-[#2a2e39]">Price_t - Price_{t-n}\</td><td class="px-4 py-2 border-b border-[#2a2e39]">$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Net directional move over period</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">2</td><td class="px-4 py-2 border-b border-[#2a2e39]">$Volatility = \sum_{i=0}^{n-1} \</td><td class="px-4 py-2 border-b border-[#2a2e39]">Price_{t-i} - Price_{t-i-1}\</td><td class="px-4 py-2 border-b border-[#2a2e39]">$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Total path length (noise)</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">3</td><td class="px-4 py-2 border-b border-[#2a2e39]">$ER = \frac{Change}{Volatility}$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Efficiency Ratio (0 to 1)</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">4</td><td class="px-4 py-2 border-b border-[#2a2e39]">$SC_{fast} = \frac{2}{FastPeriod + 1}$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Fast smoothing constant</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">5</td><td class="px-4 py-2 border-b border-[#2a2e39]">$SC_{slow} = \frac{2}{SlowPeriod + 1}$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Slow smoothing constant</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">6</td><td class="px-4 py-2 border-b border-[#2a2e39]">$SC = (ER \times (SC_{fast} - SC_{slow}) + SC_{slow})^2$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Adaptive smoothing constant</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">7</td><td class="px-4 py-2 border-b border-[#2a2e39]">$KAMA_t = KAMA_{t-1} + SC \times (Price_t - KAMA_{t-1})$</td><td class="px-4 py-2 border-b border-[#2a2e39]">Final KAMA value</td></tr>
</table></div>

<h3 id="the-efficiency-ratio-explained">The Efficiency Ratio Explained</h3>

<p class="mb-4">$$ER = \frac{\text{Signal (Directional Movement)}}{\text{Noise (Total Movement)}}$$</p>

<p class="mb-4">- ER = 1.0: Price moved straight in one direction (100% efficient trend)</p>
<p class="mb-4">- ER = 0.0: Price moved but net displacement is zero (pure noise/chop)</p>

<h3 id="the-squaring-effect">The Squaring Effect</h3>

<p class="mb-4">The smoothing constant is squared ($SC^2$), which is Kaufman's key design choice. This suppresses the smoothing constant when ER is low, making KAMA nearly horizontal during noise.</p>

<h3 id="real-world-analogy">Real-World Analogy</h3>

<p class="mb-4">Think of KAMA like cruise control with terrain sensing. On a straight highway (trending market), cruise control maintains speed and follows the road closely. On a winding mountain road (choppy market), cruise control slows down to prevent jerky accelerations. KAMA does the same—it speeds up during trends to follow price and slows to a near-halt during chop to avoid whipsaws.</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="3-market-standards">3. Market Standards</h2>

<h3 id="default-parameters">Default Parameters</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Parameter</td><td class="px-4 py-2 border-b border-[#2a2e39]">Standard Value</td><td class="px-4 py-2 border-b border-[#2a2e39]">Rationale</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">ER Period</td><td class="px-4 py-2 border-b border-[#2a2e39]">10</td><td class="px-4 py-2 border-b border-[#2a2e39]">Measures efficiency over ~2 weeks</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Fast Period</td><td class="px-4 py-2 border-b border-[#2a2e39]">2</td><td class="px-4 py-2 border-b border-[#2a2e39]">Fastest response during trends</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Slow Period</td><td class="px-4 py-2 border-b border-[#2a2e39]">30</td><td class="px-4 py-2 border-b border-[#2a2e39]">Slowest response during noise</td></tr>
</table></div>

<h3 id="alternative-settings">Alternative Settings</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Use Case</td><td class="px-4 py-2 border-b border-[#2a2e39]">ER Period</td><td class="px-4 py-2 border-b border-[#2a2e39]">Fast</td><td class="px-4 py-2 border-b border-[#2a2e39]">Slow</td><td class="px-4 py-2 border-b border-[#2a2e39]">Notes</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Scalping</td><td class="px-4 py-2 border-b border-[#2a2e39]">5</td><td class="px-4 py-2 border-b border-[#2a2e39]">2</td><td class="px-4 py-2 border-b border-[#2a2e39]">20</td><td class="px-4 py-2 border-b border-[#2a2e39]">More responsive</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Swing Trading</td><td class="px-4 py-2 border-b border-[#2a2e39]">10</td><td class="px-4 py-2 border-b border-[#2a2e39]">2</td><td class="px-4 py-2 border-b border-[#2a2e39]">30</td><td class="px-4 py-2 border-b border-[#2a2e39]">Standard</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Position Trading</td><td class="px-4 py-2 border-b border-[#2a2e39]">20</td><td class="px-4 py-2 border-b border-[#2a2e39]">2</td><td class="px-4 py-2 border-b border-[#2a2e39]">50</td><td class="px-4 py-2 border-b border-[#2a2e39]">Smoother, less noise</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">High Volatility</td><td class="px-4 py-2 border-b border-[#2a2e39]">10</td><td class="px-4 py-2 border-b border-[#2a2e39]">2</td><td class="px-4 py-2 border-b border-[#2a2e39]">45</td><td class="px-4 py-2 border-b border-[#2a2e39]">Even slower during chop</td></tr>
</table></div>

<h3 id="timeframe-recommendations">Timeframe Recommendations</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Trading Style</td><td class="px-4 py-2 border-b border-[#2a2e39]">Timeframe</td><td class="px-4 py-2 border-b border-[#2a2e39]">Notes</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Day Trading</td><td class="px-4 py-2 border-b border-[#2a2e39]">5-15 min</td><td class="px-4 py-2 border-b border-[#2a2e39]">Use shorter ER period (5-7)</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Swing Trading</td><td class="px-4 py-2 border-b border-[#2a2e39]">Daily</td><td class="px-4 py-2 border-b border-[#2a2e39]">Standard settings work well</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Position Trading</td><td class="px-4 py-2 border-b border-[#2a2e39]">Daily/Weekly</td><td class="px-4 py-2 border-b border-[#2a2e39]">Extended slow period (40-50)</td></tr>
</table></div>

<hr class="border-[#2a2e39] my-8">

<h2 id="4-market-context">4. Market Context</h2>

<h3 id="best-conditions">Best Conditions</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Condition</td><td class="px-4 py-2 border-b border-[#2a2e39]">Why It Works</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Trend Breakouts</td><td class="px-4 py-2 border-b border-[#2a2e39]">KAMA accelerates quickly when trend efficiency improves</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Transitions</td><td class="px-4 py-2 border-b border-[#2a2e39]">Excels at identifying when chop ends and trends begin</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Noisy Markets</td><td class="px-4 py-2 border-b border-[#2a2e39]">Automatically filters sideways action</td></tr>
</table></div>

<h3 id="limitations">Limitations</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Condition</td><td class="px-4 py-2 border-b border-[#2a2e39]">Problem</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Extremely Fast Reversals</td><td class="px-4 py-2 border-b border-[#2a2e39]">Still lags initial reversal by several bars</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Low Volatility Drift</td><td class="px-4 py-2 border-b border-[#2a2e39]">May not respond to slow, grinding moves</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Gap-Driven Markets</td><td class="px-4 py-2 border-b border-[#2a2e39]">Gaps can distort efficiency calculation</td></tr>
</table></div>

<h3 id="asset-class-suitability">Asset Class Suitability</h3>

<p class="mb-4">- Forex — Excellent for trending currency pairs</p>
<p class="mb-4">- Equities — Strong performer on both trending and ranging stocks</p>
<p class="mb-4">- Futures — Good for commodity trends</p>
<p class="mb-4">- Crypto — Works but may need faster slow period due to volatility</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="5-entry-signals">5. Entry Signals</h2>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Signal Type</td><td class="px-4 py-2 border-b border-[#2a2e39]">Condition</td><td class="px-4 py-2 border-b border-[#2a2e39]">Direction</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strength</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Price Cross Up</td><td class="px-4 py-2 border-b border-[#2a2e39]">Price crosses above KAMA</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bullish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Moderate</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Price Cross Down</td><td class="px-4 py-2 border-b border-[#2a2e39]">Price crosses below KAMA</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bearish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Moderate</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">KAMA Slope Turn Up</td><td class="px-4 py-2 border-b border-[#2a2e39]">Flat KAMA begins rising</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bullish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">KAMA Slope Turn Down</td><td class="px-4 py-2 border-b border-[#2a2e39]">Flat KAMA begins falling</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bearish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Pullback Bounce</td><td class="px-4 py-2 border-b border-[#2a2e39]">Price touches rising KAMA and bounces</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bullish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Dual KAMA Cross</td><td class="px-4 py-2 border-b border-[#2a2e39]">Fast KAMA crosses above Slow KAMA</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bullish</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong</td></tr>
</table></div>

<h3 id="primary-buy-signal">Primary Buy Signal</h3>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
IF Price crosses above KAMA
AND KAMA slope &gt; 0 (rising)
AND Efficiency Ratio &gt; 0.30
THEN → BUY (Trend Breakout)
</code></pre>

<h3 id="primary-sell/exit-signal">Primary Sell/Exit Signal</h3>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
IF Price crosses below KAMA
OR KAMA slope turns negative
OR Efficiency Ratio &lt; 0.20 (noise zone)
THEN → EXIT/SELL
</code></pre>

<hr class="border-[#2a2e39] my-8">

<h2 id="6-filter-usage">6. Filter Usage</h2>

<p class="mb-4">KAMA is exceptional as both a trend filter and a noise detector. The Efficiency Ratio itself is a powerful filtering metric.</p>

<h3 id="filter-rules">Filter Rules</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Rule</td><td class="px-4 py-2 border-b border-[#2a2e39]">Application</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]"><code>ER > 0.30</code></td><td class="px-4 py-2 border-b border-[#2a2e39]">Enable trend-following strategies</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]"><code>ER < 0.20</code></td><td class="px-4 py-2 border-b border-[#2a2e39]">Switch to mean-reversion or stay flat</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]"><code>KAMA slope > 0</code></td><td class="px-4 py-2 border-b border-[#2a2e39]">Only take long signals</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]"><code>KAMA flat</code></td><td class="px-4 py-2 border-b border-[#2a2e39]">Avoid trading—market is noisy</td></tr>
</table></div>

<h3 id="recommended-pairings">Recommended Pairings</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Partner Indicator</td><td class="px-4 py-2 border-b border-[#2a2e39]">Synergy Logic</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Stochastic</td><td class="px-4 py-2 border-b border-[#2a2e39]">KAMA defines trend; Stochastic times pullback entries</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">RSI</td><td class="px-4 py-2 border-b border-[#2a2e39]">KAMA filters noise; RSI adds momentum context</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">ADX</td><td class="px-4 py-2 border-b border-[#2a2e39]">Double confirmation of trend presence</td></tr>
</table></div>

<h3 id="example-combined-strategy">Example Combined Strategy</h3>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
ENTRY CONDITIONS:
&nbsp;&nbsp;Price &gt; KAMA(10,2,30)               // Above adaptive mean
&nbsp;&nbsp;KAMA slope &gt; 0                       // Rising trend
&nbsp;&nbsp;Stochastic(14,3,3) crosses above 20  // Oversold bounce
&nbsp;&nbsp;ER &gt; 0.30                            // Trend efficient

ACTION: BUY pullback to KAMA in uptrend
</code></pre>

<hr class="border-[#2a2e39] my-8">

<h2 id="7-practical-cautions">7. Practical Cautions</h2>

<h3 id="lag-characteristics">Lag Characteristics</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Component</td><td class="px-4 py-2 border-b border-[#2a2e39]">Approximate Lag</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">First Valid KAMA</td><td class="px-4 py-2 border-b border-[#2a2e39]">Period + 1 bars (~11)</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Warm-up Period</td><td class="px-4 py-2 border-b border-[#2a2e39]">50-100 bars for stability</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Response to Trend</td><td class="px-4 py-2 border-b border-[#2a2e39]">3-5 bars after trend begins</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Flattening Delay</td><td class="px-4 py-2 border-b border-[#2a2e39]">5-10 bars into chop</td></tr>
</table></div>

<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">Reality Check: While KAMA is more responsive than SMA/EMA during trends, it still lags. The benefit is that it *doesn't* whipsaw during noise, not that it catches trend starts earlier.</blockquote>

<h3 id="false-signal-scenarios">False Signal Scenarios</h3>

<p class="mb-4">1. The Efficiency Trap  </p>
<p class="mb-4">   ER briefly spikes above 0.30 on a single large candle, then immediately falls. Use multiple bars of ER > 0.30 confirmation.</p>

<p class="mb-4">2. The Flat-Line Breakout  </p>
<p class="mb-4">   Price crosses KAMA while KAMA is flat. This is noise, not trend. Require KAMA slope confirmation.</p>

<p class="mb-4">3. Division by Zero  </p>
<p class="mb-4">   If price is perfectly flat for the entire ER period, Volatility = 0 and ER calculation fails.</p>

<h3 id="mitigation-strategies">Mitigation Strategies</h3>

<p class="mb-4">- Require Slope Confirmation: Only trade crossovers when KAMA is sloped</p>
<p class="mb-4">- ER Threshold Filter: Minimum ER > 0.25-0.30 before taking signals</p>
<p class="mb-4">- Wait for Flat-to-Slope: Best entries occur when KAMA transitions from flat to sloped</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="8-pro-insights">8. Pro Insights</h2>

<h3 id="the-flat-line-breakout-setup">The Flat-Line Breakout Setup</h3>

<p class="mb-4">KAMA's unique feature is that it goes horizontal during noise. Professional traders use this as a setup:</p>
<p class="mb-4">1. Wait for KAMA to flatten (5+ bars of near-zero slope)</p>
<p class="mb-4">2. Place bracket orders: Buy Stop above KAMA, Sell Stop below</p>
<p class="mb-4">3. The first breakout from the flat line often starts a new trend</p>

<p class="mb-4">This is essentially a volatility squeeze strategy built into the MA itself.</p>

<h3 id="efficiency-ratio-as-standalone-indicator">Efficiency Ratio as Standalone Indicator</h3>

<p class="mb-4">The ER (calculated during KAMA) is a powerful standalone tool. Plot ER as a separate indicator (0-1 scale):</p>
<p class="mb-4">- ER > 0.60: Strong trend (ride it)</p>
<p class="mb-4">- ER 0.30-0.60: Moderate trend (engage cautiously)</p>
<p class="mb-4">- ER < 0.30: Noise (avoid or mean-revert)</p>

<h3 id="portfolio-selection-technique">Portfolio Selection Technique</h3>

<p class="mb-4">Screen for stocks where:</p>
<p class="mb-4">- ER recently crossed above 0.35 (past 5 days)</p>
<p class="mb-4">- KAMA slope turned positive from flat</p>
<p class="mb-4">- Volume increasing on breakout above KAMA</p>

<p class="mb-4">This identifies stocks transitioning from consolidation to trend.</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="9-summary">9. Summary</h2>

<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">"KAMA is the intelligent trend filter—it knows when to speak (trend) and when to stay silent (noise), making it the perfect partner for traders who hate whipsaws."</blockquote>

<p class="mb-4"><h2 class="text-2xl font-bold mt-12 mb-6 border-b pb-2">PART 2: SUPPLEMENTARY GUIDE</h2></p>

<h2 id="1-core-concept">1. Core Concept</h2>

<p class="mb-4">KAMA answers: "Should I be following price closely, or should I ignore the noise?"</p>

<p class="mb-4">Traditional moving averages have a fixed smoothing constant—they're equally sensitive in quiet and volatile markets. This causes two problems:</p>
<p class="mb-4">- In trends: They lag behind, missing the move</p>
<p class="mb-4">- In chop: They whipsaw, generating false signals</p>

<p class="mb-4">KAMA solves both by making the smoothing constant *adaptive*. When price moves efficiently (straight line), KAMA speeds up. When price moves inefficiently (zigzag), KAMA slows down.</p>

<p class="mb-4">The core insight is the Efficiency Ratio—comparing net displacement to total path length. If you walk 10 miles straight, ER = 1. If you walk 10 miles zigzagging but end up 1 mile from start, ER = 0.1.</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="2-statistical-edge">2. Statistical Edge</h2>

<h3 id="why-it-works">Why It Works</h3>

<p class="mb-4">The edge comes from regime-aware smoothing. Studies show:</p>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Metric</td><td class="px-4 py-2 border-b border-[#2a2e39]">SMA(20)</td><td class="px-4 py-2 border-b border-[#2a2e39]">EMA(20)</td><td class="px-4 py-2 border-b border-[#2a2e39]">KAMA(10,2,30)</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Trend Capture</td><td class="px-4 py-2 border-b border-[#2a2e39]">85%</td><td class="px-4 py-2 border-b border-[#2a2e39]">88%</td><td class="px-4 py-2 border-b border-[#2a2e39]">92%</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Chop Whipsaws</td><td class="px-4 py-2 border-b border-[#2a2e39]">High</td><td class="px-4 py-2 border-b border-[#2a2e39]">Medium</td><td class="px-4 py-2 border-b border-[#2a2e39]">Low</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">False Signals</td><td class="px-4 py-2 border-b border-[#2a2e39]">40%+</td><td class="px-4 py-2 border-b border-[#2a2e39]">35%</td><td class="px-4 py-2 border-b border-[#2a2e39]">20%</td></tr>
</table></div>

<h3 id="signal-to-noise-optimization">Signal-to-Noise Optimization</h3>

<p class="mb-4">KAMA dynamically optimizes the signal-to-noise tradeoff:</p>
<p class="mb-4">- High ER = High signal → Fast response</p>
<p class="mb-4">- Low ER = High noise → Slow/no response</p>

<p class="mb-4">This is mathematically similar to concepts in signal processing and information theory.</p>

<h3 id="academic-reference">Academic Reference</h3>

<p class="mb-4">Perry Kaufman introduced KAMA in his book *Trading Systems and Methods* (3rd Edition, 1995). Kaufman's work on adaptive indicators and efficiency ratios is considered foundational in quantitative trading system design.</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="3-actionable-strategy">3. Actionable Strategy</h2>

<h3 id="strategy-name:-"kama-trend-pullback"">Strategy Name: "KAMA Trend Pullback"</h3>

<p class="mb-4">Concept: Enter trending stocks on pullbacks to KAMA when efficiency confirms trend.</p>

<p class="mb-4">Setup Requirements:</p>
<p class="mb-4">1. KAMA(10,2,30) slope > 0 (rising)</p>
<p class="mb-4">2. Price > KAMA</p>
<p class="mb-4">3. Efficiency Ratio > 0.35</p>

<p class="mb-4">Entry Trigger:</p>
<p class="mb-4">- Price pulls back to touch KAMA</p>
<p class="mb-4">- Stochastic(14,3,3) crosses above 20</p>
<p class="mb-4">- Price closes back above KAMA</p>

<p class="mb-4">Position Sizing:</p>
<p class="mb-4">- Full size when ER > 0.50</p>
<p class="mb-4">- Half size when ER 0.35-0.50</p>

<p class="mb-4">Exit Rules:</p>
<p class="mb-4">1. Primary Exit: Price closes below KAMA</p>
<p class="mb-4">2. Stop Loss: 1.5× ATR(14) below KAMA</p>
<p class="mb-4">3. Trailing Stop: Move stop to KAMA level as it rises</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="4-risks-&-limitations">4. Risks & Limitations</h2>

<h3 id="failure-patterns">Failure Patterns</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Pattern</td><td class="px-4 py-2 border-b border-[#2a2e39]">Description</td><td class="px-4 py-2 border-b border-[#2a2e39]">Mitigation</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">ER Spike Trap</td><td class="px-4 py-2 border-b border-[#2a2e39]">Brief ER spike on gap, then collapse</td><td class="px-4 py-2 border-b border-[#2a2e39]">Require 3+ bars of ER > threshold</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Flat-Line Death</td><td class="px-4 py-2 border-b border-[#2a2e39]">KAMA stays flat for weeks during range</td><td class="px-4 py-2 border-b border-[#2a2e39]">Accept no trading; wait for breakout</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Slow Grind Miss</td><td class="px-4 py-2 border-b border-[#2a2e39]">Low-volatility uptrend has low ER</td><td class="px-4 py-2 border-b border-[#2a2e39]">May need lower ER threshold</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Division by Zero</td><td class="px-4 py-2 border-b border-[#2a2e39]">Flat price = zero volatility</td><td class="px-4 py-2 border-b border-[#2a2e39]">Code handles with ER = 0 fallback</td></tr>
</table></div>

<h3 id="psychological-traps">Psychological Traps</h3>

<p class="mb-4">1. Impatience with Flat KAMA  </p>
<p class="mb-4">   When KAMA is flat, there are no signals. Traders get restless. Respect the silence.</p>

<p class="mb-4">2. Over-optimization  </p>
<p class="mb-4">   Tweaking Fast/Slow periods endlessly rarely improves results. Standard settings work.</p>

<p class="mb-4">3. Ignoring Slope  </p>
<p class="mb-4">   Crossovers without slope confirmation fail. The slope is the true signal.</p>

<h3 id="common-misinterpretations">Common Misinterpretations</h3>

<p class="mb-4">- "KAMA is always better than SMA/EMA" → Only in noisy markets; in clean trends, simple MA works fine</p>
<p class="mb-4">- "ER = 0.30 is a hard line" → It's a guideline; test for your market</p>
<p class="mb-4">- "KAMA predicts trends" → It *confirms* trends after efficiency improves</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="5-further-study">5. Further Study</h2>

<h3 id="creator-attribution">Creator Attribution</h3>

<p class="mb-4">Perry J. Kaufman is a quantitative analyst and trading systems developer who introduced KAMA in *Trading Systems and Methods*. Kaufman's work spans decades of research on systematic trading, futures markets, and adaptive indicators.</p>

<h3 id="parent/child-indicators">Parent/Child Indicators</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Indicator</td><td class="px-4 py-2 border-b border-[#2a2e39]">Relationship</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">SMA</td><td class="px-4 py-2 border-b border-[#2a2e39]">Ancestor — KAMA improves on fixed averaging</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">EMA</td><td class="px-4 py-2 border-b border-[#2a2e39]">Ancestor — KAMA uses EMA formula with adaptive alpha</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Efficiency Ratio</td><td class="px-4 py-2 border-b border-[#2a2e39]">Component — Core adaptive engine</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Fractal Adaptive MA</td><td class="px-4 py-2 border-b border-[#2a2e39]">Related — Alternative adaptive approach</td></tr>
</table></div>

<h3 id="recommended-readings">Recommended Readings</h3>

<p class="mb-4">1. *Trading Systems and Methods* — Perry J. Kaufman</p>
<p class="mb-4">2. *New Concepts in Technical Trading Systems* — J. Welles Wilder Jr.</p>
<p class="mb-4">3. *Cybernetic Analysis for Stocks and Futures* — John Ehlers</p>

<hr class="border-[#2a2e39] my-8">

<h3 id="55-related-indicators-comparison">5.5 Related Indicators Comparison</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Feature</td><td class="px-4 py-2 border-b border-[#2a2e39]">KAMA</td><td class="px-4 py-2 border-b border-[#2a2e39]">EMA</td><td class="px-4 py-2 border-b border-[#2a2e39]">Fractal AMA</td><td class="px-4 py-2 border-b border-[#2a2e39]">DEMA</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Adaptation</td><td class="px-4 py-2 border-b border-[#2a2e39]">ER-based</td><td class="px-4 py-2 border-b border-[#2a2e39]">None (fixed)</td><td class="px-4 py-2 border-b border-[#2a2e39]">Fractal Dimension</td><td class="px-4 py-2 border-b border-[#2a2e39]">None</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Responsiveness</td><td class="px-4 py-2 border-b border-[#2a2e39]">Dynamic</td><td class="px-4 py-2 border-b border-[#2a2e39]">Fixed</td><td class="px-4 py-2 border-b border-[#2a2e39]">Dynamic</td><td class="px-4 py-2 border-b border-[#2a2e39]">Enhanced</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Noise Filtering</td><td class="px-4 py-2 border-b border-[#2a2e39]">Excellent</td><td class="px-4 py-2 border-b border-[#2a2e39]">Moderate</td><td class="px-4 py-2 border-b border-[#2a2e39]">Good</td><td class="px-4 py-2 border-b border-[#2a2e39]">Poor</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Complexity</td><td class="px-4 py-2 border-b border-[#2a2e39]">Moderate</td><td class="px-4 py-2 border-b border-[#2a2e39]">Low</td><td class="px-4 py-2 border-b border-[#2a2e39]">High</td><td class="px-4 py-2 border-b border-[#2a2e39]">Low</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Best Use</td><td class="px-4 py-2 border-b border-[#2a2e39]">Noisy trending markets</td><td class="px-4 py-2 border-b border-[#2a2e39]">Clean trends</td><td class="px-4 py-2 border-b border-[#2a2e39]">Adaptive filtering</td><td class="px-4 py-2 border-b border-[#2a2e39]">Lag reduction</td></tr>
</table></div>

<p class="mb-4">When to Use Which:</p>
<p class="mb-4">- KAMA — Markets with varying noise levels; transition detection</p>
<p class="mb-4">- EMA — Clean, consistent trends</p>
<p class="mb-4">- Fractal AMA — Alternative adaptive approach</p>
<p class="mb-4">- DEMA — When lag reduction is priority over noise filtering</p>

<p class="mb-4"><h2 class="text-2xl font-bold mt-12 mb-6 border-b pb-2">PART 3: ADVANCED SIGNAL REFERENCE</h2></p>

<h2 id="advanced-signal-reference">Advanced Signal Reference</h2>

<h3 id="threshold-matrix">Threshold Matrix</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">ER Level</td><td class="px-4 py-2 border-b border-[#2a2e39]">Market State</td><td class="px-4 py-2 border-b border-[#2a2e39]">KAMA Behavior</td><td class="px-4 py-2 border-b border-[#2a2e39]">Action</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">0.00-0.15</td><td class="px-4 py-2 border-b border-[#2a2e39]">Pure noise</td><td class="px-4 py-2 border-b border-[#2a2e39]">Nearly flat</td><td class="px-4 py-2 border-b border-[#2a2e39]">No trading</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">0.15-0.30</td><td class="px-4 py-2 border-b border-[#2a2e39]">Low efficiency</td><td class="px-4 py-2 border-b border-[#2a2e39]">Slow movement</td><td class="px-4 py-2 border-b border-[#2a2e39]">Caution zone</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">0.30-0.50</td><td class="px-4 py-2 border-b border-[#2a2e39]">Moderate trend</td><td class="px-4 py-2 border-b border-[#2a2e39]">Responsive</td><td class="px-4 py-2 border-b border-[#2a2e39]">Standard signals</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">0.50-0.75</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong trend</td><td class="px-4 py-2 border-b border-[#2a2e39]">Fast tracking</td><td class="px-4 py-2 border-b border-[#2a2e39]">Aggressive entries</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">0.75-1.00</td><td class="px-4 py-2 border-b border-[#2a2e39]">Perfect trend</td><td class="px-4 py-2 border-b border-[#2a2e39]">Maximum response</td><td class="px-4 py-2 border-b border-[#2a2e39]">Ride the trend</td></tr>
</table></div>

<h3 id="signal-patterns">Signal Patterns</h3>

<h4 id="buy-signal-trend-breakout">Buy Signal (Trend Breakout)</h4>

<p class="mb-4">This signal fires when price crosses above KAMA with positive slope and valid efficiency. The combination ensures the crossover occurs during a genuine trend, not noise. KAMA reduces false signals by 20% compared to fixed moving averages because it speeds up during trends and flattens during chop.</p>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-python">
def kama_buy_signal(price, kama, kama_prev, er):
&nbsp;&nbsp;&nbsp;&nbsp;crossover = price &gt; kama and price_prev &lt;= kama_prev
&nbsp;&nbsp;&nbsp;&nbsp;slope_positive = kama &gt; kama_prev
&nbsp;&nbsp;&nbsp;&nbsp;efficiency_valid = er &gt; 0.30
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;return crossover and slope_positive and efficiency_valid
</code></pre>

<h4 id="sell/exit-signal">Sell/Exit Signal</h4>

<p class="mb-4">This pattern identifies when to exit positions based on KAMA breakdown or efficiency deterioration. A cross below KAMA or combination of negative slope with low efficiency indicates the trend has ended. The ER threshold ensures you're not exiting during temporary pullbacks in strong trends.</p>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-python">
def kama_exit_signal(price, kama, kama_prev, er):
&nbsp;&nbsp;&nbsp;&nbsp;cross_below = price &lt; kama and price_prev &gt;= kama_prev
&nbsp;&nbsp;&nbsp;&nbsp;slope_negative = kama &lt; kama_prev
&nbsp;&nbsp;&nbsp;&nbsp;efficiency_lost = er &lt; 0.20
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;return cross_below or (slope_negative and efficiency_lost)
</code></pre>

<h4 id="pullback-entry-signal">Pullback Entry Signal</h4>

<p class="mb-4">This signal identifies optimal re-entry points during established uptrends when price pulls back to touch the rising KAMA. Combined with Stochastic oversold confirmation, it provides "buy the dip" opportunities with reduced risk. This method offers better risk/reward than chasing breakouts.</p>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-python">
def kama_pullback_signal(price, kama, kama_prev, stoch_k):
&nbsp;&nbsp;&nbsp;&nbsp;uptrend = kama &gt; kama_prev  # KAMA rising
&nbsp;&nbsp;&nbsp;&nbsp;price_at_kama = abs(price - kama) / kama &lt; 0.01  # Within 1%
&nbsp;&nbsp;&nbsp;&nbsp;stoch_oversold = stoch_k &lt; 25
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;return uptrend and price_at_kama and stoch_oversold
</code></pre>

<h3 id="screening-filters">Screening Filters</h3>

<h4 id="trend-breakout-scanner">Trend Breakout Scanner</h4>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
Price crosses above KAMA(10,2,30)
AND KAMA &gt; KAMA[1]  // Slope positive
AND EfficiencyRatio(10) &gt; 0.35
AND Volume &gt; SMA(Volume, 20)
</code></pre>

<h4 id="breakout-from-consolidation">Breakout from Consolidation</h4>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
KAMA slope was flat for 10+ bars (|KAMA - KAMA[10]| &lt; ATR(14) * 0.5)
AND KAMA slope turns positive today
AND Price &gt; KAMA
AND ER &gt; 0.30
</code></pre>

<h4 id="high-efficiency-scanner">High Efficiency Scanner</h4>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
EfficiencyRatio(10) &gt; 0.60
AND Price &gt; KAMA(10,2,30)
AND KAMA &gt; KAMA[5]  // Sustained upward slope
</code></pre>

<h3 id="combination-strategies">Combination Strategies</h3>

<h4 id="kama-+-stochastic-pullback-strategy">KAMA + Stochastic Pullback Strategy</h4>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
SETUP:
&nbsp;&nbsp;Price &gt; KAMA(10,2,30)
&nbsp;&nbsp;KAMA slope &gt; 0
&nbsp;&nbsp;ER &gt; 0.30
&nbsp;&nbsp;
ENTRY:
&nbsp;&nbsp;Price touches or nears KAMA
&nbsp;&nbsp;Stochastic(14,3,3) crosses above 20
&nbsp;&nbsp;
STOP_LOSS:
&nbsp;&nbsp;1.5 × ATR(14) below KAMA
&nbsp;&nbsp;
TAKE_PROFIT:
&nbsp;&nbsp;Price crosses below KAMA
&nbsp;&nbsp;OR Stochastic &gt; 80
</code></pre>

<h4 id="dual-kama-crossover-strategy">Dual KAMA Crossover Strategy</h4>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
SETUP:
&nbsp;&nbsp;Fast KAMA(5,2,20)
&nbsp;&nbsp;Slow KAMA(20,2,50)
&nbsp;&nbsp;
ENTRY:
&nbsp;&nbsp;Fast KAMA crosses above Slow KAMA
&nbsp;&nbsp;Both slopes positive
&nbsp;&nbsp;
STOP_LOSS:
&nbsp;&nbsp;Below Slow KAMA
&nbsp;&nbsp;
TAKE_PROFIT:
&nbsp;&nbsp;Fast KAMA crosses below Slow KAMA
</code></pre>





                    </div>
                </article>
                <!-- Right: Sticky TOC -->
                <aside class="lg:block w-64 flex-shrink-0">
                    <div class="sticky top-24">
                        <h3 class="font-bold text-slate-900 mb-4 pb-2 border-b border-slate-100 text-sm uppercase tracking-wider">
                            On this page
                        </h3>
                        <nav id="toc-nav" class="space-y-1 text-sm text-slate-600">
                            <a href="#1-identity" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">1. Identity</a>
<a href="#2-calculation-logic" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">2. Calculation Logic</a>
<a href="#formula" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Formula</a>
<a href="#the-efficiency-ratio-explained" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">The Efficiency Ratio Explained</a>
<a href="#the-squaring-effect" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">The Squaring Effect</a>
<a href="#real-world-analogy" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Real-World Analogy</a>
<a href="#3-market-standards" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">3. Market Standards</a>
<a href="#default-parameters" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Default Parameters</a>
<a href="#alternative-settings" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Alternative Settings</a>
<a href="#timeframe-recommendations" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Timeframe Recommendations</a>
<a href="#4-market-context" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">4. Market Context</a>
<a href="#best-conditions" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Best Conditions</a>
<a href="#limitations" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Limitations</a>
<a href="#asset-class-suitability" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Asset Class Suitability</a>
<a href="#5-entry-signals" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">5. Entry Signals</a>
<a href="#primary-buy-signal" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Primary Buy Signal</a>
<a href="#primary-sell/exit-signal" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Primary Sell/Exit Signal</a>
<a href="#6-filter-usage" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">6. Filter Usage</a>
<a href="#filter-rules" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Filter Rules</a>
<a href="#recommended-pairings" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Recommended Pairings</a>
<a href="#example-combined-strategy" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Example Combined Strategy</a>
<a href="#7-practical-cautions" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">7. Practical Cautions</a>
<a href="#lag-characteristics" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Lag Characteristics</a>
<a href="#false-signal-scenarios" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">False Signal Scenarios</a>
<a href="#mitigation-strategies" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Mitigation Strategies</a>
<a href="#8-pro-insights" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">8. Pro Insights</a>
<a href="#the-flat-line-breakout-setup" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">The Flat-Line Breakout Setup</a>
<a href="#efficiency-ratio-as-standalone-indicator" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Efficiency Ratio as Standalone Indicator</a>
<a href="#portfolio-selection-technique" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Portfolio Selection Technique</a>
<a href="#9-summary" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">9. Summary</a>
<a href="#1-core-concept" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">1. Core Concept</a>
<a href="#2-statistical-edge" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">2. Statistical Edge</a>
<a href="#why-it-works" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Why It Works</a>
<a href="#signal-to-noise-optimization" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Signal-to-Noise Optimization</a>
<a href="#academic-reference" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Academic Reference</a>
<a href="#3-actionable-strategy" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">3. Actionable Strategy</a>
<a href="#strategy-name:-"kama-trend-pullback"" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Strategy Name: "KAMA Trend Pullback"</a>
<a href="#4-risks-&-limitations" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">4. Risks & Limitations</a>
<a href="#failure-patterns" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Failure Patterns</a>
<a href="#psychological-traps" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Psychological Traps</a>
<a href="#common-misinterpretations" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Common Misinterpretations</a>
<a href="#5-further-study" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">5. Further Study</a>
<a href="#creator-attribution" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Creator Attribution</a>
<a href="#parent/child-indicators" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Parent/Child Indicators</a>
<a href="#recommended-readings" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Recommended Readings</a>
<a href="#55-related-indicators-comparison" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">5.5 Related Indicators Comparison</a>
<a href="#advanced-signal-reference" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">Advanced Signal Reference</a>
<a href="#threshold-matrix" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Threshold Matrix</a>
<a href="#signal-patterns" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Signal Patterns</a>
<a href="#screening-filters" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Screening Filters</a>
<a href="#combination-strategies" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Combination Strategies</a>

                        </nav>
                        <div class="mt-8 pt-4 border-t border-slate-100">
                            <a href="#" class="text-xs text-slate-400 hover:text-indigo-600 flex items-center transition-colors">
                                Back to Top
                            </a>
                        </div>
                    </div>
                </aside>
            </div>
        </section>


    </div>


        <!-- Footer -->
    <footer class="bg-white border-t border-slate-200 mt-12">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <p class="text-center text-slate-400 text-sm">
                &copy; 2023-2025 I ant I Investigates. All rights reserved.
            </p>
        </div>
    </footer>
        <!-- ========================================== -->
    <!-- 1. DATA & LOGIC INJECTION                  -->
    <!-- ========================================== -->
    <script>
        window.IndicatorLogic = {
            name: "KaufmanAdaptiveMovingAverage",
            params: [],
            calculate: null
        };
        (function() {
            try {
                const injectedCode = `
        window.IndicatorLogic = {
            calculate: (data, params) => {
                const period = params.period || 10;
                const fastPeriod = params.fastPeriod || 2;
                const slowPeriod = params.slowPeriod || 30;
                const result = KaufmanAdaptiveMovingAverage.calculate(data, period, fastPeriod, slowPeriod);
                // Handle both array and object returns
                if (Array.isArray(result)) {
                    return { main: result };
                }
                return result;
            }
        };
        `;
                const isTemplatePlaceholder = injectedCode.includes('{{') && injectedCode.includes('CODE_INDICATOR_LOGIC');
                if (injectedCode && injectedCode.trim().length > 0 && !isTemplatePlaceholder) {
                    new Function(injectedCode)();
                } else {
                    console.warn("Playground Logic: Running in Preview/Fallback mode.");
                    window.IndicatorLogic.calculate = () => []; 
                }
            } catch (e) {
                console.error("Critical Error in Logic Injection:", e);
                window.IndicatorLogic.calculate = () => [];
            }
        })();
    </script>

    <!-- ========================================== -->
    <!-- 2. VISUALIZATION ENGINE                    -->
    <!-- ========================================== -->
    <script>
        mermaid.initialize({ startOnLoad: false, theme: 'neutral', securityLevel: 'loose' });
    </script>
    <!-- ========================================== -->
    <!-- 3. UI CONTROLLERS & APP INITIALIZATION     -->
    <!-- ========================================== -->
    <!-- INLINE UI CONTROLLERS (PORTED FROM 0117) -->
    <script src="../assets/js/KaufmanAdaptiveMovingAverage.js"></script>
    <!-- JSON Data Containers (XSS-safe) -->
    <script id="data-indicator-config" type="application/json">
[{"id": "period", "label": "Period (10)", "type": "number", "value": 10, "min": 2, "max": 100}, {"id": "fastPeriod", "label": "Fastperiod (2)", "type": "number", "value": 2, "min": 2, "max": 100}, {"id": "slowPeriod", "label": "Slowperiod (30)", "type": "number", "value": 30, "min": 2, "max": 100}]
    </script>
    <script id="data-indicator-display" type="application/json">
{"isOverlay": true, "plots": {"main": {"label": "KaufmanAdaptiveMovingAverage", "color": "#4f46e5", "type": "line"}}}
    </script>
    <script>
        // --- 0. Indicator Data Injection ---
        // Use existing IndicatorLogic (set in earlier script block), only set if not exists
        var IndicatorLogic = window.IndicatorLogic || { calculate: null };
        var IndicatorConfig = [];
        var IndicatorDisplay = { isOverlay: false, plots: {} };

        // 1. Library Code - loaded externally before this block

        // 2. Configuration (XSS-safe via script type="application/json")
        try {
            var configEl = document.getElementById('data-indicator-config');
            if(configEl && configEl.textContent.trim()) {
                IndicatorConfig = JSON.parse(configEl.textContent);
            }
        } catch(e){ console.warn('Config parse error', e); }

        try {
            var displayEl = document.getElementById('data-indicator-display');
            if(displayEl && displayEl.textContent.trim()) {
                IndicatorDisplay = JSON.parse(displayEl.textContent);
            }
        } catch(e){ console.warn('Display parse error', e); }

        // 3. Logic Adapter
        window.IndicatorLogic = {
            calculate: (data, params) => {
                const period = params.period || 10;
                const fastPeriod = params.fastPeriod || 2;
                const slowPeriod = params.slowPeriod || 30;
                const result = KaufmanAdaptiveMovingAverage.calculate(data, period, fastPeriod, slowPeriod);
                // Handle both array and object returns
                if (Array.isArray(result)) {
                    return { main: result };
                }
                return result;
            }
        };
    </script>

    <!-- UI Controllers: indicator.js loads first to define PlaygroundController -->
    <script src="../assets/js/indicator.js" defer></script>
    <!-- script.js loads second, skips PlaygroundController if already defined -->
    <script src="../assets/js/script.js" defer></script>

</body>
</html>