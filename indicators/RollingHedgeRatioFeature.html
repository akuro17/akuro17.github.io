<!DOCTYPE html>
<html lang="ja" class="scroll-smooth">
<head>
        <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RollingHedgeRatioFeature - I ant I Investigates</title>
    <meta name="description" content="RollingHedgeRatioFeature - Technical Indicator">
    <meta name="keywords" content="RollingHedgeRatioFeature, technical indicator, stock analysis">
    <!-- Canonical URL -->
    <link rel="canonical" href="https://iantinvestigates.com/indicators/rollinghedgeratiofeature.html">
    <!-- OGP (Open Graph Protocol) -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="RollingHedgeRatioFeature - I ant I Investigates">
    <meta property="og:description" content="RollingHedgeRatioFeature - Technical Indicator">
    <meta property="og:url" content="https://iantinvestigates.com/indicators/rollinghedgeratiofeature.html">
    <meta property="og:site_name" content="I ant I Investigates">
    <meta property="og:image" content="https://iantinvestigates.com/assets/images/ogp/rollinghedgeratiofeature.png">
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="RollingHedgeRatioFeature">
    <meta name="twitter:description" content="RollingHedgeRatioFeature - Technical Indicator">
    <meta name="twitter:image" content="https://iantinvestigates.com/assets/images/ogp/rollinghedgeratiofeature.png">
    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    </script>
    <!-- Resource Hints -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    <!-- Styles -->
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/indicator.css">
    <!-- KaTeX (Math) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <!-- Libraries (defer for non-blocking load) -->
    <script defer src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <!-- Pygments Syntax Highlighting (Externalized) -->
    <link rel="stylesheet" href="../assets/css/pygments.css">

</head>
<body class="bg-slate-50 text-slate-800 font-sans antialiased relative">
        <!-- Navigation -->
    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 shadow-sm">
        <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center mr-6">
                        <a href="../index.html" class="font-bold text-xl text-indigo-600">
                            I ant I Investigates
                        </a>
                    </div>
                    <!-- Breadcrumbs (Moved Here) -->
                    <nav class="flex text-sm text-slate-500 mr-8" aria-label="Breadcrumb">
                        <ol class="flex items-center space-x-2">
                            <li><a href="../index.html" class="hover:text-indigo-600 transition-colors">home</a></li>
                            <li><span class="mx-1">/</span></li>
                            <li><a href="./" class="hover:text-indigo-600 transition-colors">indicators</a></li>
                            <li><span class="mx-1">/</span></li>
                            <li><span class="font-medium text-slate-900">RollingHedgeRatioFeature</span></li>
                        </ol>
                    </nav>

                    <!-- Page Top Nav (Anchor Links) -->
                    <div class="flex space-x-4 items-center">
                        <a href="#interactive-playground" class="text-slate-600 hover:text-indigo-600 px-3 py-2 text-sm font-medium transition-colors">
                            Chart
                        </a>
                        <a href="#logic-visualization" class="text-slate-600 hover:text-indigo-600 px-3 py-2 text-sm font-medium transition-colors">
                            Logic
                        </a>
                        <a href="#documentation" class="text-slate-600 hover:text-indigo-600 px-3 py-2 text-sm font-medium transition-colors">
                            Docs
                        </a>
                    </div>
                </div>
                <!-- External Links Placeholder -->
                <div class="hidden sm:flex items-center">
                </div>
            </div>
        </div>
    </nav>
    <!-- Main Container: 1-Column Stack -->
    <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-12">
        <!-- ======================================================= -->
        <!-- TOP SECTION: CONTEXT & PLAYGROUND                       -->
        <!-- ======================================================= -->
        <div class="flex flex-col gap-6">
            <!-- Hero Header -->
            <header>
                <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4 leading-tight">RollingHedgeRatioFeature</h1>
                <p class="text-lg text-slate-600 leading-relaxed">The Rolling Hedge Ratio is the dynamic beta coefficient calculated via rolling OLS regression between two cointegrated assets, determining the optimal position sizing for a market-neutral pairs trade.</p>
            </header>

            <!-- Interactive Playground -->
            <section id="interactive-playground" class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden scroll-mt-24">
                <div class="border-b border-slate-200 bg-indigo-50 px-6 py-4">
                    <h2 class="text-lg font-bold text-slate-800 flex items-center">
                        <span class="bg-indigo-600 text-white p-1 rounded mr-3 text-xs shadow-sm font-mono">C</span>
                        Calculator
                    </h2>
                    <p class="text-sm text-slate-600 mt-2">Calculate indicator values from your price data.</p>
                </div>
                <div class="p-6">
                    <!-- Chart Area -->
                    <div class="relative h-[400px] w-full mb-6 border border-slate-100 rounded bg-slate-50">
                        <canvas id="indicatorChart"></canvas>
                    </div>

                    <!-- Controls Area -->
                    <div id="controls" class="grid grid-cols-1 md:grid-cols-3 gap-6 bg-slate-50 p-4 rounded border border-slate-200">
                        <!-- Parameters -->
                        <div class="md:col-span-1 space-y-4">
                            <h3 class="font-bold text-sm text-slate-700 uppercase tracking-wide border-b border-slate-200 pb-2">Parameters</h3>
                            <div id="settings-container">
                                <div class="space-y-3">
                                    <!-- Dynamic settings will be injected here -->
                                </div>
                            </div>
                            <button id="btn-run" onclick="PlaygroundController.update()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded transition-colors shadow-sm flex items-center justify-center">
                                Calculate
                            </button>
                        </div>

                        <!-- Data I/O -->
                        <div class="md:col-span-2 space-y-4">
                            <!-- Input -->
                            <div class="space-y-2">
                                <div class="flex justify-between items-center pb-2 border-b border-slate-200">
                                    <h3 class="font-bold text-sm text-slate-700 uppercase tracking-wide">Input Data (CSV)</h3>
                                    <div class="flex space-x-2">
                                        <button id="btn-load-sample-ohlcv" class="text-xs text-indigo-600 hover:text-indigo-800 hover:underline transition-colors" title="Load OHLCV Sample Data">Shape (OHLCV)</button>
                                        <span class="text-slate-300">|</span>
                                        <button id="btn-load-sample-single" class="text-xs text-indigo-600 hover:text-indigo-800 hover:underline transition-colors" title="Load Single Value Sample Data">Single</button>
                                    </div>
                                </div>
                                <p class="text-xs text-slate-500">Enter CSV data (Date,Open,High,Low,Close,Volume) or single values.</p>
                                <textarea id="input-data" class="w-full h-24 p-2 text-xs font-mono border border-slate-300 rounded focus:ring-2 focus:ring-indigo-500 transition-shadow" placeholder="e.g. 100.5, 101.2, 99.8, 102.3, 103.1...

or one per line:
100.5
101.2
99.8"></textarea>
                            </div>
                            <!-- Output (Enabled) -->
                            <div class="space-y-2">
                                <div class="flex justify-between items-center pb-2 border-b border-slate-200">
                                    <h3 class="font-bold text-sm text-slate-700 uppercase tracking-wide">Output Data (Result)</h3>
                                </div>
                                <textarea id="output-data" class="w-full h-24 p-2 text-xs font-mono border border-slate-300 rounded bg-slate-100 text-slate-600" readonly placeholder="Calculation results will appear here..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- ======================================================= -->
        <!-- MIDDLE SECTION: LOGIC & ARCHITECTURE (PORTED FROM 0117) -->
        <!-- ======================================================= -->
        <section id="logic-visualization" class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden scroll-mt-24">
            <!-- Section Header (Styled like Playground) -->
            <div class="border-b border-slate-200 bg-emerald-50 px-6 py-4">
                <h2 class="text-lg font-bold text-slate-800 flex items-center">
                    <span class="bg-emerald-600 text-white p-1 rounded mr-3 text-xs shadow-sm font-mono">L</span>
                    Logic & Code Architecture
                </h2>
                <p class="text-sm text-slate-600 mt-2">Visual flowchart showing how the indicator processes data.</p>
            </div>

            <!-- LOGIC FIGURE STRUCTURE -->
            <figure class="logic-figure" style="border: none; border-radius: 0;">
                <!-- 1. Code Panel Toggle Button -->
                <button id="code-panel-toggle-btn" onclick="toggleCodePanel()" title="View Source Code" class="font-bold text-xs">
                    CODE
                </button>

                <!-- 2. Infinite Canvas Layer -->
                <div id="canvas-container" class="chart-scroll-wrapper" 
                     tabindex="0"
                     role="application"
                     aria-label="Flowchart interaction area. Use arrow keys to pan, +/- to zoom, R to reset">
                    <div id="canvas-content" class="mermaid" style="position: absolute; top:0; left:0;">
                        flowchart TD;
subgraph INGESTION["Phase 1: Ingestion"];
A[/"Receive Two Asset Price Series"/];
B["Capture Paired Price Movements"];
C["Define Regression Window"];
end;
subgraph EVALUATION["Phase 2: Evaluation"];
D["Measure Relative Sensitivity"];
E["Calculate Price Covariance"];
F["Assess Asset Variance"];
end;
subgraph WEIGHTING["Phase 3: Weighting"];
G["Apply OLS Regression"];
H["Compute Beta Coefficient"];
I["Determine Optimal Hedge Ratio"];
end;
subgraph SYNTHESIS["Phase 4: Synthesis"];
J["Track Ratio Stability"];
K["Monitor Regime Changes"];
L["Detect Variance Collapse"];
end;
subgraph OUTCOME["Phase 5: Outcome"];
M{"Position Sizing Assessment?"};
N["Stable Beta = Reliable Hedge"];
O["Volatile Beta = Relationship Stress"];
P["Beta Divergence = Early Warning"];
Q[/"Generate Pairs Position Size"/];
end;
A --> B;
B --> C;
C --> D;
D --> E;
E --> F;
F --> G;
G --> H;
H --> I;
I --> J;
J --> K;
K --> L;
L --> M;
M -->|Stable| N;
M -->|Unstable| O;
M -->|Diverging| P;
N --> Q;
O --> Q;
P --> Q;
style INGESTION fill:#e3f2fd;
style EVALUATION fill:#fff3e0;
style WEIGHTING fill:#e8f5e9;
style SYNTHESIS fill:#fce4ec;
style OUTCOME fill:#f3e5f5;
                    </div>
                </div>

                <!-- 3. Canvas Controls (Zoom) -->
                <div class="absolute top-4 right-4 flex flex-col gap-2 z-20">
                    <button onclick="if(window.resetView) window.resetView()" class="p-2 bg-white rounded shadow border border-slate-200 hover:bg-slate-50 text-slate-600 font-mono text-xs" title="Reset View">R</button>
                    <button onclick="if(window.zoomAction) window.zoomAction('in')" class="p-2 bg-white rounded shadow border border-slate-200 hover:bg-slate-50 text-slate-600 font-mono text-xs" title="Zoom In">+</button>
                    <button onclick="if(window.zoomAction) window.zoomAction('out')" class="p-2 bg-white rounded shadow border border-slate-200 hover:bg-slate-50 text-slate-600 font-mono text-xs" title="Zoom Out">-</button>
                </div>

                <!-- 4. Code Panel Overlay (Slide-in) -->
                <div id="code-panel-overlay" class="panel-hidden" onmousedown="event.stopPropagation();">
                    <!-- Header -->
                    <div class="flex justify-between items-center p-3 border-b border-slate-200 bg-slate-50 shrink-0">
                        <div class="flex gap-2">
                            <button id="btn-lang-csharp" class="px-2 py-1 text-xs rounded transition-colors text-slate-500 hover:bg-slate-100" onclick="setLang('csharp')">C#</button>
                            <button id="btn-lang-python" class="px-2 py-1 text-xs rounded transition-colors text-slate-500 hover:bg-slate-100" onclick="setLang('python')">Python</button>
                        </div>
                        <div class="flex items-center gap-2">
                            <button id="btn-type-simple" class="text-xs text-slate-500 hover:text-indigo-600 transition-colors" onclick="setType('simple')">Simple</button>
                            <button id="btn-type-detailed" class="text-xs text-slate-500 hover:text-indigo-600 transition-colors" onclick="setType('detailed')">Detailed</button>
                            <!-- Copy -->
                            <button id="btn-copy-code" class="ml-2 text-slate-500 hover:text-slate-800 transition-colors" onclick="copyCode()" title="Copy Code">
                                <svg id="icon-copy" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                                </svg>
                                <svg id="icon-copy-done" class="hidden text-green-600" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                            </button>
                            <!-- Expand/Collapse -->
                            <button id="btn-panel-expand" class="text-slate-500 hover:text-slate-800 transition-colors" onclick="toggleExpand()" title="Toggle Width">
                                <svg id="icon-expand" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M15 3h6v6" /><path d="M9 21H3v-6" /><path d="M21 3l-7 7" /><path d="M3 21l7-7" />
                                </svg>
                                <svg id="icon-collapse" class="hidden" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 14h6v6" /><path d="M20 10h-6V4" /><path d="M14 10l7-7" /><path d="M10 14l-7 7" />
                                </svg>
                            </button>
                            <!-- Close -->
                            <button class="text-slate-500 hover:text-red-600 transition-colors" onclick="toggleCodePanel()" title="Close Panel">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <!-- Body -->
                    <div class="code-panel-body custom-scrollbar p-4" 
                         id="code-panel-body"
                         data-code-src="../data/codes/RollingHedgeRatioFeature.js">
                        <!-- Loading indicator -->
                        <div id="code-loading" class="hidden absolute inset-0 flex items-center justify-center bg-white/80 z-10">
                            <span class="text-slate-400 text-sm">Loading code...</span>
                        </div>
                        <!-- Code containers (populated via JS fetch) -->
                        <div id="code-csharp-simple" class="code-content hidden"></div>
                        <div id="code-csharp-detailed" class="code-content hidden"></div>
                        <div id="code-python-simple" class="code-content hidden"></div>
                        <div id="code-python-detailed" class="code-content hidden"></div>
                    </div>
                </div>
            </figure>

            <!-- Legend (5-Step Model) -->
            <div class="logic-legend">
                <div class="legend-item"><span class="legend-dot l-ingestion"></span>Ingestion</div>
                <div class="legend-item"><span class="legend-dot l-evaluation"></span>Evaluation</div>
                <div class="legend-item"><span class="legend-dot l-weighting"></span>Weighting</div>
                <div class="legend-item"><span class="legend-dot l-synthesis"></span>Synthesis</div>
                <div class="legend-item"><span class="legend-dot l-outcome"></span>Outcome</div>
                <div class="text-xs text-slate-500 ml-auto">Keyboard: Arrows(pan) / +-(zoom) / R(reset)</div>
            </div>
        </section>

        <!-- ======================================================= -->
        <!-- BOTTOM SECTION: DOCS & TOC                              -->
        <!-- ======================================================= -->
        <section id="documentation" class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden scroll-mt-24">
            <!-- Documentation Header -->
            <div class="border-b border-orange-200 bg-orange-50 px-6 py-4">
                <h2 class="text-lg font-bold text-slate-900 flex items-center">
                    <span class="bg-indigo-600 text-white p-1 rounded mr-3 text-xs shadow-sm font-mono">D</span>
                    Technical Documentation
                </h2>
                <p class="text-slate-600 text-xs mt-1 ml-9">
                    Detailed technical explanation of the indicator's logic, math, and implementation details.
                </p>
            </div>
            <!-- Content Body -->
            <div class="p-6 flex flex-col lg:flex-row gap-12">
                <!-- Left: Article -->
                <article class="flex-1 min-w-0">
                    <div class="prose prose-slate max-w-none prose-headings:scroll-mt-24 prose-headings:font-bold prose-h2:text-2xl prose-h2:border-b prose-h2:pb-2 prose-h2:mt-8 prose-a:text-indigo-600 hover:prose-a:text-indigo-800">
                        <h1 id="rolling-hedge-ratio-feature-rhr">Rolling Hedge Ratio Feature (RHR)</h1>

<p class="mb-4"><h2 class="text-2xl font-bold mt-12 mb-6 border-b pb-2">PART 1: MAIN GUIDE</h2></p>

<h2 id="1-identity">1. Identity</h2>

<p class="mb-4">Full Name: Rolling Hedge Ratio Feature  </p>
<p class="mb-4">Abbreviation: RHR / Beta  </p>
<p class="mb-4">Category: Statistical Arbitrage / Pairs Trading  </p>
<p class="mb-4">Creator: Nunzio Tartaglia (Morgan Stanley, 1985)  </p>

<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">One-Sentence Definition: The Rolling Hedge Ratio is the dynamic beta coefficient calculated via rolling OLS regression between two cointegrated assets, determining the optimal position sizing for a market-neutral pairs trade.</blockquote>

<hr class="border-[#2a2e39] my-8">

<h2 id="2-calculation-logic">2. Calculation Logic</h2>

<h3 id="formula">Formula</h3>

<p class="mb-4">The hedge ratio is derived using Ordinary Least Squares (OLS) linear regression:</p>

<p class="mb-4">$$\beta_t = \frac{Cov(Y, X)}{Var(X)} = \frac{n \sum XY - \sum X \sum Y}{n \sum X^2 - (\sum X)^2}$$</p>

<p class="mb-4">Where:</p>
<p class="mb-4">- $Y$ = Dependent asset (the asset you're trading)</p>
<p class="mb-4">- $X$ = Independent asset (the hedge)</p>
<p class="mb-4">- $n$ = Rolling window period (default: 60)</p>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Step</td><td class="px-4 py-2 border-b border-[#2a2e39]">Logic</td><td class="px-4 py-2 border-b border-[#2a2e39]">Purpose</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">1</td><td class="px-4 py-2 border-b border-[#2a2e39]">Collect closing prices for both Asset Y and Asset X</td><td class="px-4 py-2 border-b border-[#2a2e39]">Gather paired data</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">2</td><td class="px-4 py-2 border-b border-[#2a2e39]">Define rolling window (e.g., 60 periods)</td><td class="px-4 py-2 border-b border-[#2a2e39]">Set lookback horizon</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">3</td><td class="px-4 py-2 border-b border-[#2a2e39]">Calculate sum of X, Y, XY, and X² within window</td><td class="px-4 py-2 border-b border-[#2a2e39]">OLS components</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">4</td><td class="px-4 py-2 border-b border-[#2a2e39]">Compute denominator: n×ΣX² - (ΣX)²</td><td class="px-4 py-2 border-b border-[#2a2e39]">Variance term</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">5</td><td class="px-4 py-2 border-b border-[#2a2e39]">Compute numerator: n×ΣXY - ΣX×ΣY</td><td class="px-4 py-2 border-b border-[#2a2e39]">Covariance term</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">6</td><td class="px-4 py-2 border-b border-[#2a2e39]">Divide numerator by denominator → β</td><td class="px-4 py-2 border-b border-[#2a2e39]">Hedge ratio</td></tr>
</table></div>

<h3 id="real-world-analogy">Real-World Analogy</h3>

<p class="mb-4">Think of the hedge ratio as a seesaw balance point. If you're sitting on one end (long Asset Y), the hedge ratio tells you exactly where on the other side to place Asset X so the seesaw stays perfectly balanced—immune to the broader market's ups and downs.</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="3-market-standards">3. Market Standards</h2>

<h3 id="default-parameters">Default Parameters</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Parameter</td><td class="px-4 py-2 border-b border-[#2a2e39]">Standard Value</td><td class="px-4 py-2 border-b border-[#2a2e39]">Rationale</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Period</td><td class="px-4 py-2 border-b border-[#2a2e39]">60</td><td class="px-4 py-2 border-b border-[#2a2e39]">Approximately one trading quarter</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Update Frequency</td><td class="px-4 py-2 border-b border-[#2a2e39]">Daily</td><td class="px-4 py-2 border-b border-[#2a2e39]">Recalculate on bar close</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">High-Frequency Alternative</td><td class="px-4 py-2 border-b border-[#2a2e39]">60-120 minutes</td><td class="px-4 py-2 border-b border-[#2a2e39]">For intraday microstructure</td></tr>
</table></div>

<h3 id="timeframe-recommendations">Timeframe Recommendations</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Trading Style</td><td class="px-4 py-2 border-b border-[#2a2e39]">Period</td><td class="px-4 py-2 border-b border-[#2a2e39]">Application</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Intraday Pairs</td><td class="px-4 py-2 border-b border-[#2a2e39]">60-120 bars</td><td class="px-4 py-2 border-b border-[#2a2e39]">Capture microstructure shifts</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Daily Pairs</td><td class="px-4 py-2 border-b border-[#2a2e39]">60 days</td><td class="px-4 py-2 border-b border-[#2a2e39]">Standard statistical arbitrage</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Long-Term Value</td><td class="px-4 py-2 border-b border-[#2a2e39]">120+ days</td><td class="px-4 py-2 border-b border-[#2a2e39]">Fundamental convergence plays</td></tr>
</table></div>

<h3 id="why-these-values">Why These Values?</h3>

<p class="mb-4">60 days represents roughly one quarter of trading data—long enough for statistical significance but short enough to adapt to regime changes. Tartaglia's original Morgan Stanley group found this balanced responsiveness with stability.</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="4-market-context">4. Market Context</h2>

<h3 id="best-conditions">Best Conditions</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Condition</td><td class="px-4 py-2 border-b border-[#2a2e39]">Why It Works</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Cointegrated Pairs</td><td class="px-4 py-2 border-b border-[#2a2e39]">Assets share long-term equilibrium (e.g., Visa/Mastercard)</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Sector Pairs</td><td class="px-4 py-2 border-b border-[#2a2e39]">Same industry with similar fundamental drivers</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Mean-Reverting Regimes</td><td class="px-4 py-2 border-b border-[#2a2e39]">Spread oscillates around stable equilibrium</td></tr>
</table></div>

<h3 id="limitations">Limitations</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Condition</td><td class="px-4 py-2 border-b border-[#2a2e39]">Problem</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Structural Breaks</td><td class="px-4 py-2 border-b border-[#2a2e39]">M&A, bankruptcy, or sector rotation destroys correlation</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Trending Markets</td><td class="px-4 py-2 border-b border-[#2a2e39]">Pairs drift apart, hedge ratio becomes unstable</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Low Correlation</td><td class="px-4 py-2 border-b border-[#2a2e39]">No meaningful relationship to exploit</td></tr>
</table></div>

<h3 id="asset-class-suitability">Asset Class Suitability</h3>

<p class="mb-4">- Equities — Classic pairs trading domain</p>
<p class="mb-4">- ETFs — Sector/Index arbitrage</p>
<p class="mb-4">- Crypto — BTC/ETH and similar pairs</p>
<p class="mb-4">- Commodities — Contango/backwardation complicates hedging</p>
<p class="mb-4">- Options — Delta hedging uses different methodology</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="5-entry-signals">5. Entry Signals</h2>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Signal Type</td><td class="px-4 py-2 border-b border-[#2a2e39]">Condition</td><td class="px-4 py-2 border-b border-[#2a2e39]">Direction</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strength</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Long Spread</td><td class="px-4 py-2 border-b border-[#2a2e39]">Spread < Mean - k×StdDev</td><td class="px-4 py-2 border-b border-[#2a2e39]">Buy Y, Short βX</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Short Spread</td><td class="px-4 py-2 border-b border-[#2a2e39]">Spread > Mean + k×StdDev</td><td class="px-4 py-2 border-b border-[#2a2e39]">Short Y, Buy βX</td><td class="px-4 py-2 border-b border-[#2a2e39]">Strong</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Beta Divergence (Bull)</td><td class="px-4 py-2 border-b border-[#2a2e39]">Price Y Lower Low, Beta Higher Low</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bullish Spread</td><td class="px-4 py-2 border-b border-[#2a2e39]">Moderate</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Beta Divergence (Bear)</td><td class="px-4 py-2 border-b border-[#2a2e39]">Price Y Higher High, Beta Lower High</td><td class="px-4 py-2 border-b border-[#2a2e39]">Bearish Spread</td><td class="px-4 py-2 border-b border-[#2a2e39]">Moderate</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Correlation Breakdown</td><td class="px-4 py-2 border-b border-[#2a2e39]">Rolling Correlation < 0.5</td><td class="px-4 py-2 border-b border-[#2a2e39]">Exit All</td><td class="px-4 py-2 border-b border-[#2a2e39]">Warning</td></tr>
</table></div>

<h3 id="primary-long-signal">Primary Long Signal</h3>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
IF Spread &lt; (RollingMean - 2 × RollingStdDev)
AND RollingCorrelation &gt; 0.80
AND HedgeRatio is stable (low volatility)
THEN → LONG SPREAD (Buy Y, Short β×X)
</code></pre>

<h3 id="primary-short-signal">Primary Short Signal</h3>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
IF Spread &gt; (RollingMean + 2 × RollingStdDev)
AND RollingCorrelation &gt; 0.80
AND HedgeRatio is stable (low volatility)
THEN → SHORT SPREAD (Short Y, Buy β×X)
</code></pre>

<hr class="border-[#2a2e39] my-8">

<h2 id="6-filter-usage">6. Filter Usage</h2>

<p class="mb-4">The Rolling Hedge Ratio is primarily a position sizing tool rather than a signal generator, but it serves crucial filtering functions:</p>

<h3 id="filter-rules">Filter Rules</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Rule</td><td class="px-4 py-2 border-b border-[#2a2e39]">Application</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]"><code>Correlation > 0.80</code></td><td class="px-4 py-2 border-b border-[#2a2e39]">Only trade when relationship is strong</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]"><code>StdDev(Beta) < 0.5</code></td><td class="px-4 py-2 border-b border-[#2a2e39]">Reject unstable pair dynamics</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]"><code>ADF Test p < 0.05</code></td><td class="px-4 py-2 border-b border-[#2a2e39]">Confirm spread is stationary</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]"><code>Beta > 0</code></td><td class="px-4 py-2 border-b border-[#2a2e39]">Ensure positive correlation</td></tr>
</table></div>

<h3 id="recommended-pairings">Recommended Pairings</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Partner Indicator</td><td class="px-4 py-2 border-b border-[#2a2e39]">Synergy Logic</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Rolling Correlation</td><td class="px-4 py-2 border-b border-[#2a2e39]">Validates quality of hedge ratio</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Z-Score</td><td class="px-4 py-2 border-b border-[#2a2e39]">Normalizes spread for entry signals</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Half-Life</td><td class="px-4 py-2 border-b border-[#2a2e39]">Confirms mean reversion speed</td></tr>
</table></div>

<h3 id="example-combined-strategy">Example Combined Strategy</h3>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
FILTER CONDITIONS:
&nbsp;&nbsp;RollingCorrelation(60) &gt; 0.80        // Strong relationship
&nbsp;&nbsp;StdDev(HedgeRatio, 20) &lt; 0.30        // Stable beta
&nbsp;&nbsp;ADF_pvalue(Spread) &lt; 0.05            // Stationary spread

SIGNAL:
&nbsp;&nbsp;Use Z-Score of Spread for entries
&nbsp;&nbsp;
POSITION SIZE:
&nbsp;&nbsp;Long $10,000 of Y → Short $10,000 × β of X
</code></pre>

<hr class="border-[#2a2e39] my-8">

<h2 id="7-practical-cautions">7. Practical Cautions</h2>

<h3 id="lag-characteristics">Lag Characteristics</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Component</td><td class="px-4 py-2 border-b border-[#2a2e39]">Approximate Lag</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">First Valid Value</td><td class="px-4 py-2 border-b border-[#2a2e39]">Period bars (e.g., 60)</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Responsiveness</td><td class="px-4 py-2 border-b border-[#2a2e39]">Slow—designed for stability</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Regime Detection</td><td class="px-4 py-2 border-b border-[#2a2e39]">10-20 bars after break begins</td></tr>
</table></div>

<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">Reality Check: The hedge ratio is backward-looking by design. A sudden news event (merger announcement, earnings shock) will not be reflected until the contaminated data fills the window.</blockquote>

<h3 id="false-signal-scenarios">False Signal Scenarios</h3>

<p class="mb-4">1. The "Phantom Correlation"  </p>
<p class="mb-4">   Two unrelated assets temporarily correlate due to sector rotation, creating a false cointegration signal.</p>

<p class="mb-4">2. Variance Collapse  </p>
<p class="mb-4">   If Asset X trades flat (halted, low volume), the denominator approaches zero, causing the hedge ratio to spike or become undefined.</p>

<p class="mb-4">3. Decoupling Trap  </p>
<p class="mb-4">   Entering a trade right before a corporate action (split, dividend, merger) that fundamentally breaks the pair relationship.</p>

<h3 id="mitigation-strategies">Mitigation Strategies</h3>

<p class="mb-4">- Run ADF Test weekly to confirm spread stationarity</p>
<p class="mb-4">- Monitor Beta Volatility — if StdDev(β) > 0.5, pause trading</p>
<p class="mb-4">- Set Hard Stop when Z-Score exceeds ±4.0 (relationship likely broken)</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="8-pro-insights">8. Pro Insights</h2>

<h3 id="beta-rotation-strategy">Beta Rotation Strategy</h3>

<p class="mb-4">Sophisticated traders don't just use the hedge ratio to calculate position size—they trade the ratio itself:</p>

<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">Insight: If the Rolling Beta historically averages 1.2 but spikes to 1.8, this represents temporary over-sensitivity. Reduce hedge size anticipating β will revert to 1.2, essentially "shorting the correlation."</blockquote>

<h3 id="structural-break-detection">Structural Break Detection</h3>

<p class="mb-4">Professional quants monitor the rate of change of the hedge ratio as an early warning system:</p>

<p class="mb-4">- Beta drifting steadily: Market regime shift</p>
<p class="mb-4">- Beta spiking suddenly: News event or liquidity shock</p>
<p class="mb-4">- Beta oscillating wildly: Relationship is breaking down</p>

<h3 id="kalman-filter-enhancement">Kalman Filter Enhancement</h3>

<p class="mb-4">Institutional traders often replace OLS with Kalman Filter estimation for real-time, noise-adaptive hedge ratio calculation that responds faster to regime changes while filtering spurious movements.</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="9-summary">9. Summary</h2>

<blockquote class="border-l-4 border-gray-300 pl-4 italic text-gray-700 my-4 bg-gray-50 py-2 pr-2 rounded-r">"The hedge ratio tells you how much of the other side you need to keep your pairs trade perfectly balanced—get it wrong, and you're not market-neutral anymore."</blockquote>

<p class="mb-4"><h2 class="text-2xl font-bold mt-12 mb-6 border-b pb-2">PART 2: SUPPLEMENTARY GUIDE</h2></p>

<h2 id="1-core-concept">1. Core Concept</h2>

<p class="mb-4">The Rolling Hedge Ratio answers one fundamental question: "How many dollars of Asset X do I need to offset one dollar of Asset Y?"</p>

<p class="mb-4">In pairs trading, you're betting that two related assets will converge. But "related" doesn't mean "equal"—one might move $1.20 for every $1.00 the other moves. The hedge ratio captures this sensitivity, ensuring your long and short positions perfectly offset each other's market exposure.</p>

<p class="mb-4">The "rolling" aspect is critical: relationships change. What was a 1.0 ratio last year might be 1.3 today due to shifting market dynamics, corporate changes, or sector rotation. Recalculating daily keeps your hedge current.</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="2-statistical-edge">2. Statistical Edge</h2>

<h3 id="backtest-evidence">Backtest Evidence</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Signal Type</td><td class="px-4 py-2 border-b border-[#2a2e39]">Expected Outcome</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Spread at ±2σ with stable β</td><td class="px-4 py-2 border-b border-[#2a2e39]">68% mean reversion within 5 days</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">β volatility spike</td><td class="px-4 py-2 border-b border-[#2a2e39]">75% chance of spread divergence</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Correlation drop below 0.7</td><td class="px-4 py-2 border-b border-[#2a2e39]">60% chance β becomes unreliable</td></tr>
</table></div>

<h3 id="why-it-works">Why It Works</h3>

<p class="mb-4">The hedge ratio exploits the law of one price in relative valuation. Two fundamentally similar assets should trade in consistent proportion. When this proportion temporarily breaks, arbitrageurs profit by betting on restoration.</p>

<h3 id="academic-reference">Academic Reference</h3>

<p class="mb-4">The framework was formalized in Gatev, Goetzmann, and Rouwenhorst (2006), *"Pairs Trading: Performance of a Relative Value Arbitrage Rule"*, published in the Review of Financial Studies. Their research demonstrated that pairs trading strategies using rolling regression consistently generated positive alpha.</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="3-actionable-strategy">3. Actionable Strategy</h2>

<h3 id="strategy-name:-"the-stable-relationship-filter"">Strategy Name: "The Stable Relationship Filter"</h3>

<p class="mb-4">Concept: Only trade pairs with rock-solid statistical relationships, confirmed by multiple metrics.</p>

<p class="mb-4">Setup Requirements:</p>
<p class="mb-4">1. Two assets with historical correlation > 0.85</p>
<p class="mb-4">2. Rolling Hedge Ratio with 60-day window</p>
<p class="mb-4">3. Rolling Correlation with matching window</p>

<p class="mb-4">Entry Trigger:</p>
<p class="mb-4">- Rolling Correlation remains > 0.80</p>
<p class="mb-4">- Hedge Ratio volatility (20-day StdDev) < 0.30</p>
<p class="mb-4">- Spread Z-Score crosses ±2.0</p>

<p class="mb-4">Position Sizing:</p>
<p class="mb-4">- Long $10,000 Asset Y</p>
<p class="mb-4">- Short $10,000 × β Asset X</p>

<p class="mb-4">Exit Rules:</p>
<p class="mb-4">1. Primary Exit: Spread Z-Score returns to 0</p>
<p class="mb-4">2. Stop Loss: Z-Score exceeds ±4.0 (correlation broken)</p>
<p class="mb-4">3. Time Stop: 20 days if spread doesn't converge</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="4-risks-&-limitations">4. Risks & Limitations</h2>

<h3 id="failure-patterns">Failure Patterns</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Pattern</td><td class="px-4 py-2 border-b border-[#2a2e39]">Description</td><td class="px-4 py-2 border-b border-[#2a2e39]">Mitigation</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Variance Collapse</td><td class="px-4 py-2 border-b border-[#2a2e39]">Asset X trades flat → β explodes</td><td class="px-4 py-2 border-b border-[#2a2e39]">Check if denominator approaches zero</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Negative Flip</td><td class="px-4 py-2 border-b border-[#2a2e39]">β turns negative unexpectedly</td><td class="px-4 py-2 border-b border-[#2a2e39]">Halt trading, investigate cause</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Perfect Collinearity</td><td class="px-4 py-2 border-b border-[#2a2e39]">Assets move identically → no edge</td><td class="px-4 py-2 border-b border-[#2a2e39]">Matrix singularity check</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Regime Change</td><td class="px-4 py-2 border-b border-[#2a2e39]">Fundamental relationship breaks</td><td class="px-4 py-2 border-b border-[#2a2e39]">Monitor ADF test results</td></tr>
</table></div>

<h3 id="psychological-traps">Psychological Traps</h3>

<p class="mb-4">1. The "It Will Come Back" Trap  </p>
<p class="mb-4">   Holding a broken pair position believing the old relationship will restore when fundamentals have permanently changed.</p>

<p class="mb-4">2. Over-Optimization  </p>
<p class="mb-4">   Fitting the hedge ratio window to historical data, finding "perfect" pairs that don't persist out-of-sample.</p>

<p class="mb-4">3. Ignoring Transaction Costs  </p>
<p class="mb-4">   Pairs trading requires maintaining two positions—costs eat into thin arbitrage margins.</p>

<h3 id="common-misinterpretations">Common Misinterpretations</h3>

<p class="mb-4">- "Higher β = better trade" → β just measures sensitivity, not profitability</p>
<p class="mb-4">- "Stable β = safe trade" → Even stable relationships can break suddenly</p>
<p class="mb-4">- "β works for any two assets" → Requires genuine economic linkage</p>

<hr class="border-[#2a2e39] my-8">

<h2 id="5-further-study">5. Further Study</h2>

<h3 id="creator-attribution">Creator Attribution</h3>

<p class="mb-4">The quantitative pairs trading framework was pioneered by Nunzio Tartaglia's team at Morgan Stanley in the mid-1980s. Team members included future legends David Shaw (D.E. Shaw) and Robert Frey (Renaissance Technologies).</p>

<h3 id="parent/child-indicators">Parent/Child Indicators</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Indicator</td><td class="px-4 py-2 border-b border-[#2a2e39]">Relationship</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Rolling Spread Z-Score</td><td class="px-4 py-2 border-b border-[#2a2e39]">Child — Uses β to construct the spread</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Rolling Correlation</td><td class="px-4 py-2 border-b border-[#2a2e39]">Sibling — Validates β quality</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Kalman Filter Beta</td><td class="px-4 py-2 border-b border-[#2a2e39]">Advanced — Adaptive β estimation</td></tr>
</table></div>

<h3 id="recommended-readings">Recommended Readings</h3>

<p class="mb-4">1. *Pairs Trading: Quantitative Methods and Analysis* — Ganapathy Vidyamurthy</p>
<p class="mb-4">2. *Algorithmic Trading* — Ernest Chan</p>
<p class="mb-4">3. *Statistical Arbitrage* — Andrew Pole</p>

<hr class="border-[#2a2e39] my-8">

<h3 id="55-related-indicators-comparison">5.5 Related Indicators Comparison</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Feature</td><td class="px-4 py-2 border-b border-[#2a2e39]">Rolling Hedge Ratio</td><td class="px-4 py-2 border-b border-[#2a2e39]">Rolling Correlation</td><td class="px-4 py-2 border-b border-[#2a2e39]">Kalman Beta</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Measures</td><td class="px-4 py-2 border-b border-[#2a2e39]">Position sizing ratio</td><td class="px-4 py-2 border-b border-[#2a2e39]">Relationship strength</td><td class="px-4 py-2 border-b border-[#2a2e39]">Adaptive sensitivity</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Output Range</td><td class="px-4 py-2 border-b border-[#2a2e39]">Unbounded</td><td class="px-4 py-2 border-b border-[#2a2e39]">-1 to +1</td><td class="px-4 py-2 border-b border-[#2a2e39]">Unbounded</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Adaptiveness</td><td class="px-4 py-2 border-b border-[#2a2e39]">Fixed window</td><td class="px-4 py-2 border-b border-[#2a2e39]">Fixed window</td><td class="px-4 py-2 border-b border-[#2a2e39]">Real-time</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Complexity</td><td class="px-4 py-2 border-b border-[#2a2e39]">Simple</td><td class="px-4 py-2 border-b border-[#2a2e39]">Simple</td><td class="px-4 py-2 border-b border-[#2a2e39]">Complex</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Best For</td><td class="px-4 py-2 border-b border-[#2a2e39]">Static pairs</td><td class="px-4 py-2 border-b border-[#2a2e39]">Pair validation</td><td class="px-4 py-2 border-b border-[#2a2e39]">Dynamic pairs</td></tr>
</table></div>

<p class="mb-4">When to Use Which:</p>
<p class="mb-4">- Rolling Hedge Ratio — Standard pairs trading position sizing</p>
<p class="mb-4">- Rolling Correlation — Pre-filtering pair candidates</p>
<p class="mb-4">- Kalman Beta — High-frequency or volatile pairs</p>

<p class="mb-4"><h2 class="text-2xl font-bold mt-12 mb-6 border-b pb-2">PART 3: ADVANCED SIGNAL REFERENCE</h2></p>

<h2 id="advanced-signal-reference">Advanced Signal Reference</h2>

<h3 id="threshold-matrix">Threshold Matrix</h3>

<div class="overflow-x-auto my-4"><table class="min-w-full divide-y divide-[#2a2e39] text-sm text-left">
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Beta Level</td><td class="px-4 py-2 border-b border-[#2a2e39]">Stability</td><td class="px-4 py-2 border-b border-[#2a2e39]">Correlation</td><td class="px-4 py-2 border-b border-[#2a2e39]">Action</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">0.5 - 1.5</td><td class="px-4 py-2 border-b border-[#2a2e39]">Low σ</td><td class="px-4 py-2 border-b border-[#2a2e39]">> 0.85</td><td class="px-4 py-2 border-b border-[#2a2e39]">Optimal trading zone</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">0.5 - 1.5</td><td class="px-4 py-2 border-b border-[#2a2e39]">High σ</td><td class="px-4 py-2 border-b border-[#2a2e39]">> 0.70</td><td class="px-4 py-2 border-b border-[#2a2e39]">Trade with caution</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">< 0.3 or > 2.0</td><td class="px-4 py-2 border-b border-[#2a2e39]">Any</td><td class="px-4 py-2 border-b border-[#2a2e39]">Any</td><td class="px-4 py-2 border-b border-[#2a2e39]">Review pair suitability</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Negative</td><td class="px-4 py-2 border-b border-[#2a2e39]">Any</td><td class="px-4 py-2 border-b border-[#2a2e39]">Any</td><td class="px-4 py-2 border-b border-[#2a2e39]">Halt trading immediately</td></tr>
<tr><td class="px-4 py-2 border-b border-[#2a2e39]">Trending</td><td class="px-4 py-2 border-b border-[#2a2e39]">N/A</td><td class="px-4 py-2 border-b border-[#2a2e39]">Falling</td><td class="px-4 py-2 border-b border-[#2a2e39]">Exit positions</td></tr>
</table></div>

<h3 id="signal-patterns">Signal Patterns</h3>

<h4 id="beta-stability-check">Beta Stability Check</h4>
<p class="mb-4">This filter ensures the hedge ratio is stable enough for reliable position sizing by measuring recent volatility. High beta volatility (σ > 0.5) indicates the relationship is unstable and pairs trading should be paused. Stable beta is essential because constantly changing hedge ratios mean your position sizing is always stale.</p>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-python">
def beta_stable(hedge_ratios, lookback=20, threshold=0.5):
&nbsp;&nbsp;&nbsp;&nbsp;recent_beta = hedge_ratios[-lookback:]
&nbsp;&nbsp;&nbsp;&nbsp;volatility = np.std(recent_beta)
&nbsp;&nbsp;&nbsp;&nbsp;return volatility &lt; threshold
</code></pre>

<h4 id="divergence-detection">Divergence Detection</h4>
<p class="mb-4">This signal identifies when price and beta are diverging, potentially indicating spread direction changes. Bearish divergence (price up, beta down) suggests the relationship is weakening despite price gains; bullish divergence (price down, beta up) suggests strengthening. Sophisticated traders use beta divergence as an early warning system for regime changes.</p>

<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-python">
def beta_divergence(prices_y, hedge_ratios, lookback=10):
&nbsp;&nbsp;&nbsp;&nbsp;price_trend = prices_y[-1] &gt; prices_y[-lookback]  # Higher price
&nbsp;&nbsp;&nbsp;&nbsp;beta_trend = hedge_ratios[-1] &gt; hedge_ratios[-lookback]  # Higher beta
&nbsp;&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;# Bearish divergence: price up, beta down
&nbsp;&nbsp;&nbsp;&nbsp;if price_trend and not beta_trend:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;BEARISH&quot;
&nbsp;&nbsp;&nbsp;&nbsp;# Bullish divergence: price down, beta up
&nbsp;&nbsp;&nbsp;&nbsp;elif not price_trend and beta_trend:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return &quot;BULLISH&quot;
&nbsp;&nbsp;&nbsp;&nbsp;return &quot;NEUTRAL&quot;
</code></pre>

<h3 id="screening-filters">Screening Filters</h3>

<h4 id="find-stable-pairs">Find Stable Pairs</h4>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
RollingCorrelation(60) &gt; 0.80
AND StdDev(HedgeRatio(60), 20) &lt; 0.30
AND HedgeRatio(60) &gt; 0
AND HedgeRatio(60) &lt; 2.0
</code></pre>

<h4 id="pair-breakdown-alert">Pair Breakdown Alert</h4>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
RollingCorrelation(60) &lt; RollingCorrelation(60)[20] - 0.15
OR StdDev(HedgeRatio(60), 10) &gt; 2 × StdDev(HedgeRatio(60), 60)
</code></pre>

<h3 id="combination-strategies">Combination Strategies</h3>

<h4 id="hedge-ratio-+-correlation-quality-filter">Hedge Ratio + Correlation Quality Filter</h4>
<pre class="whitespace-pre overflow-x-auto bg-slate-800 text-slate-100 p-4 rounded"><code class="language-">
FILTER:
&nbsp;&nbsp;RollingCorrelation(60) &gt; 0.80
&nbsp;&nbsp;StdDev(Beta(60), 20) &lt; Threshold

ENTRY (via Z-Score):
&nbsp;&nbsp;Z-Score(Spread) &lt; -2.0 → Long Spread
&nbsp;&nbsp;Z-Score(Spread) &gt; +2.0 → Short Spread

POSITION SIZE:
&nbsp;&nbsp;Y_dollars = Capital
&nbsp;&nbsp;X_dollars = Capital × Current_Beta

EXIT:
&nbsp;&nbsp;Z-Score returns to 0
&nbsp;&nbsp;OR Correlation drops below 0.50
</code></pre>






                    </div>
                </article>
                <!-- Right: Sticky TOC -->
                <aside class="lg:block w-64 flex-shrink-0">
                    <div class="sticky top-24">
                        <h3 class="font-bold text-slate-900 mb-4 pb-2 border-b border-slate-100 text-sm uppercase tracking-wider">
                            On this page
                        </h3>
                        <nav id="toc-nav" class="space-y-1 text-sm text-slate-600">
                            <a href="#1-identity" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">1. Identity</a>
<a href="#2-calculation-logic" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">2. Calculation Logic</a>
<a href="#formula" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Formula</a>
<a href="#real-world-analogy" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Real-World Analogy</a>
<a href="#3-market-standards" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">3. Market Standards</a>
<a href="#default-parameters" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Default Parameters</a>
<a href="#timeframe-recommendations" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Timeframe Recommendations</a>
<a href="#why-these-values" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Why These Values?</a>
<a href="#4-market-context" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">4. Market Context</a>
<a href="#best-conditions" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Best Conditions</a>
<a href="#limitations" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Limitations</a>
<a href="#asset-class-suitability" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Asset Class Suitability</a>
<a href="#5-entry-signals" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">5. Entry Signals</a>
<a href="#primary-long-signal" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Primary Long Signal</a>
<a href="#primary-short-signal" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Primary Short Signal</a>
<a href="#6-filter-usage" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">6. Filter Usage</a>
<a href="#filter-rules" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Filter Rules</a>
<a href="#recommended-pairings" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Recommended Pairings</a>
<a href="#example-combined-strategy" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Example Combined Strategy</a>
<a href="#7-practical-cautions" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">7. Practical Cautions</a>
<a href="#lag-characteristics" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Lag Characteristics</a>
<a href="#false-signal-scenarios" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">False Signal Scenarios</a>
<a href="#mitigation-strategies" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Mitigation Strategies</a>
<a href="#8-pro-insights" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">8. Pro Insights</a>
<a href="#beta-rotation-strategy" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Beta Rotation Strategy</a>
<a href="#structural-break-detection" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Structural Break Detection</a>
<a href="#kalman-filter-enhancement" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Kalman Filter Enhancement</a>
<a href="#9-summary" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">9. Summary</a>
<a href="#1-core-concept" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">1. Core Concept</a>
<a href="#2-statistical-edge" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">2. Statistical Edge</a>
<a href="#backtest-evidence" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Backtest Evidence</a>
<a href="#why-it-works" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Why It Works</a>
<a href="#academic-reference" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Academic Reference</a>
<a href="#3-actionable-strategy" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">3. Actionable Strategy</a>
<a href="#strategy-name:-"the-stable-relationship-filter"" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Strategy Name: "The Stable Relationship Filter"</a>
<a href="#4-risks-&-limitations" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">4. Risks & Limitations</a>
<a href="#failure-patterns" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Failure Patterns</a>
<a href="#psychological-traps" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Psychological Traps</a>
<a href="#common-misinterpretations" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Common Misinterpretations</a>
<a href="#5-further-study" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">5. Further Study</a>
<a href="#creator-attribution" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Creator Attribution</a>
<a href="#parent/child-indicators" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Parent/Child Indicators</a>
<a href="#recommended-readings" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Recommended Readings</a>
<a href="#55-related-indicators-comparison" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">5.5 Related Indicators Comparison</a>
<a href="#advanced-signal-reference" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors ">Advanced Signal Reference</a>
<a href="#threshold-matrix" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Threshold Matrix</a>
<a href="#signal-patterns" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Signal Patterns</a>
<a href="#screening-filters" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Screening Filters</a>
<a href="#combination-strategies" class="toc-link block py-1 px-2 rounded hover:bg-slate-50 transition-colors pl-4">Combination Strategies</a>

                        </nav>
                        <div class="mt-8 pt-4 border-t border-slate-100">
                            <a href="#" class="text-xs text-slate-400 hover:text-indigo-600 flex items-center transition-colors">
                                Back to Top
                            </a>
                        </div>
                    </div>
                </aside>
            </div>
        </section>


    </div>


        <!-- Footer -->
    <footer class="bg-white border-t border-slate-200 mt-12">
        <div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
            <p class="text-center text-slate-400 text-sm">
                &copy; 2023-2025 I ant I Investigates. All rights reserved.
            </p>
        </div>
    </footer>
        <!-- ========================================== -->
    <!-- 1. DATA & LOGIC INJECTION                  -->
    <!-- ========================================== -->
    <script>
        window.IndicatorLogic = {
            name: "RollingHedgeRatioFeature",
            params: [],
            calculate: null
        };
        (function() {
            try {
                const injectedCode = `
        window.IndicatorLogic = {
            calculate: (data, params) => {
                const period = params.period || 60;
                const result = RollingHedgeRatioFeature.calculate(data, period);
                // Handle both array and object returns
                if (Array.isArray(result)) {
                    return { main: result };
                }
                return result;
            }
        };
        `;
                const isTemplatePlaceholder = injectedCode.includes('{{') && injectedCode.includes('CODE_INDICATOR_LOGIC');
                if (injectedCode && injectedCode.trim().length > 0 && !isTemplatePlaceholder) {
                    new Function(injectedCode)();
                } else {
                    console.warn("Playground Logic: Running in Preview/Fallback mode.");
                    window.IndicatorLogic.calculate = () => []; 
                }
            } catch (e) {
                console.error("Critical Error in Logic Injection:", e);
                window.IndicatorLogic.calculate = () => [];
            }
        })();
    </script>

    <!-- ========================================== -->
    <!-- 2. VISUALIZATION ENGINE                    -->
    <!-- ========================================== -->
    <script>
        mermaid.initialize({ startOnLoad: false, theme: 'neutral', securityLevel: 'loose' });
    </script>
    <!-- ========================================== -->
    <!-- 3. UI CONTROLLERS & APP INITIALIZATION     -->
    <!-- ========================================== -->
    <!-- INLINE UI CONTROLLERS (PORTED FROM 0117) -->
    <script src="../assets/js/RollingHedgeRatioFeature.js"></script>
    <!-- JSON Data Containers (XSS-safe) -->
    <script id="data-indicator-config" type="application/json">
[{"id": "period", "label": "Period (60)", "type": "number", "value": 60, "min": 2, "max": 100}]
    </script>
    <script id="data-indicator-display" type="application/json">
{"isOverlay": true, "plots": {"main": {"label": "RollingHedgeRatioFeature", "color": "#4f46e5", "type": "line"}}}
    </script>
    <script>
        // --- 0. Indicator Data Injection ---
        // Use existing IndicatorLogic (set in earlier script block), only set if not exists
        var IndicatorLogic = window.IndicatorLogic || { calculate: null };
        var IndicatorConfig = [];
        var IndicatorDisplay = { isOverlay: false, plots: {} };

        // 1. Library Code - loaded externally before this block

        // 2. Configuration (XSS-safe via script type="application/json")
        try {
            var configEl = document.getElementById('data-indicator-config');
            if(configEl && configEl.textContent.trim()) {
                IndicatorConfig = JSON.parse(configEl.textContent);
            }
        } catch(e){ console.warn('Config parse error', e); }

        try {
            var displayEl = document.getElementById('data-indicator-display');
            if(displayEl && displayEl.textContent.trim()) {
                IndicatorDisplay = JSON.parse(displayEl.textContent);
            }
        } catch(e){ console.warn('Display parse error', e); }

        // 3. Logic Adapter
        window.IndicatorLogic = {
            calculate: (data, params) => {
                const period = params.period || 60;
                const result = RollingHedgeRatioFeature.calculate(data, period);
                // Handle both array and object returns
                if (Array.isArray(result)) {
                    return { main: result };
                }
                return result;
            }
        };
    </script>

    <!-- UI Controllers: indicator.js loads first to define PlaygroundController -->
    <script src="../assets/js/indicator.js" defer></script>
    <!-- script.js loads second, skips PlaygroundController if already defined -->
    <script src="../assets/js/script.js" defer></script>

</body>
</html>