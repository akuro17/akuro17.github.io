window.registerIndicatorCode('YangZhangVolatilityIndicator', {"csharp_simple":"<div class=\"highlight\"><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">1</span><span class=\"k\">using</span> System;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">2</span><span class=\"k\">using</span> System.Collections.Generic;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">3</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">4</span><span class=\"k\">namespace</span> TechnicalIndicators</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">5</span>{</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">6</span>    <span class=\"c1\">/// &lt;summary&gt;</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">7</span>    <span class=\"c1\">/// Yang-Zhang Volatility Indicator</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">8</span>    <span class=\"c1\">/// &lt;/summary&gt;</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">9</span>    <span class=\"c1\">/// &lt;remarks&gt;</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">10</span>    <span class=\"c1\">/// A minimum-variance volatility estimator that handles both opening jumps and trading within the day.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">11</span>    <span class=\"c1\">/// &lt;list type=&quot;bullet&quot;&gt;</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">12</span>    <span class=\"c1\">/// &lt;item&gt;&lt;description&gt;Combines Overnight Volatility, Open-to-Close Volatility, and Rogers-Satchell Volatility.&lt;/description&gt;&lt;/item&gt;</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">13</span>    <span class=\"c1\">/// &lt;item&gt;&lt;description&gt;Considered one of the most efficient historical volatility estimators.&lt;/description&gt;&lt;/item&gt;</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">14</span>    <span class=\"c1\">/// &lt;/list&gt;</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">15</span>    <span class=\"c1\">/// &lt;/remarks&gt;</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">16</span>    <span class=\"k\">public</span> <span class=\"k\">class</span> <span class=\"nc\">YangZhangVolatilityIndicator</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">17</span>    {</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">18</span>        <span class=\"k\">public</span> <span class=\"kt\">int</span> Period { <span class=\"k\">get</span>; }</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">19</span>        <span class=\"k\">public</span> List&lt;<span class=\"kt\">decimal?</span>&gt; Values { <span class=\"k\">get</span>; } = <span class=\"k\">new</span>();</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">20</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">21</span>        <span class=\"k\">public</span> YangZhangVolatilityIndicator(<span class=\"kt\">int</span> period = 20)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">22</span>        {</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">23</span>            <span class=\"k\">if</span> (period &lt;= 1) <span class=\"k\">throw</span> <span class=\"k\">new</span> ArgumentOutOfRangeException(<span class=\"k\">nameof</span>(period));</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">24</span>            Period = period;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">25</span>        }</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">26</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">27</span>        <span class=\"k\">public</span> <span class=\"k\">void</span> Calculate(IEnumerable&lt;CandleData&gt; candles)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">28</span>        {</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">29</span>            Values.Clear();</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">30</span>            <span class=\"kt\">var</span> c = <span class=\"k\">new</span> List&lt;CandleData&gt;(candles);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">31</span>            <span class=\"k\">if</span> (c.Count &lt; 2) <span class=\"k\">return</span>;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">32</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">33</span>            Values.Add(<span class=\"k\">null</span>); <span class=\"c1\">// First candle has no previous close for overnight calc</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">34</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">35</span>            <span class=\"k\">for</span> (<span class=\"kt\">int</span> i = 1; i &lt; c.Count; i++)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">36</span>            {</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">37</span>                <span class=\"k\">if</span> (i &lt; Period) { Values.Add(<span class=\"k\">null</span>); <span class=\"k\">continue</span>; }</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">38</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">39</span>                <span class=\"kt\">double</span> sumOvernightSq = 0, sumOpenCloseSq = 0, sumRogersSatchellSq = 0;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">40</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">41</span>                <span class=\"k\">for</span> (<span class=\"kt\">int</span> j = 0; j &lt; Period; j++)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">42</span>                {</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">43</span>                    <span class=\"kt\">int</span> idx = i - j;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">44</span>                    <span class=\"k\">if</span> (idx &lt; 1) <span class=\"k\">continue</span>;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">45</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">46</span>                    <span class=\"kt\">double</span> prevClose = (<span class=\"kt\">double</span>)c[idx - 1].Close;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">47</span>                    <span class=\"kt\">double</span> open = (<span class=\"kt\">double</span>)c[idx].Open;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">48</span>                    <span class=\"kt\">double</span> high = (<span class=\"kt\">double</span>)c[idx].High;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">49</span>                    <span class=\"kt\">double</span> low = (<span class=\"kt\">double</span>)c[idx].Low;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">50</span>                    <span class=\"kt\">double</span> close = (<span class=\"kt\">double</span>)c[idx].Close;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">51</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">52</span>                    <span class=\"k\">if</span> (prevClose &lt;= 0 || open &lt;= 0) <span class=\"k\">continue</span>;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">53</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">54</span>                    <span class=\"kt\">double</span> overnight = Math.Log(open / prevClose);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">55</span>                    <span class=\"kt\">double</span> openClose = Math.Log(close / open);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">56</span>                    <span class=\"kt\">double</span> rs = Math.Log(high / open) * Math.Log(high / close) + Math.Log(low / open) * Math.Log(low / close);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">57</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">58</span>                    sumOvernightSq += overnight * overnight;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">59</span>                    sumOpenCloseSq += openClose * openClose;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">60</span>                    sumRogersSatchellSq += rs;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">61</span>                }</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">62</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">63</span>                <span class=\"kt\">double</span> k = 0.34 / (1.34 + (Period + 1.0) / (Period - 1.0));</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">64</span>                <span class=\"kt\">double</span> overnightVar = sumOvernightSq / Period;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">65</span>                <span class=\"kt\">double</span> openCloseVar = sumOpenCloseSq / Period;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">66</span>                <span class=\"kt\">double</span> rsVar = sumRogersSatchellSq / Period;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">67</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">68</span>                <span class=\"kt\">double</span> yangZhangVar = overnightVar + k * openCloseVar + (1 - k) * rsVar;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">69</span>                <span class=\"kt\">double</span> annualizedVol = Math.Sqrt(yangZhangVar * 252) * 100;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">70</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">71</span>                Values.Add((<span class=\"kt\">decimal</span>)annualizedVol);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">72</span>            }</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">73</span>        }</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">74</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">75</span>        <span class=\"k\">public</span> <span class=\"k\">static</span> List&lt;<span class=\"kt\">decimal?</span>&gt; Calculate(IEnumerable&lt;CandleData&gt; candles, <span class=\"kt\">int</span> period = 20)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">76</span>        {</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">77</span>            <span class=\"kt\">var</span> yz = <span class=\"k\">new</span> YangZhangVolatilityIndicator(period);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">78</span>            yz.Calculate(candles);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">79</span>            <span class=\"k\">return</span> yz.Values;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">80</span>        }</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">81</span>    }</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">82</span>}</div></div>","csharp_detailed":"<div class=\"highlight\"><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">1</span><span class=\"c1\">// =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">2</span><span class=\"c1\">// Logic Breakdown (YangZhangVolatilityIndicator)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">3</span><span class=\"c1\">// =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">4</span><span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">5</span><span class=\"c1\">// This document provides a &quot;Deep Dive&quot; into the internal logic of the</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">6</span><span class=\"c1\">// Yang-Zhang Volatility Indicator. We explain *why* code is written this way</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">7</span><span class=\"c1\">// and *how* data transforms line-by-line, targeting programming beginners.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">8</span><span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">9</span><span class=\"c1\">// [Core Concepts]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">10</span><span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">11</span><span class=\"c1\">// 1. Yang-Zhang Volatility (Most Efficient Estimator)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">12</span><span class=\"c1\">//    [Why]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">13</span><span class=\"c1\">//    Traditional close-to-close volatility ignores intraday price movement</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">14</span><span class=\"c1\">//    and overnight gaps. Yang-Zhang (2000) proposed a method that uses ALL</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">15</span><span class=\"c1\">//    OHLC data, combining overnight and intraday variance for maximum</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">16</span><span class=\"c1\">//    efficiency (14x more efficient than close-to-close).</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">17</span><span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">18</span><span class=\"c1\">//    [How]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">19</span><span class=\"c1\">//    The formula combines three variance components:</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">20</span><span class=\"c1\">//    - Overnight Variance: ln(Open/PreviousClose)²</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">21</span><span class=\"c1\">//    - Open-Close Variance: ln(Close/Open)²</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">22</span><span class=\"c1\">//    - Rogers-Satchell Variance: Intraday high-low spread</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">23</span><span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">24</span><span class=\"c1\">// 2. Logarithmic Returns</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">25</span><span class=\"c1\">//    [Why]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">26</span><span class=\"c1\">//    Log returns (ln(P2/P1)) are preferred because they are:</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">27</span><span class=\"c1\">//    - Time-additive (daily returns sum to weekly)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">28</span><span class=\"c1\">//    - Symmetric around zero (no bias)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">29</span><span class=\"c1\">//    - More appropriate for variance calculations</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">30</span><span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">31</span><span class=\"c1\">// 3. Annualization</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">32</span><span class=\"c1\">//    [Why]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">33</span><span class=\"c1\">//    Daily volatility is scaled by sqrt(252) to express as annual volatility.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">34</span><span class=\"c1\">//    252 represents trading days per year.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">35</span><span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">36</span><span class=\"c1\">// =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">37</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">38</span><span class=\"k\">using</span> System;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">39</span><span class=\"k\">using</span> System.Collections.Generic;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">40</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">41</span><span class=\"k\">namespace</span> TechnicalIndicators</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">42</span>{</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">43</span>    <span class=\"c1\">// =========================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">44</span>    <span class=\"c1\">// Logic Explanation: OHLC Data Container (CandleData)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">45</span>    <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">46</span>    <span class=\"c1\">// [Why]  Immutable data transfer object for candlestick data.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">47</span>    <span class=\"c1\">// [What] Encapsulates Timestamp, Open, High, Low, Close, Volume.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">48</span>    <span class=\"c1\">// [Who]  All indicator calculation methods consume this type.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">49</span>    <span class=\"c1\">// [Where] Stack-allocated (record struct) for performance.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">50</span>    <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">51</span>    <span class=\"c1\">// Why &#x27;readonly record struct&#x27;?</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">52</span>    <span class=\"c1\">// 1. Value semantics: Passed by value, no heap allocation.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">53</span>    <span class=\"c1\">// 2. Immutability: Prevents accidental modification during calculation.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">54</span>    <span class=\"c1\">// 3. Built-in equality: Automatic structural comparison.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">55</span>    <span class=\"c1\">// =========================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">56</span>    <span class=\"k\">public</span> <span class=\"k\">readonly</span> <span class=\"k\">record</span> <span class=\"k\">struct</span> CandleData(</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">57</span>        DateTime Timestamp,</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">58</span>        <span class=\"kt\">decimal</span> Open,</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">59</span>        <span class=\"kt\">decimal</span> High,</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">60</span>        <span class=\"kt\">decimal</span> Low,</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">61</span>        <span class=\"kt\">decimal</span> Close,</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">62</span>        <span class=\"kt\">long</span> Volume</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">63</span>    );</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">64</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">65</span>    <span class=\"c1\">// =========================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">66</span>    <span class=\"c1\">// Logic Explanation: Yang-Zhang Volatility Estimator (YangZhangVolatilityIndicator)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">67</span>    <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">68</span>    <span class=\"c1\">// [Why]  Provides the most statistically efficient OHLC-based volatility</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">69</span>    <span class=\"c1\">//        estimate, combining overnight gaps and intraday movement.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">70</span>    <span class=\"c1\">// [What] Produces annualized volatility percentage for each bar.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">71</span>    <span class=\"c1\">// [Who]  Risk management, options pricing, position sizing systems.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">72</span>    <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">73</span>    <span class=\"c1\">// Why &#x27;class&#x27; (not struct)?</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">74</span>    <span class=\"c1\">// 1. Contains mutable List&lt;decimal?&gt; for rolling values.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">75</span>    <span class=\"c1\">// 2. Reference semantics appropriate for stateful calculation.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">76</span>    <span class=\"c1\">// =========================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">77</span>    <span class=\"k\">public</span> <span class=\"k\">class</span> <span class=\"nc\">YangZhangVolatilityIndicator</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">78</span>    {</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">79</span>        <span class=\"c1\">// =====================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">80</span>        <span class=\"c1\">// Logic Explanation: Indicator Configuration (Public Properties)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">81</span>        <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">82</span>        <span class=\"c1\">// [Why]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">83</span>        <span class=\"c1\">// Expose calculation parameters for external inspection and UI display.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">84</span>        <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">85</span>        <span class=\"c1\">// [What]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">86</span>        <span class=\"c1\">// Period: Rolling window size (typically 20 days).</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">87</span>        <span class=\"c1\">// Values: Output list storing volatility for each bar.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">88</span>        <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">89</span>        <span class=\"c1\">// [Who]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">90</span>        <span class=\"c1\">// Charting systems read Period for display labels.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">91</span>        <span class=\"c1\">// Strategy engines consume Values for trading decisions.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">92</span>        <span class=\"c1\">// =====================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">93</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">94</span>        <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">95</span>        <span class=\"c1\">// Variable Definition: Lookback Period</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">96</span>        <span class=\"c1\">// public int Period { get; }</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">97</span>        <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">98</span>        <span class=\"c1\">// [Role]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">99</span>        <span class=\"c1\">// Number of bars used for variance calculation.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">100</span>        <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">101</span>        <span class=\"c1\">// [Type Choice]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">102</span>        <span class=\"c1\">// int: Period is always a whole number of bars.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">103</span>        <span class=\"c1\">// get-only: Immutable after construction (thread-safe).</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">104</span>        <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">105</span>        <span class=\"k\">public</span> <span class=\"kt\">int</span> Period { <span class=\"k\">get</span>; }</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">106</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">107</span>        <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">108</span>        <span class=\"c1\">// Variable Definition: Output Values Container</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">109</span>        <span class=\"c1\">// public List&lt;decimal?&gt; Values { get; } = new();</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">110</span>        <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">111</span>        <span class=\"c1\">// [Role]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">112</span>        <span class=\"c1\">// Stores calculated annualized volatility for each bar.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">113</span>        <span class=\"c1\">// null values indicate insufficient data.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">114</span>        <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">115</span>        <span class=\"c1\">// [Type Choice]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">116</span>        <span class=\"c1\">// decimal?: Nullable for warm-up period markers.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">117</span>        <span class=\"c1\">// List: Dynamic sizing matches input candle count.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">118</span>        <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">119</span>        <span class=\"k\">public</span> List&lt;<span class=\"kt\">decimal?</span>&gt; Values { <span class=\"k\">get</span>; } = <span class=\"k\">new</span>();</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">120</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">121</span>        <span class=\"c1\">// =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">122</span>        <span class=\"c1\">// IPO: Constructor</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">123</span>        <span class=\"c1\">// =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">124</span>        <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">125</span>        <span class=\"c1\">// [Input]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">126</span>        <span class=\"c1\">// - period: int - Rolling window size (default 20)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">127</span>        <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">128</span>        <span class=\"c1\">// [Process]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">129</span>        <span class=\"c1\">// - Validate period &gt; 1 (need at least 2 bars for overnight calculation)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">130</span>        <span class=\"c1\">// - Store validated period</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">131</span>        <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">132</span>        <span class=\"c1\">// [Output]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">133</span>        <span class=\"c1\">// - Initialized YangZhangVolatilityIndicator instance</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">134</span>        <span class=\"c1\">// =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">135</span>        <span class=\"k\">public</span> YangZhangVolatilityIndicator(<span class=\"kt\">int</span> period = 20)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">136</span>        {</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">137</span>            <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">138</span>            <span class=\"c1\">// Logic Step 1: Parameter Validation (Fail Fast)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">139</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">140</span>            <span class=\"c1\">// [Why] (Intent)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">141</span>            <span class=\"c1\">// Yang-Zhang requires previous close for overnight variance.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">142</span>            <span class=\"c1\">// Period must be &gt; 1 to have meaningful rolling calculation.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">143</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">144</span>            <span class=\"c1\">// [How] (Logic)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">145</span>            <span class=\"c1\">// Reject invalid input immediately rather than producing</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">146</span>            <span class=\"c1\">// garbage output that could propagate to trading decisions.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">147</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">148</span>            <span class=\"c1\">// [Decision]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">149</span>            <span class=\"c1\">// Is period &lt;= 1?</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">150</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">151</span>            <span class=\"c1\">// [True Branch: Invalid Parameter]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">152</span>            <span class=\"c1\">// Throw exception immediately to prevent silent failures.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">153</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">154</span>            <span class=\"c1\">// [False Branch: Valid Parameter]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">155</span>            <span class=\"c1\">// Continue with initialization.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">156</span>            <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">157</span>            <span class=\"k\">if</span> (period &lt;= 1)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">158</span>                <span class=\"k\">throw</span> <span class=\"k\">new</span> ArgumentOutOfRangeException(<span class=\"k\">nameof</span>(period));</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">159</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">160</span>            <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">161</span>            <span class=\"c1\">// Logic Step 2: State Initialization</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">162</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">163</span>            <span class=\"c1\">// [Why] (Intent)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">164</span>            <span class=\"c1\">// Store validated period for use in Calculate method.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">165</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">166</span>            <span class=\"c1\">// [How] (Logic)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">167</span>            <span class=\"c1\">// Direct assignment to get-only property (allowed in constructor).</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">168</span>            <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">169</span>            Period = period;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">170</span>        }</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">171</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">172</span>        <span class=\"c1\">// =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">173</span>        <span class=\"c1\">// IPO: Calculate</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">174</span>        <span class=\"c1\">// =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">175</span>        <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">176</span>        <span class=\"c1\">// [Input]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">177</span>        <span class=\"c1\">// - candles: IEnumerable&lt;CandleData&gt; - OHLC price data</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">178</span>        <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">179</span>        <span class=\"c1\">// [Process]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">180</span>        <span class=\"c1\">// - For each bar, calculate three variance components:</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">181</span>        <span class=\"c1\">//   1. Overnight variance: ln(Open/PreviousClose)²</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">182</span>        <span class=\"c1\">//   2. Open-Close variance: ln(Close/Open)²</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">183</span>        <span class=\"c1\">//   3. Rogers-Satchell variance: intraday H/L spread</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">184</span>        <span class=\"c1\">// - Combine using Yang-Zhang weighting coefficient k</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">185</span>        <span class=\"c1\">// - Annualize and convert to percentage</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">186</span>        <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">187</span>        <span class=\"c1\">// [Output]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">188</span>        <span class=\"c1\">// - Values list populated with annualized volatility (%)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">189</span>        <span class=\"c1\">// =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">190</span>        <span class=\"k\">public</span> <span class=\"k\">void</span> Calculate(IEnumerable&lt;CandleData&gt; candles)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">191</span>        {</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">192</span>            <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">193</span>            <span class=\"c1\">// Logic Step 1: State Reset</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">194</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">195</span>            <span class=\"c1\">// [Why] (Intent)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">196</span>            <span class=\"c1\">// Allow re-use of same instance with fresh data.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">197</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">198</span>            <span class=\"c1\">// [How] (Logic)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">199</span>            <span class=\"c1\">// Clear previous results before new calculation.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">200</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">201</span>            <span class=\"c1\">// [Visual]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">202</span>            <span class=\"c1\">// Before: Values = [10.5, 12.3, 11.8, ...]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">203</span>            <span class=\"c1\">// After:  Values = []</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">204</span>            <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">205</span>            Values.Clear();</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">206</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">207</span>            <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">208</span>            <span class=\"c1\">// Logic Step 2: Data Materialization</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">209</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">210</span>            <span class=\"c1\">// [Why] (Intent)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">211</span>            <span class=\"c1\">// Convert IEnumerable to List for indexed access.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">212</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">213</span>            <span class=\"c1\">// [How] (Logic)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">214</span>            <span class=\"c1\">// Random access needed for lookback calculations.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">215</span>            <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">216</span>            <span class=\"kt\">var</span> c = <span class=\"k\">new</span> List&lt;CandleData&gt;(candles);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">217</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">218</span>            <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">219</span>            <span class=\"c1\">// Logic Step 3: Minimum Data Check</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">220</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">221</span>            <span class=\"c1\">// [Decision]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">222</span>            <span class=\"c1\">// Are there fewer than 2 candles?</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">223</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">224</span>            <span class=\"c1\">// [True Branch: Insufficient Data]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">225</span>            <span class=\"c1\">// Return early - need at least 2 bars for overnight calculation.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">226</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">227</span>            <span class=\"c1\">// [False Branch: Sufficient Data]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">228</span>            <span class=\"c1\">// Proceed with calculation.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">229</span>            <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">230</span>            <span class=\"k\">if</span> (c.Count &lt; 2) <span class=\"k\">return</span>;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">231</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">232</span>            <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">233</span>            <span class=\"c1\">// Logic Step 4: First Bar Placeholder</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">234</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">235</span>            <span class=\"c1\">// [Why] (Intent)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">236</span>            <span class=\"c1\">// Bar 0 has no previous close for overnight calculation.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">237</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">238</span>            <span class=\"c1\">// [Visual]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">239</span>            <span class=\"c1\">// Bar Index:  [0]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">240</span>            <span class=\"c1\">// Values:     [null]  &lt;- No overnight data available</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">241</span>            <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">242</span>            Values.Add(<span class=\"k\">null</span>);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">243</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">244</span>            <span class=\"c1\">// =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">245</span>            <span class=\"c1\">// Logic Step 5: Main Calculation Loop</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">246</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">247</span>            <span class=\"c1\">// [Why] (Intent)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">248</span>            <span class=\"c1\">// Iterate through each bar to calculate Yang-Zhang volatility.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">249</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">250</span>            <span class=\"c1\">// [How] (Logic)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">251</span>            <span class=\"c1\">// For bars 1 to Count-1:</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">252</span>            <span class=\"c1\">//   - Skip if insufficient data for full period</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">253</span>            <span class=\"c1\">//   - Calculate three variance components over rolling window</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">254</span>            <span class=\"c1\">//   - Combine using Yang-Zhang formula</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">255</span>            <span class=\"c1\">//   - Annualize result</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">256</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">257</span>            <span class=\"c1\">// [Visual]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">258</span>            <span class=\"c1\">// Period = 3, at bar index 4:</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">259</span>            <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">260</span>            <span class=\"c1\">// Index:  [0]  [1]  [2]  [3]  [4]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">261</span>            <span class=\"c1\">// Close:  100  102  101  103  105</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">262</span>            <span class=\"c1\">//                   |--------|</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">263</span>            <span class=\"c1\">//                   Lookback Window</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">264</span>            <span class=\"c1\">// =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">265</span>            <span class=\"k\">for</span> (<span class=\"kt\">int</span> i = 1; i &lt; c.Count; i++)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">266</span>            {</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">267</span>                <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">268</span>                <span class=\"c1\">// Logic Step 5.1: Warm-Up Period Check</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">269</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">270</span>                <span class=\"c1\">// [Decision]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">271</span>                <span class=\"c1\">// Is current index &lt; Period?</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">272</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">273</span>                <span class=\"c1\">// [True Branch: Insufficient History]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">274</span>                <span class=\"c1\">// Add null and continue - not enough data yet.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">275</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">276</span>                <span class=\"c1\">// [False Branch: Ready to Calculate]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">277</span>                <span class=\"c1\">// Proceed with variance calculation.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">278</span>                <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">279</span>                <span class=\"k\">if</span> (i &lt; Period)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">280</span>                {</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">281</span>                    Values.Add(<span class=\"k\">null</span>);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">282</span>                    <span class=\"k\">continue</span>;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">283</span>                }</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">284</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">285</span>                <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">286</span>                <span class=\"c1\">// Logic Step 5.2: Variance Accumulators Initialization</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">287</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">288</span>                <span class=\"c1\">// [Why] (Intent)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">289</span>                <span class=\"c1\">// Prepare accumulators for three variance components.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">290</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">291</span>                <span class=\"c1\">// [What]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">292</span>                <span class=\"c1\">// sumOvernightSq: Σ(ln(Open/PrevClose))²</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">293</span>                <span class=\"c1\">// sumOpenCloseSq: Σ(ln(Close/Open))²</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">294</span>                <span class=\"c1\">// sumRogersSatchellSq: Σ(Rogers-Satchell component)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">295</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">296</span>                <span class=\"c1\">// [Type Choice]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">297</span>                <span class=\"c1\">// double: Log calculations require floating-point. Using double</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">298</span>                <span class=\"c1\">// for Math.Log compatibility and precision.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">299</span>                <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">300</span>                <span class=\"kt\">double</span> sumOvernightSq = 0;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">301</span>                <span class=\"kt\">double</span> sumOpenCloseSq = 0;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">302</span>                <span class=\"kt\">double</span> sumRogersSatchellSq = 0;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">303</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">304</span>                <span class=\"c1\">// =============================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">305</span>                <span class=\"c1\">// Logic Step 5.3: Rolling Window Iteration</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">306</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">307</span>                <span class=\"c1\">// [Why] (Intent)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">308</span>                <span class=\"c1\">// Sum variance components over the lookback period.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">309</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">310</span>                <span class=\"c1\">// [How] (Logic)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">311</span>                <span class=\"c1\">// Walk backwards from current bar by Period steps.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">312</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">313</span>                <span class=\"c1\">// [Visual]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">314</span>                <span class=\"c1\">// i = 5, Period = 3</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">315</span>                <span class=\"c1\">// j:     0    1    2</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">316</span>                <span class=\"c1\">// idx:   5    4    3</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">317</span>                <span class=\"c1\">// Bars: [3] [4] [5] &lt;- Window includes these bars</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">318</span>                <span class=\"c1\">// =============================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">319</span>                <span class=\"k\">for</span> (<span class=\"kt\">int</span> j = 0; j &lt; Period; j++)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">320</span>                {</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">321</span>                    <span class=\"kt\">int</span> idx = i - j;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">322</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">323</span>                    <span class=\"c1\">// ---------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">324</span>                    <span class=\"c1\">// Logic Step 5.3.1: Boundary Check</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">325</span>                    <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">326</span>                    <span class=\"c1\">// [Decision]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">327</span>                    <span class=\"c1\">// Is idx &lt; 1?</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">328</span>                    <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">329</span>                    <span class=\"c1\">// [True Branch]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">330</span>                    <span class=\"c1\">// Skip - no previous close available for overnight.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">331</span>                    <span class=\"c1\">// ---------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">332</span>                    <span class=\"k\">if</span> (idx &lt; 1) <span class=\"k\">continue</span>;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">333</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">334</span>                    <span class=\"c1\">// ---------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">335</span>                    <span class=\"c1\">// Logic Step 5.3.2: Price Extraction</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">336</span>                    <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">337</span>                    <span class=\"c1\">// [Why] (Intent)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">338</span>                    <span class=\"c1\">// Extract OHLC values and convert to double for Math.Log.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">339</span>                    <span class=\"c1\">// ---------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">340</span>                    <span class=\"kt\">double</span> prevClose = (<span class=\"kt\">double</span>)c[idx - 1].Close;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">341</span>                    <span class=\"kt\">double</span> open = (<span class=\"kt\">double</span>)c[idx].Open;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">342</span>                    <span class=\"kt\">double</span> high = (<span class=\"kt\">double</span>)c[idx].High;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">343</span>                    <span class=\"kt\">double</span> low = (<span class=\"kt\">double</span>)c[idx].Low;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">344</span>                    <span class=\"kt\">double</span> close = (<span class=\"kt\">double</span>)c[idx].Close;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">345</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">346</span>                    <span class=\"c1\">// ---------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">347</span>                    <span class=\"c1\">// Logic Step 5.3.3: Zero Price Guard</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">348</span>                    <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">349</span>                    <span class=\"c1\">// [Decision]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">350</span>                    <span class=\"c1\">// Is prevClose &lt;= 0 or open &lt;= 0?</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">351</span>                    <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">352</span>                    <span class=\"c1\">// [True Branch]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">353</span>                    <span class=\"c1\">// Skip - logarithm of zero/negative is undefined.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">354</span>                    <span class=\"c1\">// ---------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">355</span>                    <span class=\"k\">if</span> (prevClose &lt;= 0 || open &lt;= 0) <span class=\"k\">continue</span>;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">356</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">357</span>                    <span class=\"c1\">// ---------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">358</span>                    <span class=\"c1\">// Logic Step 5.3.4: Logarithmic Returns Calculation</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">359</span>                    <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">360</span>                    <span class=\"c1\">// [Why] (Intent)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">361</span>                    <span class=\"c1\">// Compute log returns for each price relationship.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">362</span>                    <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">363</span>                    <span class=\"c1\">// [How] (Logic)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">364</span>                    <span class=\"c1\">// overnight:  Gap from previous close to today&#x27;s open</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">365</span>                    <span class=\"c1\">// openClose:  Intraday open-to-close movement</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">366</span>                    <span class=\"c1\">// logHigh/Low: Components for Rogers-Satchell</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">367</span>                    <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">368</span>                    <span class=\"c1\">// [Visual]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">369</span>                    <span class=\"c1\">// PrevClose: 100 | Open: 102 | High: 105 | Low: 99 | Close: 103</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">370</span>                    <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">371</span>                    <span class=\"c1\">// overnight = ln(102/100) = 0.0198 (2% gap up)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">372</span>                    <span class=\"c1\">// openClose = ln(103/102) = 0.0098 (1% intraday gain)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">373</span>                    <span class=\"c1\">// ---------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">374</span>                    <span class=\"kt\">double</span> overnight = Math.Log(open / prevClose);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">375</span>                    <span class=\"kt\">double</span> openClose = Math.Log(close / open);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">376</span>                    <span class=\"kt\">double</span> logHighOpen = Math.Log(high / open);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">377</span>                    <span class=\"kt\">double</span> logLowOpen = Math.Log(low / open);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">378</span>                    <span class=\"kt\">double</span> logHighClose = Math.Log(high / close);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">379</span>                    <span class=\"kt\">double</span> logLowClose = Math.Log(low / close);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">380</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">381</span>                    <span class=\"c1\">// ---------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">382</span>                    <span class=\"c1\">// Logic Step 5.3.5: Rogers-Satchell Component</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">383</span>                    <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">384</span>                    <span class=\"c1\">// [Why] (Intent)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">385</span>                    <span class=\"c1\">// Rogers-Satchell captures intraday volatility using the</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">386</span>                    <span class=\"c1\">// full high-low range relative to open and close.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">387</span>                    <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">388</span>                    <span class=\"c1\">// [How] (Logic)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">389</span>                    <span class=\"c1\">// RS = ln(H/O) × ln(H/C) + ln(L/O) × ln(L/C)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">390</span>                    <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">391</span>                    <span class=\"c1\">// This formula is always negative for valid OHLC data,</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">392</span>                    <span class=\"c1\">// representing the &quot;spread&quot; of intraday movement.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">393</span>                    <span class=\"c1\">// ---------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">394</span>                    <span class=\"kt\">double</span> rs = logHighOpen * logHighClose + logLowOpen * logLowClose;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">395</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">396</span>                    <span class=\"c1\">// ---------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">397</span>                    <span class=\"c1\">// Logic Step 5.3.6: Accumulate Squared Values</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">398</span>                    <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">399</span>                    <span class=\"c1\">// [Why] (Intent)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">400</span>                    <span class=\"c1\">// Sum squared returns for variance calculation.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">401</span>                    <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">402</span>                    <span class=\"c1\">// [How] (Logic)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">403</span>                    <span class=\"c1\">// Variance = E[X²] for zero-mean processes.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">404</span>                    <span class=\"c1\">// ---------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">405</span>                    sumOvernightSq += overnight * overnight;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">406</span>                    sumOpenCloseSq += openClose * openClose;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">407</span>                    sumRogersSatchellSq += rs;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">408</span>                }</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">409</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">410</span>                <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">411</span>                <span class=\"c1\">// Logic Step 5.4: Yang-Zhang Weighting Coefficient</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">412</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">413</span>                <span class=\"c1\">// [Why] (Intent)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">414</span>                <span class=\"c1\">// The coefficient k balances overnight and intraday variance.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">415</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">416</span>                <span class=\"c1\">// [How] (Logic)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">417</span>                <span class=\"c1\">// k = 0.34 / (1.34 + (n+1)/(n-1))</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">418</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">419</span>                <span class=\"c1\">// This formula minimizes estimation error by optimally</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">420</span>                <span class=\"c1\">// weighting the three variance components.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">421</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">422</span>                <span class=\"c1\">// [Visual]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">423</span>                <span class=\"c1\">// For Period = 20:</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">424</span>                <span class=\"c1\">// k = 0.34 / (1.34 + 21/19)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">425</span>                <span class=\"c1\">// k = 0.34 / (1.34 + 1.105)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">426</span>                <span class=\"c1\">// k ≈ 0.139</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">427</span>                <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">428</span>                <span class=\"kt\">double</span> k = 0.34 / (1.34 + (Period + 1.0) / (Period - 1.0));</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">429</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">430</span>                <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">431</span>                <span class=\"c1\">// Logic Step 5.5: Variance Calculation</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">432</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">433</span>                <span class=\"c1\">// [Why] (Intent)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">434</span>                <span class=\"c1\">// Average the squared returns to get variance estimates.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">435</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">436</span>                <span class=\"c1\">// [How] (Logic)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">437</span>                <span class=\"c1\">// Divide sum by Period to get mean squared return.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">438</span>                <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">439</span>                <span class=\"kt\">double</span> overnightVar = sumOvernightSq / Period;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">440</span>                <span class=\"kt\">double</span> openCloseVar = sumOpenCloseSq / Period;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">441</span>                <span class=\"kt\">double</span> rsVar = sumRogersSatchellSq / Period;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">442</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">443</span>                <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">444</span>                <span class=\"c1\">// Logic Step 5.6: Yang-Zhang Combined Variance</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">445</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">446</span>                <span class=\"c1\">// [Why] (Intent)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">447</span>                <span class=\"c1\">// Combine three variance components using optimal weights.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">448</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">449</span>                <span class=\"c1\">// [How] (Logic)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">450</span>                <span class=\"c1\">// σ² = Overnight + k × OpenClose + (1-k) × RogersSatchell</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">451</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">452</span>                <span class=\"c1\">// This combination is unbiased and minimum-variance.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">453</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">454</span>                <span class=\"c1\">// [Visual]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">455</span>                <span class=\"c1\">// Overnight:    [====]   (gap component)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">456</span>                <span class=\"c1\">// OpenClose:    [==]     (intraday drift)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">457</span>                <span class=\"c1\">// RogersSatchell: [=====] (intraday range)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">458</span>                <span class=\"c1\">//                 ↓</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">459</span>                <span class=\"c1\">// Yang-Zhang:  [========] (combined optimal estimate)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">460</span>                <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">461</span>                <span class=\"kt\">double</span> yangZhangVar = overnightVar + k * openCloseVar + (1 - k) * rsVar;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">462</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">463</span>                <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">464</span>                <span class=\"c1\">// Logic Step 5.7: Annualization</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">465</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">466</span>                <span class=\"c1\">// [Why] (Intent)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">467</span>                <span class=\"c1\">// Convert daily variance to annual volatility percentage.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">468</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">469</span>                <span class=\"c1\">// [How] (Logic)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">470</span>                <span class=\"c1\">// - Take square root to get standard deviation</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">471</span>                <span class=\"c1\">// - Multiply by sqrt(252) for annualization</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">472</span>                <span class=\"c1\">// - Multiply by 100 for percentage</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">473</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">474</span>                <span class=\"c1\">// [Visual]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">475</span>                <span class=\"c1\">// Daily Var: 0.0001</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">476</span>                <span class=\"c1\">// Daily Vol: sqrt(0.0001) = 0.01</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">477</span>                <span class=\"c1\">// Annual Vol: 0.01 × sqrt(252) = 0.159</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">478</span>                <span class=\"c1\">// Percentage: 0.159 × 100 = 15.9%</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">479</span>                <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">480</span>                <span class=\"kt\">double</span> annualizedVol = Math.Sqrt(yangZhangVar * 252) * 100;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">481</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">482</span>                <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">483</span>                <span class=\"c1\">// Logic Step 5.8: Store Result</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">484</span>                <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">485</span>                <span class=\"c1\">// [Why] (Intent)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">486</span>                <span class=\"c1\">// Convert back to decimal for output consistency.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">487</span>                <span class=\"c1\">// -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">488</span>                Values.Add((<span class=\"kt\">decimal</span>)annualizedVol);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">489</span>            }</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">490</span>        }</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">491</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">492</span>        <span class=\"c1\">// =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">493</span>        <span class=\"c1\">// IPO: Static Calculate Helper</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">494</span>        <span class=\"c1\">// =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">495</span>        <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">496</span>        <span class=\"c1\">// [Input]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">497</span>        <span class=\"c1\">// - candles: IEnumerable&lt;CandleData&gt; - OHLC data</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">498</span>        <span class=\"c1\">// - period: int - Lookback period (default 20)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">499</span>        <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">500</span>        <span class=\"c1\">// [Process]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">501</span>        <span class=\"c1\">// - Wraps instance creation and calculation in one call.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">502</span>        <span class=\"c1\">//</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">503</span>        <span class=\"c1\">// [Output]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">504</span>        <span class=\"c1\">// - List&lt;decimal?&gt; - Annualized volatility values</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">505</span>        <span class=\"c1\">// =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">506</span>        <span class=\"k\">public</span> <span class=\"k\">static</span> List&lt;<span class=\"kt\">decimal?</span>&gt; Calculate(IEnumerable&lt;CandleData&gt; candles, <span class=\"kt\">int</span> period = 20)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">507</span>        {</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">508</span>            <span class=\"c1\">// 1. Instantiation</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">509</span>            <span class=\"c1\">//    [Why: Create instance with validated period]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">510</span>            <span class=\"kt\">var</span> yz = <span class=\"k\">new</span> YangZhangVolatilityIndicator(period);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">511</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">512</span>            <span class=\"c1\">// 2. Execution</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">513</span>            <span class=\"c1\">//    [Why: Process all candle data]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">514</span>            yz.Calculate(candles);</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">515</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">516</span>            <span class=\"c1\">// 3. Extraction</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">517</span>            <span class=\"c1\">//    [Why: Return clean result list]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">518</span>            <span class=\"k\">return</span> yz.Values;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">519</span>        }</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">520</span>    }</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">521</span>}</div></div>","python_simple":"<div class=\"highlight\"><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">1</span><span class=\"kn\">import</span> math</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">2</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">3</span><span class=\"k\">class</span> <span class=\"nc\">YangZhangVolatilityIndicator</span>:</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">4</span>    <span class=\"sd\">&quot;&quot;&quot;</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">5</span><span class=\"sd\">    Yang-Zhang Volatility</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">6</span><span class=\"sd\">    &quot;&quot;&quot;</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">7</span>    <span class=\"k\">def</span> __init__(self, period=20):</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">8</span>        self.period = period</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">9</span>        self.values = []</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">10</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">11</span>    <span class=\"k\">def</span> calculate(self, candles):</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">12</span>        self.values.clear()</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">13</span>        <span class=\"k\">if</span> len(candles) &lt; 2: <span class=\"k\">return</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">14</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">15</span>        self.values.append(<span class=\"kc\">None</span>) <span class=\"c1\"># First candle skipped</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">16</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">17</span>        <span class=\"k\">for</span> i <span class=\"ow\">in</span> range(1, len(candles)):</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">18</span>            <span class=\"k\">if</span> i &lt; self.period:</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">19</span>                self.values.append(<span class=\"kc\">None</span>)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">20</span>                <span class=\"k\">continue</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">21</span>            </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">22</span>            sum_overnight_sq = 0.0</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">23</span>            sum_open_close_sq = 0.0</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">24</span>            sum_rs_sq = 0.0</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">25</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">26</span>            <span class=\"k\">for</span> j <span class=\"ow\">in</span> range(self.period):</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">27</span>                idx = i - j</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">28</span>                <span class=\"k\">if</span> idx &lt; 1: <span class=\"k\">continue</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">29</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">30</span>                prev_close = float(candles[idx-1][<span class=\"s1\">&#x27;</span><span class=\"s1\">close</span><span class=\"s1\">&#x27;</span>])</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">31</span>                open_p = float(candles[idx][<span class=\"s1\">&#x27;</span><span class=\"s1\">open</span><span class=\"s1\">&#x27;</span>])</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">32</span>                high = float(candles[idx][<span class=\"s1\">&#x27;</span><span class=\"s1\">high</span><span class=\"s1\">&#x27;</span>])</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">33</span>                low = float(candles[idx][<span class=\"s1\">&#x27;</span><span class=\"s1\">low</span><span class=\"s1\">&#x27;</span>])</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">34</span>                close = float(candles[idx][<span class=\"s1\">&#x27;</span><span class=\"s1\">close</span><span class=\"s1\">&#x27;</span>])</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">35</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">36</span>                <span class=\"k\">if</span> prev_close &lt;= 0 <span class=\"ow\">or</span> open_p &lt;= 0: <span class=\"k\">continue</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">37</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">38</span>                overnight = math.log(open_p / prev_close)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">39</span>                open_close = math.log(close / open_p)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">40</span>                </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">41</span>                log_ho = math.log(high / open_p)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">42</span>                log_lo = math.log(low / open_p)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">43</span>                log_hc = math.log(high / close)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">44</span>                log_lc = math.log(low / close)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">45</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">46</span>                rs = log_ho * log_hc + log_lo * log_lc</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">47</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">48</span>                sum_overnight_sq += overnight ** 2</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">49</span>                sum_open_close_sq += open_close ** 2</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">50</span>                sum_rs_sq += rs</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">51</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">52</span>            k = 0.34 / (1.34 + (self.period + 1.0) / (self.period - 1.0))</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">53</span>            </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">54</span>            overnight_var = sum_overnight_sq / self.period</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">55</span>            open_close_var = sum_open_close_sq / self.period</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">56</span>            rs_var = sum_rs_sq / self.period</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">57</span>            </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">58</span>            yz_var = overnight_var + k * open_close_var + (1.0 - k) * rs_var</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">59</span>            annualized = math.sqrt(yz_var * 252) * 100.0</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">60</span>            </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">61</span>            self.values.append(annualized)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">62</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">63</span><span class=\"k\">def</span> calculate(candles, period=20):</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">64</span>    obj = YangZhangVolatilityIndicator(period)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">65</span>    obj.calculate(candles)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">66</span>    <span class=\"k\">return</span> obj.values</div></div>","python_detailed":"<div class=\"highlight\"><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">1</span><span class=\"c1\"># =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">2</span><span class=\"c1\"># Logic Breakdown (YangZhangVolatilityIndicator)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">3</span><span class=\"c1\"># =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">4</span><span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">5</span><span class=\"c1\"># This document provides a &quot;Deep Dive&quot; into the internal logic of the</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">6</span><span class=\"c1\"># Yang-Zhang Volatility Indicator.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">7</span><span class=\"c1\"># We explain *why* code is written this way and *how* data transforms</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">8</span><span class=\"c1\"># line-by-line, targeting programming beginners.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">9</span><span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">10</span><span class=\"c1\"># [Core Concepts]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">11</span><span class=\"c1\"># 1. The &quot;Scanner&quot; of Volatility</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">12</span><span class=\"c1\">#    - Standard volatility (Close-to-Close) misses the action that happens</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">13</span><span class=\"c1\">#      while the market is closed (Overnight Gaps).</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">14</span><span class=\"c1\">#    - Yang-Zhang is a &quot;Minimum Variance Unbiased Estimator&quot; widely used in Quantitative Finance.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">15</span><span class=\"c1\">#    - It combines three separate volatility measurements into one robust number.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">16</span><span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">17</span><span class=\"c1\"># 2. The Three Components</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">18</span><span class=\"c1\">#    a) Overnight Volatility (Close[t-1] to Open[t]): Measures the gap size.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">19</span><span class=\"c1\">#    b) Open-to-Close Volatility (Open[t] to Close[t]): Measures the trading session.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">20</span><span class=\"c1\">#    c) Rogers-Satchell Volatility: Measures intraday swings (High/Low) regardless of trend.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">21</span><span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">22</span><span class=\"c1\"># [Formula]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">23</span><span class=\"c1\"># k = 0.34 / (1.34 + (N+1)/(N-1))  &lt;-- Weighting factor based on period N</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">24</span><span class=\"c1\"># YZ_Var = Var_Overnight + k * Var_OpenClose + (1-k) * Var_RogersSatchell</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">25</span><span class=\"c1\"># Result = Sqrt(YZ_Var * 252) * 100</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">26</span><span class=\"c1\"># (We multiply by Sqrt(252) to &quot;Annualize&quot; daily volatility: ~252 trading days/year)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">27</span><span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">28</span><span class=\"c1\"># =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">29</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">30</span><span class=\"kn\">import</span> math</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">31</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">32</span><span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">33</span><span class=\"c1\"># Type-Level Explanation: YangZhangVolatilityIndicator (class)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">34</span><span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">35</span><span class=\"c1\"># [Why]  To capture the most statistically accurate historical volatility.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">36</span><span class=\"c1\"># [What] A composite variance estimator.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">37</span><span class=\"c1\"># [How]  Calculates a weighted average of Overnight Variance, Open-to-Close Variance, and Rogers-Satchell Variance.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">38</span><span class=\"c1\"># [Who]  Quants, Risk Managers, Options Traders.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">39</span><span class=\"c1\"># [Where] Heap (Class instance).</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">40</span><span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">41</span><span class=\"k\">class</span> <span class=\"nc\">YangZhangVolatilityIndicator</span>:</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">42</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">43</span>    <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">44</span>    <span class=\"c1\"># Logic Explanation: Indicator Configuration (Public Properties)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">45</span>    <span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">46</span>    <span class=\"c1\"># [Why]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">47</span>    <span class=\"c1\"># Define inputs and outputs.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">48</span>    <span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">49</span>    <span class=\"c1\"># [What]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">50</span>    <span class=\"c1\"># - period: Lookback window (Standard 20).</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">51</span>    <span class=\"c1\"># - values: The resulting Annualized Volatility (%).</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">52</span>    <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">53</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">54</span>    <span class=\"k\">def</span> __init__(self, period=20):</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">55</span>        <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">56</span>        <span class=\"c1\"># Logic Step 1: Validation</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">57</span>        <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">58</span>        <span class=\"c1\"># Need at least &gt;1 to calculate variance (N-1 denominator issues)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">59</span>        <span class=\"k\">if</span> period &lt;= 1:</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">60</span>            <span class=\"k\">raise</span> ValueError(<span class=\"s2\">&quot;</span><span class=\"s2\">period</span><span class=\"s2\">&quot;</span>)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">61</span>        </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">62</span>        <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">63</span>        <span class=\"c1\"># Variable Definition: period</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">64</span>        <span class=\"c1\"># [Role] Rolling window size.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">65</span>        <span class=\"c1\"># [Type Choice] Integer.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">66</span>        <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">67</span>        self.period = period</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">68</span>        </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">69</span>        <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">70</span>        <span class=\"c1\"># Variable Definition: values</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">71</span>        <span class=\"c1\"># [Role] Output storage.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">72</span>        <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">73</span>        self.values = []</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">74</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">75</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">76</span>    <span class=\"c1\"># =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">77</span>    <span class=\"c1\"># IPO: calculate</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">78</span>    <span class=\"c1\"># =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">79</span>    <span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">80</span>    <span class=\"c1\"># [Input]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">81</span>    <span class=\"c1\"># - candles: List[dict] - OHLCV Data.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">82</span>    <span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">83</span>    <span class=\"c1\"># [Process]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">84</span>    <span class=\"c1\"># 1. Wait for &#x27;period&#x27; bars.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">85</span>    <span class=\"c1\"># 2. For each day, look back N days.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">86</span>    <span class=\"c1\"># 3. Calculate the 3 Variance Components (Overnight, Open-Close, RS).</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">87</span>    <span class=\"c1\"># 4. Combine them using the &#x27;k&#x27; weight.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">88</span>    <span class=\"c1\"># 5. Square Root and Annualize.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">89</span>    <span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">90</span>    <span class=\"c1\"># [Output]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">91</span>    <span class=\"c1\"># - None (Results stored in values).</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">92</span>    <span class=\"c1\"># =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">93</span>    <span class=\"k\">def</span> calculate(self, candles):</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">94</span>        <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">95</span>        <span class=\"c1\"># Logic Step 1: Cleanup</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">96</span>        <span class=\"c1\"># [Why]   Ensure fresh state.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">97</span>        <span class=\"c1\"># [How]   Clear the values list.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">98</span>        <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">99</span>        self.values.clear()</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">100</span>        </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">101</span>        <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">102</span>        <span class=\"c1\"># Logic Step 2: Minimum Data Check</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">103</span>        <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">104</span>        <span class=\"k\">if</span> len(candles) &lt; 2:</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">105</span>            <span class=\"k\">return</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">106</span>        </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">107</span>        <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">108</span>        <span class=\"c1\"># Logic Step 3: Alignment Padding</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">109</span>        <span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">110</span>        <span class=\"c1\"># [Why]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">111</span>        <span class=\"c1\"># The first candle (index 0) has no &quot;Previous Close&quot;, so we cannot</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">112</span>        <span class=\"c1\"># calculate the Overnight Gap. We must skip it.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">113</span>        <span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">114</span>        <span class=\"c1\"># [How]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">115</span>        <span class=\"c1\"># Compare Index [1] vs Index [0].</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">116</span>        <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">117</span>        self.values.append(<span class=\"kc\">None</span>)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">118</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">119</span>        <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">120</span>        <span class=\"c1\"># Logic Step 4: Main Loop</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">121</span>        <span class=\"c1\"># [Why]   Process data chronologically to build moving window statistics.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">122</span>        <span class=\"c1\"># [How]   Iterate through the candles starting from index 1.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">123</span>        <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">124</span>        <span class=\"k\">for</span> i <span class=\"ow\">in</span> range(1, len(candles)):</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">125</span>            </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">126</span>            <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">127</span>            <span class=\"c1\"># Logic Step 5: Window Check</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">128</span>            <span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">129</span>            <span class=\"c1\"># [Decision]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">130</span>            <span class=\"c1\"># Do we have N candles available for the variance lookback?</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">131</span>            <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">132</span>            <span class=\"k\">if</span> i &lt; self.period:</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">133</span>                self.values.append(<span class=\"kc\">None</span>)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">134</span>                <span class=\"k\">continue</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">135</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">136</span>            <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">137</span>            <span class=\"c1\"># Variable Definition: Accumulators</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">138</span>            <span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">139</span>            <span class=\"c1\"># [Role]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">140</span>            <span class=\"c1\"># Store the Sum of Squared Log Returns for each component</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">141</span>            <span class=\"c1\"># over the lookback window.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">142</span>            <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">143</span>            sum_overnight_sq = 0.0</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">144</span>            sum_open_close_sq = 0.0</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">145</span>            sum_rs_sq = 0.0</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">146</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">147</span>            <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">148</span>            <span class=\"c1\"># Logic Step 6: Inner Window Loop</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">149</span>            <span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">150</span>            <span class=\"c1\"># [Why]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">151</span>            <span class=\"c1\"># Calculate the volatility components for the specific window [i-N : i].</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">152</span>            <span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">153</span>            <span class=\"c1\"># [How]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">154</span>            <span class=\"c1\"># Iterate j from 0 to period-1.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">155</span>            <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">156</span>            <span class=\"k\">for</span> j <span class=\"ow\">in</span> range(self.period):</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">157</span>                <span class=\"c1\"># Calculate index relative to current &#x27;i&#x27;</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">158</span>                idx = i - j</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">159</span>                </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">160</span>                <span class=\"c1\"># Check bounds (cannot go below index 1 due to prev_close dependency)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">161</span>                <span class=\"k\">if</span> idx &lt; 1:</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">162</span>                    <span class=\"k\">continue</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">163</span>                    </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">164</span>                prev_close = candles[idx - 1][<span class=\"s1\">&#x27;</span><span class=\"s1\">close</span><span class=\"s1\">&#x27;</span>]</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">165</span>                open_p = candles[idx][<span class=\"s1\">&#x27;</span><span class=\"s1\">open</span><span class=\"s1\">&#x27;</span>]</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">166</span>                high = candles[idx][<span class=\"s1\">&#x27;</span><span class=\"s1\">high</span><span class=\"s1\">&#x27;</span>]</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">167</span>                low = candles[idx][<span class=\"s1\">&#x27;</span><span class=\"s1\">low</span><span class=\"s1\">&#x27;</span>]</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">168</span>                close = candles[idx][<span class=\"s1\">&#x27;</span><span class=\"s1\">close</span><span class=\"s1\">&#x27;</span>]</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">169</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">170</span>                <span class=\"c1\"># Safety: Prevent Log(&lt;=0) errors</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">171</span>                <span class=\"k\">if</span> prev_close &lt;= 0 <span class=\"ow\">or</span> open_p &lt;= 0 <span class=\"ow\">or</span> low &lt;= 0:</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">172</span>                    <span class=\"k\">continue</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">173</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">174</span>                <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">175</span>                <span class=\"c1\"># Logic Step 7: Log Returns (The 3 Components)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">176</span>                <span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">177</span>                <span class=\"c1\"># [Why]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">178</span>                <span class=\"c1\"># Log returns are used in finance because they are symmetric</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">179</span>                <span class=\"c1\"># and additive over time.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">180</span>                <span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">181</span>                <span class=\"c1\"># [Visual]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">182</span>                <span class=\"c1\"># CloseT-1=100, OpenT=105 -&gt; Overnight Gap +5%</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">183</span>                <span class=\"c1\"># Log(105/100) = 0.048...</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">184</span>                <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">185</span>                </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">186</span>                <span class=\"c1\"># 1. Overnight (Gap)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">187</span>                overnight = math.log(open_p / prev_close)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">188</span>                </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">189</span>                <span class=\"c1\"># 2. Session (Open to Close)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">190</span>                open_close = math.log(close / open_p)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">191</span>                </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">192</span>                <span class=\"c1\"># 3. Rogers-Satchell (Intraday Extremes)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">193</span>                log_high_open = math.log(high / open_p)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">194</span>                log_low_open = math.log(low / open_p)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">195</span>                log_high_close = math.log(high / close)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">196</span>                log_low_close = math.log(low / close)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">197</span>                </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">198</span>                <span class=\"c1\"># RS Formula: (High-Open)*(High-Close) + (Low-Open)*(Low-Close)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">199</span>                rs = log_high_open * log_high_close + log_low_open * log_low_close</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">200</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">201</span>                <span class=\"c1\"># Accumulate Squares (Variance ~ Mean of Squares, assuming Mean=0 for returns)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">202</span>                sum_overnight_sq += overnight * overnight</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">203</span>                sum_open_close_sq += open_close * open_close</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">204</span>                sum_rs_sq += rs</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">205</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">206</span>            <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">207</span>            <span class=\"c1\"># Logic Step 8: Calculate Variances</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">208</span>            <span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">209</span>            <span class=\"c1\"># [Why]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">210</span>            <span class=\"c1\"># Convert sums to averages (Variances).</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">211</span>            <span class=\"c1\"># [How]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">212</span>            <span class=\"c1\"># Divide each sum of squares by the period N.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">213</span>            <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">214</span>            overnight_var = sum_overnight_sq / self.period</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">215</span>            open_close_var = sum_open_close_sq / self.period</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">216</span>            rs_var = sum_rs_sq / self.period</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">217</span>            </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">218</span>            <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">219</span>            <span class=\"c1\"># Logic Step 9: Weighting Factor (k)</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">220</span>            <span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">221</span>            <span class=\"c1\"># [Why]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">222</span>            <span class=\"c1\"># &#x27;k&#x27; is the magic number derived by Yang &amp; Zhang to minimize the</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">223</span>            <span class=\"c1\"># variance of the estimator itself.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">224</span>            <span class=\"c1\"># [How]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">225</span>            <span class=\"c1\"># k = 0.34 / (1.34 + (N+1)/(N-1)).</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">226</span>            <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">227</span>            k = 0.34 / (1.34 + (self.period + 1.0) / (self.period - 1.0))</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">228</span>            </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">229</span>            <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">230</span>            <span class=\"c1\"># Logic Step 10: Final Combination</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">231</span>            <span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">232</span>            <span class=\"c1\"># [How]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">233</span>            <span class=\"c1\"># Weighted Sum of the three variances.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">234</span>            <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">235</span>            yz_var = overnight_var + k * open_close_var + (1 - k) * rs_var</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">236</span>            </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">237</span>            <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">238</span>            <span class=\"c1\"># Logic Step 11: Annualization</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">239</span>            <span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">240</span>            <span class=\"c1\"># [Why]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">241</span>            <span class=\"c1\"># Traders think in &quot;Annualized Volatility&quot; (like VIX).</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">242</span>            <span class=\"c1\"># To convert Daily Variance to Annual Standard Deviation:</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">243</span>            <span class=\"c1\"># 1. Sqrt(Variance) -&gt; Daily StdDev</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">244</span>            <span class=\"c1\"># 2. Daily StdDev * Sqrt(252) -&gt; Annual StdDev</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">245</span>            <span class=\"c1\"># 3. * 100 -&gt; Percentage</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">246</span>            <span class=\"c1\"># [How]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">247</span>            <span class=\"c1\"># Sqrt(YZ_Var * 252) * 100.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">248</span>            <span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">249</span>            annualized_vol = math.sqrt(yz_var * 252) * 100</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">250</span>            </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">251</span>            self.values.append(annualized_vol)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">252</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">253</span>&#8203;</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">254</span><span class=\"c1\"># =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">255</span><span class=\"c1\"># Static Wrapper Function</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">256</span><span class=\"c1\"># =============================================================================</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">257</span><span class=\"c1\">#</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">258</span><span class=\"c1\"># [Why] Functional interface.</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">259</span><span class=\"c1\"># -------------------------------------------------------------</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">260</span><span class=\"k\">def</span> calculate(candles, period=20):</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">261</span>    <span class=\"c1\"># 1. Instantiation</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">262</span>    <span class=\"c1\">#    [Why: Setup state]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">263</span>    yz = YangZhangVolatilityIndicator(period)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">264</span>    </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">265</span>    <span class=\"c1\"># 2. Execution</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">266</span>    <span class=\"c1\">#    [Why: Process data]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">267</span>    yz.calculate(candles)</div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">268</span>    </div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">269</span>    <span class=\"c1\"># 3. Extraction</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">270</span>    <span class=\"c1\">#    [Why: Return clean result]</span></div><div class=\"code-line\" style=\"white-space: pre;\"><span style=\"display:inline-block; width:2em; text-align:right; margin-right:1em; color:#9ca3af; user-select:none;\">271</span>    <span class=\"k\">return</span> yz.values</div></div>"});